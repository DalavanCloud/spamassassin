# Included on the zone from /etc/apache2/httpd.conf:
#   Include /etc/apache/local-conf/httpd.conf
#
# Update Apache config like so:
# 
#   cd /home/automc/svn/spamassassin; sudo -u automc svn up

# ---------------------------------------------------------------------------

# May 12 2005 jm
<IfModule mod_dir.c>
    DirectoryIndex index.html index.htm index.shtml index.php index.php4 index.php3 index.phtml index.cgi
</IfModule>

UseCanonicalName On

NameVirtualHost *:80

# jm dec 9 : proxy shouldn't wait for EOF, we want partial files too
# SetEnv force-proxy-request-1.0 1
SetEnv proxy-nokeepalive 1
# try to cause more frequent buf writes with a tiny buf size
ProxyIOBufferSize 16
# reverse proxying only!
ProxyRequests Off

# ---------------------------------------------------------------------------

<VirtualHost *:80>
  ServerName buildbot.spamassassin.org
  <Directory /var/www/buildbot.spamassassin.org>
    options indexes SymLinksIfOwnerMatch
    AllowOverride indexes
  </Directory>
  DocumentRoot /var/www/buildbot.spamassassin.org
  ServerAdmin webmaster@spamassassin.org
  userdir disabled

  # backwards compat for old URLs
  RewriteEngine On
  RewriteRule ^/(ruleqa|preflight|bb)$ $1/ [R]
  RewriteRule ^/ruleqa/(.*) http://ruleqa.spamassassin.org/$1 [R,L]
  RewriteRule ^/preflight/(.*) http://bbmass.spamassassin.org/$1 [R,L]
  RewriteRule ^/bb/(.*) http://buildbot.spamassassin.org/$1 [R,L]

  ProxyRequests Off
  <Proxy *>
  Order deny,allow
  Allow from all
  </Proxy>

  # do not proxy the following URLs; instead, satisfy from /var/www/...
  ProxyPass /robots.txt !
  ProxyPass /favicon.ico !

  ProxyPass /        http://127.0.0.1:8010/
  ProxyPassReverse / http://127.0.0.1:8010/

  ProxyPass /buildbot.css http://127.0.0.1:8010/buildbot.css
  ProxyPassReverse /buildbot.css http://127.0.0.1:8010/buildbot.css

</VirtualHost>

# ---------------------------------------------------------------------------

<VirtualHost *:80>
  ServerName bbmass.spamassassin.org
  <Directory /var/www/bbmass.spamassassin.org>
    options indexes SymLinksIfOwnerMatch
    AllowOverride indexes
  </Directory>
  DocumentRoot /var/www/bbmass.spamassassin.org
  ServerAdmin webmaster@spamassassin.org
  userdir disabled

  ProxyRequests Off
  <Proxy *>
  Order deny,allow
  Allow from all
  </Proxy>

  # do not proxy the following URLs; instead, satisfy from /var/www/...
  ProxyPass /robots.txt !
  ProxyPass /favicon.ico !

  ProxyPass /        http://127.0.0.1:8011/
  ProxyPassReverse / http://127.0.0.1:8011/

  ProxyPass /buildbot.css http://127.0.0.1:8011/buildbot.css
  ProxyPassReverse /buildbot.css http://127.0.0.1:8011/buildbot.css

</VirtualHost>

# ---------------------------------------------------------------------------

<VirtualHost *:80>
  ServerName ruleqa.spamassassin.org
  <Directory /var/www/ruleqa.spamassassin.org>
    options indexes SymLinksIfOwnerMatch
    AllowOverride indexes
  </Directory>
  DocumentRoot /var/www/ruleqa.spamassassin.org
  ServerAdmin webmaster@spamassassin.org
  userdir disabled

  # debugging:
  # RewriteLogLevel 9
  # RewriteLog /var/apache2/logs/rewrite_log

  # "%2F" is used to grep rule subsets, allow it
  AllowEncodedSlashes On

  # strip out known-local files and loops; all else goes to the ruleqa code
  RewriteEngine On
  # RewriteCond %{REQUEST_URI} !^/robots\.txt	
  # RewriteCond %{REQUEST_URI} !^/favicon\.ico	
  # RewriteCond %{REQUEST_URI} !^/sorttable\.js	
  RewriteBase /
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_URI} !^/ruleqa\.cgi	
  RewriteRule ^/(.*) /ruleqa.cgi/$1 [PT,L]

  ScriptAlias /ruleqa.cgi /home/automc/svn/spamassassin/masses/rule-qa/automc/ruleqa.cgi

</VirtualHost>

# ---------------------------------------------------------------------------

<VirtualHost *:80>
  ServerName rsync.spamassassin.org
  <Directory /home/corpus-rsync/corpus>
    options indexes SymLinksIfOwnerMatch
    AllowOverride indexes
  </Directory>
  DocumentRoot /home/corpus-rsync/corpus
  ServerAdmin webmaster@spamassassin.org
  userdir disabled
</VirtualHost>

# ---------------------------------------------------------------------------
