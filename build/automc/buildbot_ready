#!/usr/bin/perl -w

use strict;

my $perl = $^X;
if (!$perl) {
  die "no perl path found in ARGV!";
}

my $command = shift @ARGV;

if ($command eq 'start') {
  do_start();
}
elsif ($command eq 'stop') {
  do_stop();
}
exit;

# ---------------------------------------------------------------------------

sub do_start {
  # ensure all pre-reqs (and rules) are built
  system ("$perl Makefile.PL < /dev/null");
  system ("make");

  # for mass-check to report, without having to have a working "svn" client
  # in the chroot
  system ("svn info --non-interactive > masses/svninfo.tmp");
}

# ---------------------------------------------------------------------------

sub do_stop {
  chdir("masses") or die;
  system ("$perl hit-frequencies -c tstrules -x -p -s $(SCORESET)");
}


