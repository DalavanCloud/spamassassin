#!/bin/sh -x
#
# as seen on the zone's "bbmass" mass-checking buildbot

SADIR=/home/automc/svn/spamassassin
BBMHOME=/home/bbmass

[ -d $BBMHOME/tmpfs/cor ] || \
    mkdir $BBMHOME/tmpfs/tmp $BBMHOME/tmpfs/cor

cd $BBMHOME/rawcor
date

mkdir $BBMHOME/tmpfs/newcor

TMPDIR=$BBMHOME/tmpfs/tmp \
  /local/perl586/bin/perl \
  $SADIR/masses/corpora/mk-corpus-link-farm \
          -after="6 months ago" \
          -dest $BBMHOME/tmpfs/newcor/mc-fast -num 1000 \
          -dest $BBMHOME/tmpfs/newcor/mc-med -num 5000 \
          -dest $BBMHOME/tmpfs/newcor/mc-slow -num 10000 \
          -dest $BBMHOME/tmpfs/newcor/mc-slower -num 20000 \
        *

# remove this "out of the way" name, just in case.   for some reason
# this seems to occasionally be un-rm'able; Solaris zones bug?
rm -rf $BBMHOME/tmpfs/cor.old.$$

# and put the new corpus linkfarm in place...
mv $BBMHOME/tmpfs/cor $BBMHOME/tmpfs/cor.old.$$
mv $BBMHOME/tmpfs/newcor $BBMHOME/tmpfs/cor

# remove the old one (or try, at least)
rm -rf $BBMHOME/tmpfs/cor.old.$$

for dir in mc-fast mc-med mc-slow mc-slower
do
echo "ham:dir:$BBMHOME/tmpfs/cor/$dir/ham
spam:dir:$BBMHOME/tmpfs/cor/$dir/spam" > $BBMHOME/tmpfs/cor/$dir/targets
done

date
