#!/bin/sh
#
# driver for cron.
# 30 8 * * * bash /home/updatesd/svn/spamassassin/build/mkupdates/run_nightly > /var/www/buildbot.spamassassin.org/bbmass/mkupdates.txt 2>&1

cd /home/updatesd/svn/spamassassin

set -x

PERL=/local/perl586/bin/perl
PATH=$PATH:/usr/sfw/bin:/opt/sfw/bin:/opt/SUNWspro/bin:/usr/X/bin:/usr/ucb:/usr/sbin:/usr/ccs/bin:/opt/subversion-1.1.4/bin:/usr/apache2/bin:/local/bin

export PERL PATH

$PERL ./build/listpromotable > rules/active.list

(
echo "

To perform this, someone log into the zone and type:

        ssh spamassassin.zones.apache.org
        cd /home/updatesd/svn/spamassassin
        sudo su updatesd -c \"svn commit -m 'daily promoted rules list' rules/active.list\"

"
svn diff

) | mailx \
        -s "Planned commit for active.list" \
        dev@Spamassassin.apache.org


# cycle the logfiles; keep 6 (3 days worth I think)
(
  cd /var/www/buildbot.spamassassin.org/bbmass
  rm mkupdates_6.txt
  mv mkupdates_5.txt  mkupdates_6.txt
  mv mkupdates_4.txt  mkupdates_5.txt
  mv mkupdates_3.txt  mkupdates_4.txt
  mv mkupdates_2.txt  mkupdates_3.txt
  mv mkupdates_1.txt  mkupdates_2.txt
  mv mkupdates.txt    mkupdates_1.txt
)

