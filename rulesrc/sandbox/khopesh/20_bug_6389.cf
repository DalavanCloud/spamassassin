# from two sample FPs posted to bug 6389 (attachment 4721 and attachment 4730)

# just a raw numbers check:
header __HAS_XMIME_AUTOCONV exists:X-MIME-Autoconverted
tflags __HAS_XMIME_AUTOCONV nice

# John Wilcock's proposed subtitutions for __..._ENCODED_B64 (comment 8)
header __FROM_1BYTE_B64 From:raw =~ /=\?(?:iso-8859-1?\d|windows-125\d|koi-8r?)\?B\?/i 
header __SUBJ_1BYTE_B64 Subject:raw =~ /=\?(?:iso-8859-1?\d|windows-125\d|koi-8r?)\?B\?/i 

# possible fix to bug 6389
header __MIME_QP_TO_8BIT X-MIME-Autoconverted =~ /from quoted-printable to 8bit/
tflags __MIME_QP_TO_8BIT nice

meta DOS_HIGHBIT_HDRS_BODY_BUG6389 __FROM_NEEDS_MIME && __SUBJECT_ENCODED_B64 && __FROM_ENCODED_B64 && __SUBJECT_NEEDS_MIME && __HIGHBITS && !__MIME_QP_TO_8BIT

# Daryl O'Shea (DOS) + Adam Katz (KHOP) + John Wilcock version
meta FROM_SUBJ_BODY_8BIT __FROM_NEEDS_MIME && __SUBJ_1BYTE_B64 && __FROM_1BYTE_B64 && __SUBJECT_NEEDS_MIME && __HIGHBITS && !__MIME_QP_TO_8BIT

# assuming recipients won't also be highbit'd ("highbitten?")
header __TO_1BYTE_B64 To:raw =~ /=\?(?:iso-8859-1?\d|windows-125\d|koi-8r?)\?B\?/i 
meta FROM_SUBJ_NOTO_BODY_8BIT __FROM_NEEDS_MIME && __SUBJ_1BYTE_B64 && __FROM_1BYTE_B64 && __SUBJECT_NEEDS_MIME && __HIGHBITS && !__MIME_QP_TO_8BIT && !__TO_1BYTE_B64

# bug 6389 was closed with the rule removed as unfixable.  still, let's watch.
tflags DOS_HIGHBIT_HDRS_BODY_BUG6389 nopublish
tflags FROM_SUBJ_BODY_8BIT nopublish
tflags FROM_SUBJ_NOTO_BODY_8BIT nopublish
