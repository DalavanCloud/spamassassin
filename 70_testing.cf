# SpamAssassin rules file: rules under test, $Rev$
#
# This file is a placeholder for rules "under probation", i.e. checked into
# SVN for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
# <@LICENSE>
# Copyright 2004 Apache Software Foundation
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
#     http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# </@LICENSE>
#
########################################################################

# partial messages; currently-theoretical attack
# unsurprisingly this hits 0/0 right now.  But should we promote it anyway
# to protect against the possibility?
header T_FRAGMENTED_MESSAGE	Content-Type =~ /message\/partial/i

# I'm curious, may help explain more ALL_TRUSTED fps
body T_SA_MARKED_UP     /Spam detection software, running on the system /

########################################################################

# IADB
header __RCVD_IN_IADB		eval:check_rbl('iadb', 'iadb.isipp.com.')
tflags __RCVD_IN_IADB		net nice

header T_RCVD_IN_IADB_LIST	eval:check_rbl_sub('iadb', '127.0.0.1')
describe T_RCVD_IN_IADB_LIST	Sender is listed in ISIPP IADB
tflags T_RCVD_IN_IADB_LIST	net nice

# IADB trusted
header __RCVD_IN_IADB_T		eval:check_rbl('iadbt-firsttrusted', 'iadb.isipp.com.')
tflags __RCVD_IN_IADB_T		net nice

header T_RCVD_IN_IADB_LIST_T	eval:check_rbl_sub('iadbtr', '127.0.0.1')
describe T_RCVD_IN_IADB_LIST_T	Sender is listed in ISIPP IADB
tflags T_RCVD_IN_IADB_LIST_T	net nice

# two term ratio tests
header T_S2_S9_GT_4_80	eval:check_rbl_sub('senderbase', '(S2 / S9) > 4.80')
header T_S2_S9_GT_4_85	eval:check_rbl_sub('senderbase', '(S2 / S9) > 4.85')
header T_S2_S9_GT_4_90	eval:check_rbl_sub('senderbase', '(S2 / S9) > 4.90')
header T_S2_S9_GT_4_95	eval:check_rbl_sub('senderbase', '(S2 / S9) > 4.95')
header T_S2_S9_GT_5_00	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.00')
header T_S2_S9_GT_5_05	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.05')
header T_S2_S9_GT_5_10	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.10')
header T_S2_S9_GT_5_15	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.15')
header T_S2_S9_GT_5_20	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.20')
header T_S2_S9_GT_5_25	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.25')
header T_S2_S9_GT_5_30	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.30')
header T_S2_S9_GT_5_35	eval:check_rbl_sub('senderbase', '(S2 / S9) > 5.35')

header T_S2_S7_GT_7_10	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.10')
header T_S2_S7_GT_7_15	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.15')
header T_S2_S7_GT_7_20	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.20')
header T_S2_S7_GT_7_25	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.25')
header T_S2_S7_GT_7_30	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.30')
header T_S2_S7_GT_7_35	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.35')
header T_S2_S7_GT_7_40	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.40')
header T_S2_S7_GT_7_45	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.45')
header T_S2_S7_GT_7_50	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.50')
header T_S2_S7_GT_7_55	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.55')
header T_S2_S7_GT_7_60	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.60')
header T_S2_S7_GT_7_65	eval:check_rbl_sub('senderbase', '(S2 / S7) > 7.65')

header T_S3_S9_GT_4_80	eval:check_rbl_sub('senderbase', '(S3 / S9) > 4.80')
header T_S3_S9_GT_4_85	eval:check_rbl_sub('senderbase', '(S3 / S9) > 4.85')
header T_S3_S9_GT_4_90	eval:check_rbl_sub('senderbase', '(S3 / S9) > 4.90')
header T_S3_S9_GT_4_95	eval:check_rbl_sub('senderbase', '(S3 / S9) > 4.95')
header T_S3_S9_GT_5_00	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.00')
header T_S3_S9_GT_5_05	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.05')
header T_S3_S9_GT_5_10	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.10')
header T_S3_S9_GT_5_15	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.15')
header T_S3_S9_GT_5_20	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.20')
header T_S3_S9_GT_5_25	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.25')
header T_S3_S9_GT_5_30	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.30')
header T_S3_S9_GT_5_35	eval:check_rbl_sub('senderbase', '(S3 / S9) > 5.35')

# this appears to be the best of the two-term ratio tests
# S40 = IP daily magnitude
#  S9 = IP addresses used by this organization
header T_S40_S9_GT_4_80	eval:check_rbl_sub('senderbase', '(S40 / S9) > 4.80')
header T_S40_S9_GT_4_85	eval:check_rbl_sub('senderbase', '(S40 / S9) > 4.85')
header T_S40_S9_GT_4_90	eval:check_rbl_sub('senderbase', '(S40 / S9) > 4.90')
header T_S40_S9_GT_4_95	eval:check_rbl_sub('senderbase', '(S40 / S9) > 4.95')
header T_S40_S9_GT_5_00	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.00')
header T_S40_S9_GT_5_05	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.05')
header T_S40_S9_GT_5_10	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.10')
header T_S40_S9_GT_5_15	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.15')
header T_S40_S9_GT_5_20	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.20')
header T_S40_S9_GT_5_25	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.25')
header T_S40_S9_GT_5_30	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.30')
header T_S40_S9_GT_5_35	eval:check_rbl_sub('senderbase', '(S40 / S9) > 5.35')

header T_S41_S9_GT_4_60	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.60')
header T_S41_S9_GT_4_65	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.65')
header T_S41_S9_GT_4_70	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.70')
header T_S41_S9_GT_4_75	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.75')
header T_S41_S9_GT_4_80	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.80')
header T_S41_S9_GT_4_85	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.85')
header T_S41_S9_GT_4_90	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.90')
header T_S41_S9_GT_4_95	eval:check_rbl_sub('senderbase', '(S41 / S9) > 4.95')
header T_S41_S9_GT_5_00	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.00')
header T_S41_S9_GT_5_05	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.05')
header T_S41_S9_GT_5_10	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.10')
header T_S41_S9_GT_5_15	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.15')
header T_S41_S9_GT_5_20	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.20')
header T_S41_S9_GT_5_25	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.25')
header T_S41_S9_GT_5_30	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.30')
header T_S41_S9_GT_5_35	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.35')
header T_S41_S9_GT_5_40	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.40')
header T_S41_S9_GT_5_45	eval:check_rbl_sub('senderbase', '(S41 / S9) > 5.45')

# accounting for rounding, "> 0.2" means at least a 26% volume spike
header T_NSP_S41_42_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.2 && S40 - S41 > 0.2')
header T_NSP_S41_43_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.3 && S40 - S41 > 0.2')
header T_NSP_S41_44_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.4 && S40 - S41 > 0.2')
header T_NSP_S41_45_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.5 && S40 - S41 > 0.2')
header T_NSP_S41_46_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.6 && S40 - S41 > 0.2')
header T_NSP_S41_47_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.7 && S40 - S41 > 0.2')
header T_NSP_S41_48_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.8 && S40 - S41 > 0.2')
header T_NSP_S41_49_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.9 && S40 - S41 > 0.2')
header T_NSP_S41_50_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.0 && S40 - S41 > 0.2')
header T_NSP_S41_51_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.1 && S40 - S41 > 0.2')
header T_NSP_S41_52_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.2 && S40 - S41 > 0.2')
header T_NSP_S41_53_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.3 && S40 - S41 > 0.2')
header T_NSP_S41_54_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.4 && S40 - S41 > 0.2')
header T_NSP_S41_55_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.5 && S40 - S41 > 0.2')
header T_NSP_S41_56_02	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.6 && S40 - S41 > 0.2')

# accounting for rounding, "> 0.3" means at least a 59% volume spike
header T_NSP_S41_42_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.2 && S40 - S41 > 0.3')
header T_NSP_S41_43_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.3 && S40 - S41 > 0.3')
header T_NSP_S41_44_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.4 && S40 - S41 > 0.3')
header T_NSP_S41_45_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.5 && S40 - S41 > 0.3')
header T_NSP_S41_46_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.6 && S40 - S41 > 0.3')
header T_NSP_S41_47_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.7 && S40 - S41 > 0.3')
header T_NSP_S41_48_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.8 && S40 - S41 > 0.3')
header T_NSP_S41_49_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.9 && S40 - S41 > 0.3')
header T_NSP_S41_50_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.0 && S40 - S41 > 0.3')
header T_NSP_S41_51_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.1 && S40 - S41 > 0.3')
header T_NSP_S41_52_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.2 && S40 - S41 > 0.3')
header T_NSP_S41_53_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.3 && S40 - S41 > 0.3')
header T_NSP_S41_54_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.4 && S40 - S41 > 0.3')
header T_NSP_S41_55_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.5 && S40 - S41 > 0.3')
header T_NSP_S41_56_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 5.6 && S40 - S41 > 0.3')

tflags T_S2_S9_GT_4_80 net
tflags T_S2_S9_GT_4_85 net
tflags T_S2_S9_GT_4_90 net
tflags T_S2_S9_GT_4_95 net
tflags T_S2_S9_GT_5_00 net
tflags T_S2_S9_GT_5_05 net
tflags T_S2_S9_GT_5_10 net
tflags T_S2_S9_GT_5_15 net
tflags T_S2_S9_GT_5_20 net
tflags T_S2_S9_GT_5_25 net
tflags T_S2_S9_GT_5_30 net
tflags T_S2_S9_GT_5_35 net
tflags T_S2_S7_GT_7_10 net
tflags T_S2_S7_GT_7_15 net
tflags T_S2_S7_GT_7_20 net
tflags T_S2_S7_GT_7_25 net
tflags T_S2_S7_GT_7_30 net
tflags T_S2_S7_GT_7_35 net
tflags T_S2_S7_GT_7_40 net
tflags T_S2_S7_GT_7_45 net
tflags T_S2_S7_GT_7_50 net
tflags T_S2_S7_GT_7_55 net
tflags T_S2_S7_GT_7_60 net
tflags T_S2_S7_GT_7_65 net
tflags T_S3_S9_GT_4_80 net
tflags T_S3_S9_GT_4_85 net
tflags T_S3_S9_GT_4_90 net
tflags T_S3_S9_GT_4_95 net
tflags T_S3_S9_GT_5_00 net
tflags T_S3_S9_GT_5_05 net
tflags T_S3_S9_GT_5_10 net
tflags T_S3_S9_GT_5_15 net
tflags T_S3_S9_GT_5_20 net
tflags T_S3_S9_GT_5_25 net
tflags T_S3_S9_GT_5_30 net
tflags T_S3_S9_GT_5_35 net
tflags T_S40_S9_GT_4_80 net
tflags T_S40_S9_GT_4_85 net
tflags T_S40_S9_GT_4_90 net
tflags T_S40_S9_GT_4_95 net
tflags T_S40_S9_GT_5_00 net
tflags T_S40_S9_GT_5_05 net
tflags T_S40_S9_GT_5_10 net
tflags T_S40_S9_GT_5_15 net
tflags T_S40_S9_GT_5_20 net
tflags T_S40_S9_GT_5_25 net
tflags T_S40_S9_GT_5_30 net
tflags T_S40_S9_GT_5_35 net
tflags T_S41_S9_GT_4_60 net
tflags T_S41_S9_GT_4_65 net
tflags T_S41_S9_GT_4_70 net
tflags T_S41_S9_GT_4_75 net
tflags T_S41_S9_GT_4_80 net
tflags T_S41_S9_GT_4_85 net
tflags T_S41_S9_GT_4_90 net
tflags T_S41_S9_GT_4_95 net
tflags T_S41_S9_GT_5_00 net
tflags T_S41_S9_GT_5_05 net
tflags T_S41_S9_GT_5_10 net
tflags T_S41_S9_GT_5_15 net
tflags T_S41_S9_GT_5_20 net
tflags T_S41_S9_GT_5_25 net
tflags T_S41_S9_GT_5_30 net
tflags T_S41_S9_GT_5_35 net
tflags T_S41_S9_GT_5_40 net
tflags T_S41_S9_GT_5_45 net
tflags T_NSP_S41_42_02 net
tflags T_NSP_S41_43_02 net
tflags T_NSP_S41_44_02 net
tflags T_NSP_S41_45_02 net
tflags T_NSP_S41_46_02 net
tflags T_NSP_S41_47_02 net
tflags T_NSP_S41_48_02 net
tflags T_NSP_S41_49_02 net
tflags T_NSP_S41_50_02 net
tflags T_NSP_S41_51_02 net
tflags T_NSP_S41_52_02 net
tflags T_NSP_S41_53_02 net
tflags T_NSP_S41_54_02 net
tflags T_NSP_S41_55_02 net
tflags T_NSP_S41_56_02 net
tflags T_NSP_S41_42_03 net
tflags T_NSP_S41_43_03 net
tflags T_NSP_S41_44_03 net
tflags T_NSP_S41_45_03 net
tflags T_NSP_S41_46_03 net
tflags T_NSP_S41_47_03 net
tflags T_NSP_S41_48_03 net
tflags T_NSP_S41_49_03 net
tflags T_NSP_S41_50_03 net
tflags T_NSP_S41_51_03 net
tflags T_NSP_S41_52_03 net
tflags T_NSP_S41_53_03 net
tflags T_NSP_S41_54_03 net
tflags T_NSP_S41_55_03 net
tflags T_NSP_S41_56_03 net

########################################################################

# let's see how this works
meta T_SPF_PASS_NO_SBL		(SPF_PASS && !RCVD_IN_SBL)
meta T_SPF_HELO_PASS_NO_SBL	(SPF_HELO_PASS && !RCVD_IN_SBL)
tflags T_SPF_PASS_NO_SBL	net nice
tflags T_SPF_HELO_PASS_NO_SBL	net nice

# long-term test
# IP-based volume and date of first email might be better considering
# that SBL is a domain blacklist, but this is a start
header __SENDERBASE_VOL_SPIKE	eval:check_rbl_sub('senderbase', 'S23 > S24 + 1')
header __SENDERBASE_45_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 45*86400)')
header __SENDERBASE_90_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 90*86400)')
header __SENDERBASE_180_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 180*86400)')
header __SENDERBASE_360_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 360*86400)')
meta T_SPF_PASS_NO_SBL_45D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_45_DAYS)
meta T_SPF_PASS_NO_SBL_90D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_90_DAYS)
meta T_SPF_PASS_NO_SBL_180D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_180_DAYS)
meta T_SPF_PASS_NO_SBL_360D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_360_DAYS)
tflags T_SPF_PASS_NO_SBL_45D net nice
tflags T_SPF_PASS_NO_SBL_90D net nice
tflags T_SPF_PASS_NO_SBL_180D net nice
tflags T_SPF_PASS_NO_SBL_360D net nice

# Carl Hutzler of AOL says: "block on sight" (mail sent 07 May 2004 to discuss
# at lists.surbl.org).  not much hits for me, but let's see for everyone else
uri T_REDIR_AOL_CLICKTHRU     /www\.aol\.com\/ams\/clickThruRedirect\.adp/i

# Suresh says: these will never be used as HELOs from real mail.com relays.
# Just check the most recent handover; the connection to a trusted host.
# This way a legit sender can send to their MSA using that HELO (quite a few
# MUAs will do that), but a spammer gets caught.  (List of domains comes from
# the drop-down list on the Mail.com signup page.)
header T_FAKE_HELO_MAIL_COM_DOM  X-Spam-Relays-Untrusted =~ /^[^\]]+ helo=(?:\S+\.|)(?:(?:mail|email|iname|cheerful|consultant|europe|mindless|myself|post|techie|usa|writeme|2die4|artlover|bikerider|catlover|cliffhanger|cutey|doglover|gardener|hot-shot|inorbit|loveable|mad\.scientist|playful|poetic|popstar|saintly|seductive|soon|whoever|winning|witty|yours|africamail|arcticmail|asia|australiamail|europe|japan|samerica|usa|berlin|dublin|london|madrid|moscowmail|munich|nycmail|paris|rome|sanfranmail|singapore|tokyo|accountant|adexec|allergist|alumnidirector|archaeologist|chemist|clerk|columnist|comic|consultant|counsellor|deliveryman|diplomats|doctor|dr|engineer|execs|financier|geologist|graphic-designer|insurer|journalist|lawyer|legislator|lobbyist|minister|optician|pediatrician|presidency|priest|publicist|realtyagent|registerednurses|repairman|representative|rescueteam|scientist|sociologist|teacher|techietechnologist|umpire)\.com|(?:programmer|earthling|hairdresser)\.net|musician\.org) /i
header T_FAKE_HELO_MAIL_COM_DOM2  X-Spam-Relays-Untrusted =~ /^[^\]]+ helo=(?:(?:mail|email|iname|cheerful|consultant|europe|mindless|myself|post|techie|usa|writeme|2die4|artlover|bikerider|catlover|cliffhanger|cutey|doglover|gardener|hot-shot|inorbit|loveable|mad\.scientist|playful|poetic|popstar|saintly|seductive|soon|whoever|winning|witty|yours|africamail|arcticmail|asia|australiamail|europe|japan|samerica|usa|berlin|dublin|london|madrid|moscowmail|munich|nycmail|paris|rome|sanfranmail|singapore|tokyo|accountant|adexec|allergist|alumnidirector|archaeologist|chemist|clerk|columnist|comic|consultant|counsellor|deliveryman|diplomats|doctor|dr|engineer|execs|financier|geologist|graphic-designer|insurer|journalist|lawyer|legislator|lobbyist|minister|optician|pediatrician|presidency|priest|publicist|realtyagent|registerednurses|repairman|representative|rescueteam|scientist|sociologist|teacher|techietechnologist|umpire)\.com|(?:programmer|earthling|hairdresser)\.net|musician\.org) /i

# cream of the rules removed from old releases, may need some work
body T_GREAT_OFFER_A		/offer expires/i
body T_GREAT_OFFER_B		/see full offer for details/i
body T_GREAT_OFFER_C		/great offer/i
body T_SAVE_BUCKS		/\bsave \$/i

# concept: you have a choice + something great
body T_OFFER_BY_CHOICE_1	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_2	/\b(?:wish|want|question|unsub\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_3	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_4	/\b(?:wish|want|question|unsub\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_5	/\b(?:wish|want|question|unsubscrib\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_6	/\b(?:wish|want|question|unsub\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_7	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_8	/\b(?:wish|want|question|unsub\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_9	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_10	/\b(?:wish|want|question|unsub\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_11	/\b(?:wish|want|question|unsubscrib\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_12	/\b(?:wish|want|question|unsub\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_13	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_14	/\b(?:wish|want|question|unsub\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_15	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_16	/\b(?:wish|want|question|unsub\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_17	/\b(?:wish|want|question|unsubscrib\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_18	/\b(?:wish|want|question|unsub\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i

# Added a few more versions and removed some old ones
header T_MANY_MX_4 From:addr =~ /\@mx\d{2,4}\..{1,30}\./i
header T_MANY_MX_5 From:addr =~ /\@mx\d{2,4}\..{1,20}\./i
header T_MANY_MX_6 From:addr =~ /\@mx\d+\..{1,30}\./i
header T_MANY_MX_7 From:addr =~ /\@\w\d+\..{1,30}\./i
header T_MANY_MX_8 From:addr =~ /\@\w\d+/i

# fix malformed rules "broken" by change in HTML whitespace processing
body T_DEAR_FRIEND_1	/^\s*Dear Friend\b/i
body T_DEAR_FRIEND_2	/^\s?Dear Friend\b/i
rawbody T_DEAR_FRIEND_3	/^Dear Friend\b/i
rawbody T_DEAR_FRIEND_4	/^\s*Dear Friend\b/i
rawbody T_DEAR_FRIEND_5	/^\s?Dear Friend\b/i

body T_OBSCURED_EMAIL_1		/^\s*\w+\^\S+\(\w{2,3}\b/m
body T_OBSCURED_EMAIL_2		/^\s?\w+\^\S+\(\w{2,3}\b/m
rawbody T_OBSCURED_EMAIL_3	/^\w+\^\S+\(\w{2,3}\b/m
rawbody T_OBSCURED_EMAIL_4	/^\s*\w+\^\S+\(\w{2,3}\b/m
rawbody T_OBSCURED_EMAIL_5	/^\s?\w+\^\S+\(\w{2,3}\b/m

body T_TRACKER_ID_1	/^\s*[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
body T_TRACKER_ID_2	/^\s?[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
rawbody T_TRACKER_ID_3	/^[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
rawbody T_TRACKER_ID_4	/^\s*[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
rawbody T_TRACKER_ID_5	/^\s?[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is

# tweak rule to potentially improve RANK
body T_DOMAIN_RATIO_20	eval:check_domain_ratio('0.020')
body T_DOMAIN_RATIO_21	eval:check_domain_ratio('0.021')
body T_DOMAIN_RATIO_22	eval:check_domain_ratio('0.022')
body T_DOMAIN_RATIO_23	eval:check_domain_ratio('0.023')
body T_DOMAIN_RATIO_24	eval:check_domain_ratio('0.024')
body T_DOMAIN_RATIO_25	eval:check_domain_ratio('0.025')
#
body T_DOMAIN_RATIO_27	eval:check_domain_ratio('0.027')
body T_DOMAIN_RATIO_28	eval:check_domain_ratio('0.028')
body T_DOMAIN_RATIO_29	eval:check_domain_ratio('0.029')
body T_DOMAIN_RATIO_30	eval:check_domain_ratio('0.030')
body T_DOMAIN_RATIO_31	eval:check_domain_ratio('0.031')
body T_DOMAIN_RATIO_32	eval:check_domain_ratio('0.032')

# Bug 3374
body             T_DRUG_DOLLAR_DOSE    m{\$?\s*(?:\d|\.)+\s*\$?\s*(?:\\|/|per)\s*d.?o.?s.?e}i
describe         T_DRUG_DOLLAR_DOSE    Talks about price per dose.
lang nl describe T_DRUG_DOLLAR_DOSE    Heeft het over een prijs per dosis.
# Safer alternative for 3374
body T__DRUG_DOLLAR_DOSE_A m{\$\s*(?:\d|\.)+\s*(?:\\|/|per)\s*d.?o.?s.?e}i
body T__DRUG_DOLLAR_DOSE_B m{(?:\d|\.)+\s*\$\s*(?:\\|/|per)\s*d.?o.?s.?e}i
meta T_DRUG_DOLLAR_DOSE_C     T__DRUG_DOLLAR_DOSE_A || T__DRUG_DOLLAR_DOSE_B

# Bug 3349, rule written by yackley
header T_FAKE_MS_XMIME X-MimeOLE =~ /mircosoft/i

# Test rules for 419 & lottery fraud, a bit bloated at the moment
body T__FRAUD_BADTHINGS /(?:all funds will be returned|ass?ylum|assassinate|(?:auto|boat|car|plane|train).{1,7}(?:crash|accident|disaster|wreck)|before they both died|brutal acts|cancer|coup attempt|disease|due to the current|\bexile\b|\bfle[ed]\b|have been frozen|impeach|\bkilled|land dispute|murder|over-invoice|political crisis|poisoned (?:to death )?by|relocate|since the demise|\bslay\b)/i
body T__FRAUD_DPTCOMPNY /(?:allied irish bank|amsterdam clearing office|(?:bank|government) (of )?nigeria|charity organization|commerce world directory|correspondent branch|department of mineral resources and energy|diamond safari|embassy|finance and accounts director of inec|foreign contract tenders committee|global oil corporation|international (?:bank|court of justice)|mainland investment trust bank|mining corporation|ministry of (?:oil (?:and )?mini?eral|organisation worldwide|petroleum and natural resources|urban and rural development)|nigerian national petroleum|prize award dept|(?:finance|holding|securit(?:ies|y)) (?:company|firm|storage house)|sierra leone mining)/i
body T__FRAUD_INTRO /(?:(?:may i first|to) introduce my ?self|contact address|i am contacting you)/i
body T__FRAUD_REPLY /(?:confidential email|my secure email address|reply (?:me only|urgent)|(?:immediate|swift|urgent) (?:assist|reply|response))/i
body T__FRAUD_LOC /\s(?:abidjan|algeria|angola|benin republic|bangladesh|botswana|c.te .{0,2}ivoire|congo|dubai|gabon|ghana|kogi|lagos|liberia|libya|malaysia|nigerian?|phill?ipp?ine.|qatar|republic.du.benin|republic.of.sahara|saharawi|senegal|sierra.leone|solomon islands|south.africa|togo(?:lese)?|u\.a\.e\.i\.|zimbabwe)\s/i
body T__FRAUD_MISC /(?:a native of|as the beneficiary|compliments? of the season|confidentiality and professionalism|eagerly await|of (?:the|my) late|on information gathered about you|(?:relate|share) my testimony|remains unclaimed|several attempts have been made with out success|very big risk|you and your company|youre? country)/i
body T__FRAUD_MONEY /(?:abandoned sum|(?:huge|substantial) amount of m[o0]ney|(?:transfer this fund|money transfer|transfer money)|(?:will share the money|your share.{1,10}(?:shall|sum|total|money|funds))|assets have been confiscated|be paid to you|claim a sum of|(?:claim|concerning) (?:the|this) money|family asset|foreign (?:offshore )?(?:bank|account)|how the money will be split|kick.{0,2}back|million usd|offer you a generous compensation|personal bank account|remains unclaimed|secure.{1,10}funds|the total sum|transferring (of|the) funds?|us.{1,9}million|win cash|you are.{0,8}winner|your (?:pr[i1]ze|share shall be))/i
body T__FRAUD_PAPERWORK /(?:all necessary legal documents|covering documents|international passport|legal official protocol|letter of authority|Next of Kin Payment Application Form|provide immediately|writing this letter to solicit|vital documents)/i
body T__FRAUD_VIPS /(?:(?:white|black|zimbabwean) farmers?|auditor general|(?:former|late) (?:president of|.{0,20}minister)|head of state|nigerian gov|president of (the )?phillipine|principal advocate)/i
body T__FRAUD_FOREIGN /(?:(?:who was a|as a|an? honest|you being a|to any) foreigner|foreign (?:business partner|customer))/i
body T__FRAUD_BARRISTR /(?:accredited agent|adviser to late|barrister|fiduciary agent|i am a private investigator|personal attorney to|relationship officer|solicit[oe]r)/i
body T__FRAUD_FAMILY /(?:my late (?:husband|wife|brother|uncle|aunt|father|mother) (?:was|is|had|has)|locate(?: .{1,20})? extended relative|next of kin|the (?:eldest|oldest|youngest|first) son|the (?:wife|heir) (?:to|of))/i
body T__FRAUD_RELIGION /(?:almighty god|as a born again christian|as a minister|call a prayer line|calvary greeting|eternity is a long t[io]me|fear of god|g[ai]ve.{1,15}life to christ|glorify god'?s name|god (?:has|have|will) forgiven? me|god gives .{1,10}second chance|god want(?:ed|s)? it|goodday pastor|hear from god|if you\'?re? not saved|in the (?:lord'?s name|name of (?:our|the) lord)|jesus is yours|money.{1,15}give.{1,15}ministry|new christian convert|pray daily|read(?:ing)? (?:the|your) bible|sinful habits|spend (?:.{1,20})in hell|the wish of god|true christian|wealth to god|your ministry)/i
body T__FRAUD_TINHORN /\s(?:abacha|abubakar|ajobola|anigala|arap moi|aziz|bubenik|ewaen|gebarel|gezi|guei|gumbeze|ibiam|kabbahs|kabila|kamara|kazeem|margai|massaquoi|mbeki|mobutu|momoh|mubune|mugabe|obasanjo|okafor|olonga|olumuyiwa|omo(?:nigho|rodion)|rilwanu|savimbi|seko|tarlor|taylor|zaid|zwinginna)\s/i
body T__FRAUD_TRUST /(?:(?:total(?:ly)?|very|strict(?:ly|est)|high(?:est|ly)?|intuitive|utmost) confiden(?:ce|t(?:ai|ia)l)|code of conduct|confidential (?:communications|telephone numbers)|(?:honest|honourable) (?:cooperation|partnership)|keep this matter|mutual understanding|reliable person|secrecy and confidentiality|secretly deposited|smooth transaction|to (?:assure you|redeem)|(?:the importance of|utmost) secrecy|transaction is .{1,15} risk free.|transparent honesty|trust (?:and|&) confidentiality|very honest person|your assurance)/i
body T__FRAUD_AGREE /(?:(?:(?:negotiate|reasonable|acc?or?ding|certain|agg?ree).{1,20}percentage|percentage.{1,10}(?:indicat|previous|involved)|favou?rable response|your percentage will)|my proposal is acceptable|acceptable by you|purposes within your country|total acceptance and commitment)/i
body T__FRAUD_LOTTERY /(?:(?:international|luckyday|overseas stake|promo|world) lott(?:o|ery)|lott(?:o|ery) (?:co,?ordinator|international)|intl loteria|prize transfer agent|scientific game promo|award notification)/i
body T__FRAUD_PROPOSE /(?:urgent and(?: very)? (?:profitable|confidential) business (?:proposal|proposition)|(?:financial|confiden(?:tial|ce)|safe|mutual|secret|success|risk-?free|details|business).{1,30}\btransaction|transaction\b.{1,30}\b(?:magnitude|diplomatic|strict|absolute|secret|confiden(?:tial|ce)|guarantee))/i
body T__FRAUD_CONTACT /(?:your full names?,?(?:and|&)? full contact address|your(?: private)? (?:tele)?phone (?:and|&) fax numbers?|send .{1,30}\byour telefax numbers?)/i
body T__FRAUD_FUNWORDS /(?:actualization|arising contigencies|bequest|discursions|magnanimity|modalities|non response|numbered time|(?:should|please) endeavor|receivership)/i
body T__FRAUD_LOTTERY2 /(?:attached to ticket number|computer ballot system|drawn  ?from.{0,10}\d{2,3},?\d{3}|second categories)/i
body T__FRAUD_REFNUM /reff?\.?(?: number|no)? ?\:/i
meta     T_FRAUD_X3 ((T__FRAUD_BADTHINGS + T__FRAUD_DPTCOMPNY + T__FRAUD_INTRO + T__FRAUD_LOC + T__FRAUD_MONEY + T__FRAUD_PAPERWORK + T__FRAUD_VIPS + T__FRAUD_RELIGION + T__FRAUD_TINHORN + T__FRAUD_TRUST + T__FRAUD_AGREE + T__FRAUD_REPLY + T__FRAUD_FAMILY + T__FRAUD_LOTTERY + T__FRAUD_BARRISTER + T__FRAUD_FOREIGN + T__FRAUD_PROPOSE + T__FRAUD_CONTACT + T__FRAUD_FUNWORDS + T__FRAUD_LOTTERY2 + T__FRAUD_REFNUM) > 2)
describe T_FRAUD_X3 Matches 3+ phrases commonly used in fraud spam
meta     T_FRAUD_X4 ((T__FRAUD_BADTHINGS + T__FRAUD_DPTCOMPNY + T__FRAUD_INTRO + T__FRAUD_LOC + T__FRAUD_MONEY + T__FRAUD_PAPERWORK + T__FRAUD_VIPS + T__FRAUD_RELIGION + T__FRAUD_TINHORN + T__FRAUD_TRUST + T__FRAUD_AGREE + T__FRAUD_REPLY + T__FRAUD_FAMILY + T__FRAUD_LOTTERY + T__FRAUD_BARRISTER + T__FRAUD_FOREIGN + T__FRAUD_PROPOSE + T__FRAUD_CONTACT + T__FRAUD_FUNWORDS + T__FRAUD_LOTTERY2 + T__FRAUD_REFNUM) > 3)
describe T_FRAUD_X4 Matches 4+ phrases commonly used in fraud spam
meta     T_FRAUD_X5 ((T__FRAUD_BADTHINGS + T__FRAUD_DPTCOMPNY + T__FRAUD_INTRO + T__FRAUD_LOC + T__FRAUD_MONEY + T__FRAUD_PAPERWORK + T__FRAUD_VIPS + T__FRAUD_RELIGION + T__FRAUD_TINHORN + T__FRAUD_TRUST + T__FRAUD_AGREE + T__FRAUD_REPLY + T__FRAUD_FAMILY + T__FRAUD_LOTTERY + T__FRAUD_BARRISTER + T__FRAUD_FOREIGN + T__FRAUD_PROPOSE + T__FRAUD_CONTACT + T__FRAUD_FUNWORDS + T__FRAUD_LOTTERY2 + T__FRAUD_REFNUM) > 4)
describe T_FRAUD_X5 Matches 5+ phrases commonly used in fraud spam
meta     T_FRAUD_X6 ((T__FRAUD_BADTHINGS + T__FRAUD_DPTCOMPNY + T__FRAUD_INTRO + T__FRAUD_LOC + T__FRAUD_MONEY + T__FRAUD_PAPERWORK + T__FRAUD_VIPS + T__FRAUD_RELIGION + T__FRAUD_TINHORN + T__FRAUD_TRUST + T__FRAUD_AGREE + T__FRAUD_REPLY + T__FRAUD_FAMILY + T__FRAUD_LOTTERY + T__FRAUD_BARRISTER + T__FRAUD_FOREIGN + T__FRAUD_PROPOSE + T__FRAUD_CONTACT + T__FRAUD_FUNWORDS + T__FRAUD_LOTTERY2 + T__FRAUD_REFNUM) > 5)
describe T_FRAUD_X6 Matches 6+ phrases commonly used in fraud spam
