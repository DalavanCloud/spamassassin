# SpamAssassin rules file: rules under test, $Rev$
#
# This file is a placeholder for rules "under probation", i.e. checked into
# SVN for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
# <@LICENSE>
# Copyright 2004 Apache Software Foundation
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
#     http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# </@LICENSE>
#
########################################################################

########################################################################
# rules to detect certain generally unnecessary encodings in HTML

# newline, space
rawbody T_ENTITY_SPACE_1	/\&\#(?:10|32)\;/
rawbody T_ENTITY_SPACE_2	/\&\#0*(?:10|32)\;/
# tab, newline, space
rawbody T_ENTITY_SPACE_3	/\&\#(?:9|10|32)\;/
rawbody T_ENTITY_SPACE_4	/\&\#0*(?:9|10|32)\;/

# 0-9, A-Z, or a-z
rawbody T_ENTITY_ALPHANUM_1	/\&\#(?:4[89]|5[0-7]|6[5-9][78]\d|9[0789]|1[01]\d|12[012])\;/
rawbody T_ENTITY_ALPHANUM_2	/\&\#0*(?:4[89]|5[0-7]|6[5-9][78]\d|9[0789]|1[01]\d|12[012])\;/

# . /
rawbody T_ENTITY_OTHER_1	/\&\#(?:46|47)\;/
rawbody T_ENTITY_OTHER_2	/\&\#0*(?:46|47)\;/
# ! ' ( . / ]
rawbody T_ENTITY_OTHER_3	/\&\#(?:33|39|40|46|47)\;/
rawbody T_ENTITY_OTHER_4	/\&\#0*(?:33|39|40|46|47)\;/

# test for leading zeroes
rawbody T_ENTITY_ZEROES		/\&\#0+[1-9]\d*\;/

# test all one byte characters except for 0-9 A-Z a-z
rawbody T_ENTITY_DEC_0		/\&\#0\;/
rawbody T_ENTITY_DEC_1		/\&\#1\;/
rawbody T_ENTITY_DEC_2		/\&\#2\;/
rawbody T_ENTITY_DEC_3		/\&\#3\;/
rawbody T_ENTITY_DEC_4		/\&\#4\;/
rawbody T_ENTITY_DEC_5		/\&\#5\;/
rawbody T_ENTITY_DEC_6		/\&\#6\;/
rawbody T_ENTITY_DEC_7		/\&\#7\;/
rawbody T_ENTITY_DEC_8		/\&\#8\;/
rawbody T_ENTITY_DEC_9		/\&\#9\;/
rawbody T_ENTITY_DEC_10		/\&\#10\;/
rawbody T_ENTITY_DEC_11		/\&\#11\;/
rawbody T_ENTITY_DEC_12		/\&\#12\;/
rawbody T_ENTITY_DEC_13		/\&\#13\;/
rawbody T_ENTITY_DEC_14		/\&\#14\;/
rawbody T_ENTITY_DEC_15		/\&\#15\;/
rawbody T_ENTITY_DEC_16		/\&\#16\;/
rawbody T_ENTITY_DEC_17		/\&\#17\;/
rawbody T_ENTITY_DEC_18		/\&\#18\;/
rawbody T_ENTITY_DEC_19		/\&\#19\;/
rawbody T_ENTITY_DEC_20		/\&\#20\;/
rawbody T_ENTITY_DEC_21		/\&\#21\;/
rawbody T_ENTITY_DEC_22		/\&\#22\;/
rawbody T_ENTITY_DEC_23		/\&\#23\;/
rawbody T_ENTITY_DEC_24		/\&\#24\;/
rawbody T_ENTITY_DEC_25		/\&\#25\;/
rawbody T_ENTITY_DEC_26		/\&\#26\;/
rawbody T_ENTITY_DEC_27		/\&\#27\;/
rawbody T_ENTITY_DEC_28		/\&\#28\;/
rawbody T_ENTITY_DEC_29		/\&\#29\;/
rawbody T_ENTITY_DEC_30		/\&\#30\;/
rawbody T_ENTITY_DEC_31		/\&\#31\;/
rawbody T_ENTITY_DEC_32		/\&\#32\;/
rawbody T_ENTITY_DEC_33		/\&\#33\;/
rawbody T_ENTITY_DEC_34		/\&\#34\;/
rawbody T_ENTITY_DEC_35		/\&\#35\;/
rawbody T_ENTITY_DEC_36		/\&\#36\;/
rawbody T_ENTITY_DEC_37		/\&\#37\;/
rawbody T_ENTITY_DEC_38		/\&\#38\;/
rawbody T_ENTITY_DEC_39		/\&\#39\;/
rawbody T_ENTITY_DEC_40		/\&\#40\;/
rawbody T_ENTITY_DEC_41		/\&\#41\;/
rawbody T_ENTITY_DEC_42		/\&\#42\;/
rawbody T_ENTITY_DEC_43		/\&\#43\;/
rawbody T_ENTITY_DEC_44		/\&\#44\;/
rawbody T_ENTITY_DEC_45		/\&\#45\;/
rawbody T_ENTITY_DEC_46		/\&\#46\;/
rawbody T_ENTITY_DEC_47		/\&\#47\;/
rawbody T_ENTITY_DEC_58		/\&\#58\;/
rawbody T_ENTITY_DEC_59		/\&\#59\;/
rawbody T_ENTITY_DEC_60		/\&\#60\;/
rawbody T_ENTITY_DEC_61		/\&\#61\;/
rawbody T_ENTITY_DEC_62		/\&\#62\;/
rawbody T_ENTITY_DEC_63		/\&\#63\;/
rawbody T_ENTITY_DEC_64		/\&\#64\;/
rawbody T_ENTITY_DEC_91		/\&\#91\;/
rawbody T_ENTITY_DEC_92		/\&\#92\;/
rawbody T_ENTITY_DEC_93		/\&\#93\;/
rawbody T_ENTITY_DEC_94		/\&\#94\;/
rawbody T_ENTITY_DEC_95		/\&\#95\;/
rawbody T_ENTITY_DEC_96		/\&\#96\;/
rawbody T_ENTITY_DEC_123		/\&\#123\;/
rawbody T_ENTITY_DEC_124		/\&\#124\;/
rawbody T_ENTITY_DEC_125		/\&\#125\;/
rawbody T_ENTITY_DEC_126		/\&\#126\;/
rawbody T_ENTITY_DEC_127		/\&\#127\;/
rawbody T_ENTITY_DEC_128		/\&\#128\;/
rawbody T_ENTITY_DEC_129		/\&\#129\;/
rawbody T_ENTITY_DEC_130		/\&\#130\;/
rawbody T_ENTITY_DEC_131		/\&\#131\;/
rawbody T_ENTITY_DEC_132		/\&\#132\;/
rawbody T_ENTITY_DEC_133		/\&\#133\;/
rawbody T_ENTITY_DEC_134		/\&\#134\;/
rawbody T_ENTITY_DEC_135		/\&\#135\;/
rawbody T_ENTITY_DEC_136		/\&\#136\;/
rawbody T_ENTITY_DEC_137		/\&\#137\;/
rawbody T_ENTITY_DEC_138		/\&\#138\;/
rawbody T_ENTITY_DEC_139		/\&\#139\;/
rawbody T_ENTITY_DEC_140		/\&\#140\;/
rawbody T_ENTITY_DEC_141		/\&\#141\;/
rawbody T_ENTITY_DEC_142		/\&\#142\;/
rawbody T_ENTITY_DEC_143		/\&\#143\;/
rawbody T_ENTITY_DEC_144		/\&\#144\;/
rawbody T_ENTITY_DEC_145		/\&\#145\;/
rawbody T_ENTITY_DEC_146		/\&\#146\;/
rawbody T_ENTITY_DEC_147		/\&\#147\;/
rawbody T_ENTITY_DEC_148		/\&\#148\;/
rawbody T_ENTITY_DEC_149		/\&\#149\;/
rawbody T_ENTITY_DEC_150		/\&\#150\;/
rawbody T_ENTITY_DEC_151		/\&\#151\;/
rawbody T_ENTITY_DEC_152		/\&\#152\;/
rawbody T_ENTITY_DEC_153		/\&\#153\;/
rawbody T_ENTITY_DEC_154		/\&\#154\;/
rawbody T_ENTITY_DEC_155		/\&\#155\;/
rawbody T_ENTITY_DEC_156		/\&\#156\;/
rawbody T_ENTITY_DEC_157		/\&\#157\;/
rawbody T_ENTITY_DEC_158		/\&\#158\;/
rawbody T_ENTITY_DEC_159		/\&\#159\;/
rawbody T_ENTITY_DEC_160		/\&\#160\;/
rawbody T_ENTITY_DEC_161		/\&\#161\;/
rawbody T_ENTITY_DEC_162		/\&\#162\;/
rawbody T_ENTITY_DEC_163		/\&\#163\;/
rawbody T_ENTITY_DEC_164		/\&\#164\;/
rawbody T_ENTITY_DEC_165		/\&\#165\;/
rawbody T_ENTITY_DEC_166		/\&\#166\;/
rawbody T_ENTITY_DEC_167		/\&\#167\;/
rawbody T_ENTITY_DEC_168		/\&\#168\;/
rawbody T_ENTITY_DEC_169		/\&\#169\;/
rawbody T_ENTITY_DEC_170		/\&\#170\;/
rawbody T_ENTITY_DEC_171		/\&\#171\;/
rawbody T_ENTITY_DEC_172		/\&\#172\;/
rawbody T_ENTITY_DEC_173		/\&\#173\;/
rawbody T_ENTITY_DEC_174		/\&\#174\;/
rawbody T_ENTITY_DEC_175		/\&\#175\;/
rawbody T_ENTITY_DEC_176		/\&\#176\;/
rawbody T_ENTITY_DEC_177		/\&\#177\;/
rawbody T_ENTITY_DEC_178		/\&\#178\;/
rawbody T_ENTITY_DEC_179		/\&\#179\;/
rawbody T_ENTITY_DEC_180		/\&\#180\;/
rawbody T_ENTITY_DEC_181		/\&\#181\;/
rawbody T_ENTITY_DEC_182		/\&\#182\;/
rawbody T_ENTITY_DEC_183		/\&\#183\;/
rawbody T_ENTITY_DEC_184		/\&\#184\;/
rawbody T_ENTITY_DEC_185		/\&\#185\;/
rawbody T_ENTITY_DEC_186		/\&\#186\;/
rawbody T_ENTITY_DEC_187		/\&\#187\;/
rawbody T_ENTITY_DEC_188		/\&\#188\;/
rawbody T_ENTITY_DEC_189		/\&\#189\;/
rawbody T_ENTITY_DEC_190		/\&\#190\;/
rawbody T_ENTITY_DEC_191		/\&\#191\;/
rawbody T_ENTITY_DEC_192		/\&\#192\;/
rawbody T_ENTITY_DEC_193		/\&\#193\;/
rawbody T_ENTITY_DEC_194		/\&\#194\;/
rawbody T_ENTITY_DEC_195		/\&\#195\;/
rawbody T_ENTITY_DEC_196		/\&\#196\;/
rawbody T_ENTITY_DEC_197		/\&\#197\;/
rawbody T_ENTITY_DEC_198		/\&\#198\;/
rawbody T_ENTITY_DEC_199		/\&\#199\;/
rawbody T_ENTITY_DEC_200		/\&\#200\;/
rawbody T_ENTITY_DEC_201		/\&\#201\;/
rawbody T_ENTITY_DEC_202		/\&\#202\;/
rawbody T_ENTITY_DEC_203		/\&\#203\;/
rawbody T_ENTITY_DEC_204		/\&\#204\;/
rawbody T_ENTITY_DEC_205		/\&\#205\;/
rawbody T_ENTITY_DEC_206		/\&\#206\;/
rawbody T_ENTITY_DEC_207		/\&\#207\;/
rawbody T_ENTITY_DEC_208		/\&\#208\;/
rawbody T_ENTITY_DEC_209		/\&\#209\;/
rawbody T_ENTITY_DEC_210		/\&\#210\;/
rawbody T_ENTITY_DEC_211		/\&\#211\;/
rawbody T_ENTITY_DEC_212		/\&\#212\;/
rawbody T_ENTITY_DEC_213		/\&\#213\;/
rawbody T_ENTITY_DEC_214		/\&\#214\;/
rawbody T_ENTITY_DEC_215		/\&\#215\;/
rawbody T_ENTITY_DEC_216		/\&\#216\;/
rawbody T_ENTITY_DEC_217		/\&\#217\;/
rawbody T_ENTITY_DEC_218		/\&\#218\;/
rawbody T_ENTITY_DEC_219		/\&\#219\;/
rawbody T_ENTITY_DEC_220		/\&\#220\;/
rawbody T_ENTITY_DEC_221		/\&\#221\;/
rawbody T_ENTITY_DEC_222		/\&\#222\;/
rawbody T_ENTITY_DEC_223		/\&\#223\;/
rawbody T_ENTITY_DEC_224		/\&\#224\;/
rawbody T_ENTITY_DEC_225		/\&\#225\;/
rawbody T_ENTITY_DEC_226		/\&\#226\;/
rawbody T_ENTITY_DEC_227		/\&\#227\;/
rawbody T_ENTITY_DEC_228		/\&\#228\;/
rawbody T_ENTITY_DEC_229		/\&\#229\;/
rawbody T_ENTITY_DEC_230		/\&\#230\;/
rawbody T_ENTITY_DEC_231		/\&\#231\;/
rawbody T_ENTITY_DEC_232		/\&\#232\;/
rawbody T_ENTITY_DEC_233		/\&\#233\;/
rawbody T_ENTITY_DEC_234		/\&\#234\;/
rawbody T_ENTITY_DEC_235		/\&\#235\;/
rawbody T_ENTITY_DEC_236		/\&\#236\;/
rawbody T_ENTITY_DEC_237		/\&\#237\;/
rawbody T_ENTITY_DEC_238		/\&\#238\;/
rawbody T_ENTITY_DEC_239		/\&\#239\;/
rawbody T_ENTITY_DEC_240		/\&\#240\;/
rawbody T_ENTITY_DEC_241		/\&\#241\;/
rawbody T_ENTITY_DEC_242		/\&\#242\;/
rawbody T_ENTITY_DEC_243		/\&\#243\;/
rawbody T_ENTITY_DEC_244		/\&\#244\;/
rawbody T_ENTITY_DEC_245		/\&\#245\;/
rawbody T_ENTITY_DEC_246		/\&\#246\;/
rawbody T_ENTITY_DEC_247		/\&\#247\;/
rawbody T_ENTITY_DEC_248		/\&\#248\;/
rawbody T_ENTITY_DEC_249		/\&\#249\;/
rawbody T_ENTITY_DEC_250		/\&\#250\;/
rawbody T_ENTITY_DEC_251		/\&\#251\;/
rawbody T_ENTITY_DEC_252		/\&\#252\;/
rawbody T_ENTITY_DEC_253		/\&\#253\;/
rawbody T_ENTITY_DEC_254		/\&\#254\;/
rawbody T_ENTITY_DEC_255		/\&\#255\;/

########################################################################

# similar concept for Delphi.com.  Was an ISP, now a car company!
# I think their username format is "First.Last"; requiring 2 digits
# will be pretty safe.  (lower rule as a baseline to see if we miss much)
header T_FROM_DELPHI		From:addr =~ /\d[^\@]+\d[^\@]+\@delphi\.com/i

# great Yahoo! forgery rule, but is it going to be stable?
# hmm.  good question :(
header __YAHOO_MSGID		Message-ID =~ /\@yahoo\.com>/i
header __YAHOO_BEGINNING	Message-ID =~ /<\S+(?:\.\S+|\.\S+\.\S+\.\S+)\@/
meta T_FORGED_YAHOO_MSGID	(__YAHOO_MSGID && !__YAHOO_BEGINNING)

# reported by Kurtis Rader, bug 2890
# problem: miniscule hits
uri T_MSN_REDIR		m{^https?://shopping\.msn\.com/trackurl\.aspx\?}i
describe T_MSN_REDIR	Has MSN Redirect URI

# reported by Kurtis Rader, bug 2901
# miniscule hits
uri T_AOL_REDIR		m{^https?://www\.aol\.com/(?:ams/|.*https?://)}i
#describe T_AOL_REDIR	Has AOL Redirect URI

# bug 2950
# both look promotable
# really?  low hit rates...
# suggestion: we combine MSN, AOL and Google redir rules.  All are
# 1.0 S/Os but low hitrates
uri T_GOOGLE_IMAGES	m{^http://images\.google(\.\S+)?\.[a-z]{2,3}/imgres\?}i
uri T_GOOGLE_REDIR	m{^http://www\.google(\.\S+)?\.[a-z]{2,3}/url\?}i

# more portable replacement for RCVD_NUMERIC_HELO that doesn't rely on
# Received headers using "helo=" prefix.  exclude squirrelmail, which
# records a perfectly-ok rcvd header for the HTTP step in this fmt
header __RCVD_NUMERIC_HELO	X-Spam-Relays-Untrusted =~ / helo=\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3} /
header __SQUIRREL_AUTH          Received =~ /SquirrelMail authenticated user/
meta T_RCVD_NUMERIC_HELO        (__RCVD_NUMERIC_HELO && !__SQUIRREL_AUTH)
describe T_RCVD_NUMERIC_HELO	Received: contains an IP address used for HELO
# same but not for first line
header __RCVD_NUMERIC_HELO_NOTFIRST	X-Spam-Relays-Untrusted =~ / helo=\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3} .+\[/
meta T_RCVD_NUMERIC_HELO_NOTFIRST       (__RCVD_NUMERIC_HELO_NOTFIRST && !__SQUIRREL_AUTH)
describe T_RCVD_NUMERIC_HELO_NOTFIRST	Received: contains IP for HELO (not first line)
# same but for the last untrusted host
header __RCVD_NUMERIC_HELO_LASTUNT	X-Spam-Relays-Untrusted =~ /^[^\]]* helo=\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3} /
meta T_RCVD_NUMERIC_HELO_LASTUNT        (__RCVD_NUMERIC_HELO_NOTFIRST && !__SQUIRREL_AUTH)
describe T_RCVD_NUMERIC_HELO_LASTUNT	Received: contains IP for HELO (not first line)

# 0.683   1.3791   0.0134    0.990   0.90    0.01  T_URI_UNPRINTABLE:quinlan
# 0.956   1.1479   0.5948    0.659   0.26    0.01  T_URI_UNPRINTABLE:rODbegbie
# 0.734   0.7756   0.0885    0.898   0.66    0.01  T_URI_UNPRINTABLE:theo
# FPs?  weird
uri	T_URI_UNPRINTABLE	/\%0/
describe T_URI_UNPRINTABLE	URI contains unprintable characters

header T_RCVD_IN_BOGUSMX	rbleval:check_rbl_from_host('rfci-bmx', 'bogusmx.rfc-ignorant.org.')
describe T_RCVD_IN_BOGUSMX	Received via a relay in BogusMX (rfc-ignorant.org)
tflags T_RCVD_IN_BOGUSMX	net

# partial messages; currently-theoretical attack
# unsurprisingly this hits 0/0 right now.  But should we promote it anyway
# to protect against the possibility?
header T_FRAGMENTED_MESSAGE	Content-Type =~ /message\/partial/i

# some HTML rules to try
body T_HTML_FONT_SMALL_SIZE_1	eval:html_eval('min_size', '< 1')
body T_HTML_FONT_SMALL_SIZE_2	eval:html_eval('min_size', '< 0')
body T_HTML_FONT_SMALL_SIZE_3	eval:html_eval('min_size', '< -1')

# these look pretty good
body T_HTML_FONT_SIZE_BIG	eval:html_range('max_size', '4', '5')
body T_HTML_FONT_SIZE_LARGE	eval:html_range('max_size', '5', '6')
body T_HTML_FONT_SIZE_HUGE	eval:html_range('max_size', '6', 'inf')

########################################################################

# http://www.ahbl.org/using/spamassassin.txt :
# SpamAssassin local.cf for AHBL BlackList / BlockList
# "Old blackholes.2mbit.com resurrected as AHBL (dnsbl.ahbl.org)"
# URL: http://www.ahbl.org
# 0.000   0.0000   0.0000    0.500   0.11    0.00  __RCVD_IN_AHBL
header __RCVD_IN_AHBL eval:check_rbl('ahbl', 'dnsbl.ahbl.org.')
describe __RCVD_IN_AHBL AHBL: sender is in DNSbl dnsbl.ahbl.org
tflags __RCVD_IN_AHBL net

#  0.023   0.0315   0.0024    0.930   0.71    0.01  T_RCVD_IN_AHBL_UNKNOWN_1
header T_RCVD_IN_AHBL_UNKNOWN_1 eval:check_rbl_sub('ahbl', '127.0.0.1')
describe T_RCVD_IN_AHBL_UNKNOWN_1 AHBL: Unknown Category 1 (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_UNKNOWN_1 net

#  0.002   0.0029   0.0000    1.000   0.89    0.01  T_RCVD_IN_AHBL_SMTP
header T_RCVD_IN_AHBL_SMTP eval:check_rbl_sub('ahbl', '127.0.0.2')
describe T_RCVD_IN_AHBL_SMTP AHBL: Open SMTP relay (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_SMTP net

# 12.154  17.1401   0.0951    0.994   0.90    0.01  T_RCVD_IN_AHBL_PROXY
header T_RCVD_IN_AHBL_PROXY eval:check_rbl_sub('ahbl', '127.0.0.3')
describe T_RCVD_IN_AHBL_PROXY AHBL: Open Proxy server (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_PROXY net

# 3.956   5.5534   0.0927    0.984   0.85    0.01  T_RCVD_IN_AHBL_SPAM
# jm: -1
header T_RCVD_IN_AHBL_SPAM eval:check_rbl_sub('ahbl', '127.0.0.4')
describe T_RCVD_IN_AHBL_SPAM AHBL: Spam Source (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_SPAM net

# these are all 0 or not so good:
header T_RCVD_IN_AHBL_RTB eval:check_rbl_sub('ahbl', '127.0.0.5')
describe T_RCVD_IN_AHBL_RTB AHBL: Real-Time Blocked (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_RTB net

header T_RCVD_IN_AHBL_FORMMAIL eval:check_rbl_sub('ahbl', '127.0.0.6')
describe T_RCVD_IN_AHBL_FORMMAIL AHBL: Abuseable Form Mail (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_FORMMAIL net

header T_RCVD_IN_AHBL_SPAM_SUPPORT eval:check_rbl_sub('ahbl', '127.0.0.7')
describe T_RCVD_IN_AHBL_SPAM_SUPPORT AHBL: Spam Supporter (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_SPAM_SUPPORT net

header T_RCVD_IN_AHBL_I_SPAM_SUPPORT eval:check_rbl_sub('ahbl', '127.0.0.8')
describe T_RCVD_IN_AHBL_I_SPAM_SUPPORT AHBL: Indirect Spam supporter (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_I_SPAM_SUPPORT net

header T_RCVD_IN_AHBL_ENDUSER eval:check_rbl_sub('ahbl', '127.0.0.9')
describe T_RCVD_IN_AHBL_ENDUSER AHBL: End User listed (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_ENDUSER net

header T_RCVD_IN_AHBL_SOS eval:check_rbl_sub('AHBL-notfirsthop', '127.0.0.10')
describe T_RCVD_IN_AHBL_SOS AHBL: Shoot On Sight (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_SOS net

header T_RCVD_IN_AHBL_RFCI_PA eval:check_rbl_sub('ahbl', '127.0.0.11')
describe T_RCVD_IN_AHBL_RFCI_PA AHBL: No Postmaster/Abuse Address (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_RFCI_PA net

header T_RCVD_IN_AHBL_5XXI eval:check_rbl_sub('ahbl', '127.0.0.12')
describe T_RCVD_IN_AHBL_5XXI AHBL: Spurious 5xx error handling (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_5XXI net

header T_RCVD_IN_AHBL_RFCI_MISC eval:check_rbl_sub('ahbl', '127.0.0.13')
describe T_RCVD_IN_AHBL_RFCI_MISC AHBL: Other Non-RFC Compliant (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_RFCI_MISC net

header T_RCVD_IN_AHBL_CMPR_DDOS eval:check_rbl_sub('ahbl', '127.0.0.14')
describe T_RCVD_IN_AHBL_CMPR_DDOS AHBL: Compromised - DDoS (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_CMPR_DDOS net

header T_RCVD_IN_AHBL_CMPR_RELAY eval:check_rbl_sub('ahbl', '127.0.0.15')
describe T_RCVD_IN_AHBL_CMPR_RELAY AHBL: Compromised - Relay (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_CMPR_RELAY net

header T_RCVD_IN_AHBL_CMPR_SCAN eval:check_rbl_sub('ahbl', '127.0.0.16')
describe T_RCVD_IN_AHBL_CMPR_SCAN AHBL: Compromised - Autorooter/Scanner
tflags T_RCVD_IN_AHBL_CMPR_SCAN net

header T_RCVD_IN_AHBL_CMPR_WORM eval:check_rbl_sub('ahbl', '127.0.0.17')
describe T_RCVD_IN_AHBL_CMPR_WORM AHBL: Compromised - Worm or mass mailing virus
tflags T_RCVD_IN_AHBL_CMPR_WORM net

header T_RCVD_IN_AHBL_CMPR_VIRUS eval:check_rbl_sub('ahbl', '127.0.0.18')
describe T_RCVD_IN_AHBL_CMPR_VIRUS AHBL: Compromised - Other virus
tflags T_RCVD_IN_AHBL_CMPR_VIRUS net

header T_RCVD_IN_AHBL_OTHER eval:check_rbl_sub('ahbl', '127.0.0.127')
describe T_RCVD_IN_AHBL_OTHER AHBL: Other (dnsbl.ahbl.org)
tflags T_RCVD_IN_AHBL_OTHER net

# not so useful
# 0.873   0.1278   2.6753    0.046   0.78   -0.01  T_RCVD_IN_AHBL_EXEMPT_T
header T_RCVD_IN_AHBL_EXEMPT_T	eval:check_rbl('ahbl-ex-firsttrusted', 'exemptions.ahbl.org.')
describe T_RCVD_IN_AHBL_EXEMPT_T AHBL: Sender is in Exempt zone (trusted)
tflags T_RCVD_IN_AHBL_EXEMPT_T	net nice

# 0.489   0.0600   1.5267    0.038   0.79   -0.01  T_RCVD_IN_AHBL_EXEMPT_O
header T_RCVD_IN_AHBL_EXEMPT_O	eval:check_rbl('ahbl-ex-untrusted', 'exemptions.ahbl.org.')
describe T_RCVD_IN_AHBL_EXEMPT_O AHBL: Sender is in Exempt zone (other)
tflags T_RCVD_IN_AHBL_EXEMPT_O	net nice

# 5.877   8.1040   0.4899    0.943   0.76    0.01  T_RCVD_IN_AHBL_RHSBL
# jm: -1
header T_RCVD_IN_AHBL_RHSBL	eval:check_rbl_from_host('ahbl-rhs', 'rhsbl.ahbl.org.')
describe T_RCVD_IN_AHBL_RHSBL	AHBL: From sender in DNSbl dnsbl.ahbl.org
tflags T_RCVD_IN_AHBL_RHSBL	net

# IADB
header __RCVD_IN_IADB		eval:check_rbl('iadb', 'iadb.isipp.com.')
tflags __RCVD_IN_IADB		net nice

header T_RCVD_IN_IADB_LIST	eval:check_rbl_sub('iadb', '127.0.0.1')
describe T_RCVD_IN_IADB_LIST	Sender is listed in ISIPP IADB
tflags T_RCVD_IN_IADB_LIST	net nice

# IADB trusted
header __RCVD_IN_IADB_T		eval:check_rbl('iadbt-firsttrusted', 'iadb.isipp.com.')
tflags __RCVD_IN_IADB_T		net nice

header T_RCVD_IN_IADB_LIST_T	eval:check_rbl_sub('iadbtr', '127.0.0.1')
describe T_RCVD_IN_IADB_LIST_T	Sender is listed in ISIPP IADB
tflags T_RCVD_IN_IADB_LIST_T	net nice

# Bug 2168
header T_BAD_MOZILLA_VERSION    User-Agent =~ /Mozilla\/5\.0\d\d/
describe T_BAD_MOZILLA_VERSION  User-Agent claims to be Mozilla, but is malformed

header T_RCVD_ILLEGAL_IP    Received =~ /[\s\(\[\:\=](?:(?:[01257]|22[3-9]|23[0-9]|24[0-9]|25[0-5])\.\d+\.\d+\.\d+|127\.[1-9]\.\d+\.\d+|127\.0\.[1-9]\.\d+|127\.0\.0\.(?:\d\d+|[2-9]))\b/
describe T_RCVD_ILLEGAL_IP  Received contains illegal IP address

# a couple to try out
header T_PC_CUR_DATE_TIME       ALL =~ /%CURRENT_DATE_TIME/
header T_PC_RND_HEADER          ALL =~ /%RA?ND_[A-Z]/
body T_PC_RND_BODY              /%RA?ND_[A-Z]/

header T_X_MESSAGE_INFO         X-Message-Info =~ /\+/
describe T_X_MESSAGE_INFO       Ratware signature (X-Message-Info)

# REIMPLEMENT: ADVERT_CODE tests.
header T_ADVERT_CODE	Subject =~ /^[^0-9a-z]*adv(?:ert)?\b/i
# may need a negative lookahead between in front of first \b for "ADV."
header T_ADVERT_CODE2	Subject =~ /\w.*\bA\s*D\s*V\b/

# bug 3262
body T_NO_COST                    /\bno (?:(?:extra|hidden) )?(?:cost|charge)\b/i

# bug 3268
body T_REDIRECTOR       eval:check_for_http_redirector()
describe T_REDIRECTOR	Message has HTTP redirector URI

# bug 2539
header  __RANDH_1   ALL =~ /[%\#\[\$]RANDOM/i
header  __RANDH_1B  ALL =~ /[%\#\[\$]RANDOM_CHAR/i
header  __RANDH_1C  ALL =~ /[%\#\[\$]RANDOM_DATE/i
header  __RANDH_1D  ALL =~ /[%\#\[\$]RANDOM_LETTER/i
header  __RANDH_1E  ALL =~ /[%\#\[\$]RANDOM_NUMBER/i
header  __RANDH_1F  ALL =~ /[%\#\[\$]RANDOM_TEXT/
header  __RANDH_1G  ALL =~ /[%\#\[\$]RANDOM_TIME/
header  __RANDH_1H  ALL =~ /[%\#\[\$]RANDOM_WORD/
header  __RANDH_1I  ALL =~ /[%\#\[\$]RANDOMIZE/

rawbody __RANDR_1   /[%\#\[\$]RANDOM/i
rawbody __RANDR_1B  /[%\#\[\$]RANDOM_CHAR/i
rawbody __RANDR_1C  /[%\#\[\$]RANDOM_DATE/i
rawbody __RANDR_1D  /[%\#\[\$]RANDOM_LETTER/i
rawbody __RANDR_1E  /[%\#\[\$]RANDOM_NUMBER/i
rawbody __RANDR_1F  /[%\#\[\$]RANDOM_TEXT/
rawbody __RANDR_1G  /[%\#\[\$]RANDOM_TIME/
rawbody __RANDR_1H  /[%\#\[\$]RANDOM_WORD/
rawbody __RANDR_1I  /[%\#\[\$]RANDOMIZE/

meta  T_SARE_RAND_1   (__RANDH_1  || __RANDR_1)
meta  T_SARE_RAND_1B  (__RANDH_1B || __RANDR_1B)
meta  T_SARE_RAND_1C  (__RANDH_1C || __RANDR_1C)
meta  T_SARE_RAND_1D  (__RANDH_1D || __RANDR_1D)
meta  T_SARE_RAND_1E  (__RANDH_1E || __RANDR_1E)
meta  T_SARE_RAND_1F  (__RANDH_1F || __RANDR_1F)
meta  T_SARE_RAND_1G  (__RANDH_1G || __RANDR_1G)
meta  T_SARE_RAND_1H  (__RANDH_1H || __RANDR_1H)
meta  T_SARE_RAND_1I  (__RANDH_1I || __RANDR_1I)


# meant to target porn (thousands of somethings), but was hitting URIs too
# before URI were no longer stuffed into "body" rendering
uri T_LOTS_OF_STUFF_01		/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies)/i
uri T_LOTS_OF_STUFF_02		/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies|imgs?)/i
uri T_LOTS_OF_STUFF_03	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics?|pictures?|images?|photos?|movies?|imgs?)/i
rawbody T_LOTS_OF_STUFF_04	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies)/i
rawbody T_LOTS_OF_STUFF_05	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies|imgs?)/i
rawbody T_LOTS_OF_STUFF_06	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics?|pictures?|images?|photos?|movies?|imgs?)/i
body T_LOTS_OF_STUFF_07	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies)/i
body T_LOTS_OF_STUFF_08	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies|imgs?)/i
body T_LOTS_OF_STUFF_09	/\b(?:\d{1,3}[,\.])+\d{3}.{0,20}\b(?:pics?|pictures?|images?|photos?|movies?|imgs?)/i
body T_LOTS_OF_STUFF_10	/\b(?:\d{1,3},?)+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies)/i
body T_LOTS_OF_STUFF_11	/\b(?:\d{1,3},?)+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies|imgs?)/i
body T_LOTS_OF_STUFF_12	/\b(?:\d{1,3},?)+\d{3}.{0,20}\b(?:pics?|pictures?|images?|photos?|movies?|imgs?)/i
body T_LOTS_OF_STUFF_13	/\b(?:\d{1,3}[,\.]?)+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies)/i
body T_LOTS_OF_STUFF_14	/\b(?:\d{1,3}[,\.]?)+\d{3}.{0,20}\b(?:pics|pictures|images|photos|movies|imgs?)/i
body T_LOTS_OF_STUFF_15	/\b(?:\d{1,3}[,\.]?)+\d{3}.{0,20}\b(?:pics?|pictures?|images?|photos?|movies?|imgs?)/i

# Matt Kettler's antidrug.cf ruleset.  bug 3009
# should probably move good ones from here directly into 20_drugs.cf?
# or a new rules file, 20_antidrug.cf?
# The anti-drug ruleset
# authored by Matt Kettler for SpamAssassin
#
# This ruleset is intended to detect common "pill spam"
# however, it is not appropriate for all environments.
# It may not be appropriate for a medical or pharmaceutical
# environment. If in doubt, adjust the scores of all the rules
# to 0.01 and see if they fire off on your daily nonspam.
#
# rev 0.63 04/16/2004
#
# the current home of this ruleset is
# http://mywebpages.comcast.net/mkettler/sa/antidrug.cf
#
# Contact address mkettler_sa@comcast.net
#
#male sexual dysfunction drugs
#
# This section is undergoing improvements and I'm trying to track down a 
# FP case that seems to mostly affect technical emails.
# However, all of the test cases so far fail to match when retested.
# note: The regex /v.i.a.g.r.a/ was intentionally not used
# due to potential false positive cases with PGP signatures
# and other base-64ish stuff.
# instead other patterns are used catch non alphanumeric gapping patterns
# note: \W = "non word character"

# Note: many of the drugs named in here are brand-names and are trademarked.
# All trademarks are property of the respective owners.


#current best char substitutions
# i - [i1!|l\xEC\xED\xEE\xEF]
# a - [a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@]  
# e - [e3\xE9\xEA\xEB] -> [e3\xE8\xE9\xEA\xEB]
# o - [o0\xF3]
# u - [u\xB5\xFB]
# v - (?:\\\/|V)
# l - [l!|1]

#maledysfunction drugs

#plain Viagra and Cialis (used in obfu detection)
body __DRUGS_ERECTILE_V	/\bViagra\b/i
body __DRUGS_ERECTILE_C	/\bCialis\b/i
body __DRUGS_ERECTILE_L	/\bLevitra\b/i
#  obfu/plain and mis-spelled Viagra variants
body __DRUGS_ERECTILE1	/(?:\b|\s)[_\W]{0,3}(?:\\\/|V)[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@][_\W]{0,3}g[_\W]{0,3}r[_\W]{0,3}[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@][_\W]{0,3}x?[_\W]{0,3}(?:\b|\s)/i
body __DRUGS_ERECTILE2	/\bV(?:agira|igara|iaggra|iaegra)\b/i
#  cialis variants (spelling correct now)
body __DRUGS_ERECTILE3 /(?:\b|\s)[_\W]{0,3}C[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@][_\W]{0,3}[l!|1][_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}s[_\W]{0,3}(?:\b|\s)/i
body __DRUGS_ERECTILE4	/\bC(?:alis|ilias|ilais)\b/i
# generic names
body __DRUGS_ERECTILE5	/\bsildenafil citrate\b/i
#Levitra
body __DRUGS_ERECTILE6	/\bL\W?[e3\xE8\xE9\xEA\xEB]\W?(?:\\\/|V)\W?[i1!|l\xEC\xED\xEE\xEF]\W?t\W?r\W?[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@]\W?(?:\b|\s)/i
#tadalafil
body __DRUGS_ERECTILE8 /\bT\W?[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@]\W?d\W?[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@]\W?l\W?[a4\xE0\xE1\xE2\xE3\xE4\xE5\xE6@]\W?f\W?[i1!|l\xEC\xED\xEE\xEF]\W?l\b/i
# gapped/obfu viagra variants using funky html-style character codes
rawbody __DRUGS_ERECTILE10   /\bV\W?(?:i|\&iuml\;)\W?(?:a|\&agrave|\&aring)\;?\W?g\W?r\W?(?:a|\&agrave|\&aring)\b/i
body __DRUGS_ERECTILE11 		/\ba[_\W]{0,3}p[_\W]{0,3}c[_\W]{0,3}a[_\W]{0,3}l[_\W]{0,3}i[_\W]{0,3}s\b/i
meta T_DRUGS_ERECTILE (__DRUGS_ERECTILE1 || __DRUGS_ERECTILE2 || __DRUGS_ERECTILE3 || __DRUGS_ERECTILE4 ||__DRUGS_ERECTILE5 ||__DRUGS_ERECTILE6 ||__DRUGS_ERECTILE7 ||__DRUGS_ERECTILE8 || __DRUGS_ERECTILE10 ||__DRUGS_ERECTILE11 )
describe T_DRUGS_ERECTILE 	Contains a ref to an E.D. drug
meta T_DRUGS_ERECTILE_OBFU ( (__DRUGS_ERECTILE1 &&!__DRUGS_ERECTILE_V) || (__DRUGS_ERECTILE3 && !__DRUGS_ERECTILE_C) ||__DRUGS_ERECTILE2 || (__DRUGS_ERECTILE10 &&!__DRUGS_ERECTILE_V) || (__DRUGS_ERECTILE6 &&!__DRUGS_ERECTILE_L))
describe T_DRUGS_ERECTILE_OBFU 	Contains an obfuscated ref to an E.D. drug
 

#diet
body __DRUGS_DIET_PHEN	/\bphentermine\b/i
#phentermine
body __DRUGS_DIET1	/(?:\b|\s)[_\W]{0,3}p[_\W]{0,3}h[_\W]{0,3}[e3\xE9\xEA\xEB][_\W]{0,3}n[_\W]{0,3}t[_\W]{0,3}[e3\xE9\xEA\xEB][_\W]{0,3}r[_\W]{0,3}m[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}n[_\W]{0,3}[e3\xE9\xEA\xEB][_\W]{0,3}(?:\b|\s)/i
#ionamin
body __DRUGS_DIET2	/\bionamin\b/i
#bontril
body __DRUGS_DIET3	/\bbontril\b/i
#phendimetrazine
body __DRUGS_DIET4	/\bphendimetrazine\b/i
#diethylpropion, generic of Tenuate, uncommon in spam
body __DRUGS_DIET5	/\bdiethylpropion\b/i
#Meridia
body __DRUGS_DIET6	/(?:\b|\s)[_\W]{0,3}M[_\W]{0,3}[e3\xE9\xEA\xEB][_\W]{0,3}r[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}d[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}(?:\b|\s)/i
#tenuate
body __DRUGS_DIET7	/\btenuate\b/i
#didrex
body __DRUGS_DIET8	/\bdidrex\b/i
#adipex
body __DRUGS_DIET9	/\ba\W?d\W?[i1!|l\xEC\xED\xEE\xEF]\W?p\W?[e3\xE9\xEA\xEB]\W?x\b/i
#xenical
body __DRUGS_DIET10	/\bx\W?[e3\xE9\xEA\xEB]\W?n\W?[i1!|l\xEC\xED\xEE\xEF]\W?c\W?[a4\xE1\xE2\xE3@]\W?l\b/i
meta T_DRUGS_DIET (__DRUGS_DIET1 || __DRUGS_DIET2 || __DRUGS_DIET3 || __DRUGS_DIET4 ||__DRUGS_DIET5 ||__DRUGS_DIET6 ||__DRUGS_DIET7 ||__DRUGS_DIET8 || __DRUGS_DIET9 || __DRUGS_DIET10 )
describe T_DRUGS_DIET 	Contains a ref to an diet drug
meta T_DRUGS_DIET_OBFU (__DRUGS_DIET1 && !__DRUGS_DIET_PHEN)
describe T_DRUGS_DIET_OBFU	Contains an obfuscated ref to an diet drug	

# pain relief drugs
body __DRUGS_PAIN_VICO	/vicodin/i
body __DRUGS_PAIN_VIOXX	/vioxx/i
body __DRUGS_PAIN1	/\bhydrocodone\b/i
body __DRUGS_PAIN2	/\bc[o0\xF3]deine\b/i
#ultram
body __DRUGS_PAIN3	/(?:\b|\s)[_\W]{0,3}[u\xB5\xFB][_\W]{0,3}l[_\W]{0,3}t[_\W]{0,3}r[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}m\b/i
#vicodin
body __DRUGS_PAIN4	/(?:\b|\s)[_\W]{0,3}(?:\\\/|V)[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}c[_\W]{0,3}[o0\xF3][_\W]{0,3}d[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}ns?[_\W]{0,3}(?:\b|\s)/i
body __DRUGS_PAIN5	/\btramadol\b/i
# ultracet, uncommon in spam.
body __DRUGS_PAIN6	/\bultracet\b/i
body __DRUGS_PAIN7	/\bfioricet\b/i
#celebrex
body __DRUGS_PAIN8	/\bc\W?[e3\xE9\xEA\xEB]\W?l\W?[e3\xE9\xEA\xEB]\W?b\W?r\W?[e3\xE9\xEA\xEB]\W?x\b/i
#imitrex
body __DRUGS_PAIN9	/(?:\b|\s)[i1!|l\xEC\xED\xEE\xEF]m[i1!|l\xEC\xED\xEE\xEF]tr[e3\xE9\xEA\xEB]x\b/i
#vioxx 
body __DRUGS_PAIN10	/(?:\b|\s)[_\W]{0,3}(?:\\\/|V)[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}[o0\xF3][_\W]{0,3}x[_\W]{0,3}x\b/i
#zebutal, uncommon in spam.
body __DRUGS_PAIN11	/\bzebutal\b/i
#esgic plus, uncommon in spam.
body __DRUGS_PAIN12	/\besgic plus\b/i
#Darvon - a prescription narcotic
body __DRUGS_PAIN13	/\bD\W?[a4\xE1\xE2\xE3@]\W?r\W?v\W?[o0\xF3]\W?n\b/i
meta T_DRUGS_PAIN (__DRUGS_PAIN1 || __DRUGS_PAIN2 || __DRUGS_PAIN3 || __DRUGS_PAIN4 ||__DRUGS_PAIN5 ||__DRUGS_PAIN6 ||__DRUGS_PAIN7 ||__DRUGS_PAIN8 || __DRUGS_PAIN9 || __DRUGS_PAIN10|| __DRUGS_PAIN11 || __DRUGS_PAIN12 || __DRUGS_PAIN13)
describe T_DRUGS_PAIN 	Contains a ref to a prescription pain relief drug
meta T_DRUGS_PAIN_OBFU (( __DRUGS_PAIN4 &&! __DRUGS_PAIN_VICO) || ( __DRUGS_PAIN10 &&!__DRUGS_PAIN_VIOXX))
describe T_DRUGS_PAIN_OBFU 	Has obfuscated ref to a pain relief drug
#sleep aids
#ativan and lorazepam already under anxiety
#Ambien, brand of zolpidem tartrate
body __DRUGS_SLEEP1	/(?:\b|\s)[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}m[_\W]{0,3}b[_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}[e3\xE9\xEA\xEB][_\W]{0,3}n[_\W]{0,3}(?:\b|\s)/i
#sonata, brand of zaleplon
body __DRUGS_SLEEP2	/(?:\b|\s)[_\W]{0,3}S[_\W]{0,3}[o0\xF3][_\W]{0,3}n[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}t[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}(?:\b|\s)/i
#Restoril, brand of temazepam, uncommon in spam
body __DRUGS_SLEEP3	/\bRestoril\b/i
#Halcion, brand of triazolam
body __DRUGS_SLEEP4	/\bHalcion\b/i

meta T_DRUGS_SLEEP (__DRUGS_SLEEP1 || __DRUGS_SLEEP2 || __DRUGS_SLEEP3 ||__DRUGS_SLEEP4)
describe T_DRUGS_SLEEP 	Contains a ref to a prescription sleep aid drug

#muscle relaxants
#soma
body __DRUGS_MUSCLE1	/(?:\b|\s)[_\W]{0,3}s[_\W]{0,3}[o0\xF3][_\W]{0,3}m[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}(?:\b|\s)/i
#cyclobenzaprine
body __DRUGS_MUSCLE2	/\bcycl[o0\xF3]b[e3\xE9\xEA\xEB]nz[a4\xE1\xE2\xE3@]pr[i1!|l\xEC\xED\xEE\xEF]n[e3\xE9\xEA\xEB](?:\b|\s)/i
#flexeril
body __DRUGS_MUSCLE3	/\bf\W?l\W?[e3\xE9\xEA\xEB]\W?x\W?[e3\xE9\xEA\xEB]\W?r\W?[i1!|l\xEC\xED\xEE\xEF]\W?l\b/i
#zanaflex
body __DRUGS_MUSCLE4	/\bzanaflex\b/i
#skelaxin
body __DRUGS_MUSCLE5	/\bskelaxin\b/i
meta T_DRUGS_MUSCLE (__DRUGS_MUSCLE1 || __DRUGS_MUSCLE2 || __DRUGS_MUSCLE3 || __DRUGS_MUSCLE4 ||__DRUGS_MUSCLE5 )
describe T_DRUGS_MUSCLE 	Contains a ref to a prescription muscle relaxant
#anti-anxiety
body __DRUGS_ANXIETY_XAN	/xan[ae]x/i
body __DRUGS_ANXIETY_VAL	/valium/i
#xanax - note: second a sometimes done as e.
body __DRUGS_ANXIETY1	/(?:\b|\s)[_\W]{0,3}x[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}n[_\W]{0,3}[ea4\xE1\xE2\xE3@][_\W]{0,3}x\b/i
#alprazolam
body __DRUGS_ANXIETY2	/\balprazolam\b/i
#valium
body __DRUGS_ANXIETY3	/(?:\b|\s)[_\W]{0,3}(?:\\\/|V)[_\W]{0,3}[a4\xE1\xE2\xE3@][_\W]{0,3}[l|][_\W]{0,3}[i1!|l\xEC\xED\xEE\xEF][_\W]{0,3}[u\xB5\xFB][_\W]{0,3}m\b/i
#diezepam, generic of valium
body __DRUGS_ANXIETY4	/\bd\W?[i1!|l\xEC\xED\xEE\xEF]\W?[e3\xE9\xEA\xEB]\W?z\W?[ea3\xE9\xEA\xEB]\W?p\W?[a4\xE1\xE2\xE3@]\W?m\b/i
#ativan
body __DRUGS_ANXIETY5	/(?:\b|\s)[a4\xE1\xE2\xE3@]\W?t\W?[i1!|l\xEC\xED\xEE\xEF]\W?v\W?[a4\xE1\xE2\xE3@]\W?n\b/i
#lorazepam - generic of ativan, uncommon in spam
body __DRUGS_ANXIETY6	/\bl\W?[o0\xF3]\W?r\W?[a4\xE1\xE2\xE3@]\W?z\W?[e3\xE9\xEA\xEB]\W?p\W?[a4\xE1\xE2\xE3@]\W?m\b/i
#clonazepam, generic.
body __DRUGS_ANXIETY7	/\bc\W?l\W?[o0\xF3]\W?n\W?[a4\xE1\xE2\xE3@]\W?z\W?e\W?p\W?[a4\xE1\xE2\xE3@]\W?m\b/i
#klonopin, brand of clonazepam, uncommon in spam
body __DRUGS_ANXIETY8	/\bklonopin\b/i
#rivotril, brand of clonazepam, uncommon in spam
body __DRUGS_ANXIETY9	/\brivotril\b/i
meta T_DRUGS_ANXIETY (__DRUGS_ANXIETY1 || __DRUGS_ANXIETY2 || __DRUGS_ANXIETY3 || __DRUGS_ANXIETY4 ||__DRUGS_ANXIETY5 ||__DRUGS_ANXIETY6 ||__DRUGS_ANXIETY7 ||__DRUGS_ANXIETY8 || __DRUGS_ANXIETY9 )
describe T_DRUGS_ANXIETY 	Has ref to an anxiety control drug
meta T_DRUGS_ANXIETY_OBFU ( (__DRUGS_ANXIETY1 &&! __DRUGS_ANXIETY_XAN) || (__DRUGS_ANXIETY3 && !__DRUGS_ANXIETY_VAL))
describe T_DRUGS_ANXIETY_OBFU 	Has obfuscated ref to an anxiety control drug
#antidepressant
#prozac
body __DRUGS_DEPRESSION1	/\bp\W?r\W?[o0\xF3]\W?z\W?[a4\xE1\xE2\xE3@]\W?c\b/i
#fluoxetine 
body __DRUGS_DEPRESSION2	/\bfluoxetine\b/i
#buspar
body __DRUGS_DEPRESSION3	/\bbuspar\b/i
#paxil
body __DRUGS_DEPRESSION4	/\bp\W?[a4\xE1\xE2\xE3@]\W?x\W?[i1!|l\xEC\xED\xEE\xEF]\W?[l!|1](?:\b|\s)/i
#wellbutrin
body __DRUGS_DEPRESSION5	/\bwellbutrin\b/i
#lexapro
body __DRUGS_DEPRESSION6	/\blexapro\b/i
#zoloft
body __DRUGS_DEPRESSION7	/\bz\W?[o0\xF3]\W?l\W?[o0\xF3]\W?f\W?t\b/i
#elavil
body __DRUGS_DEPRESSION8	/\belavil\b/i
#sarafem
body __DRUGS_DEPRESSION9	/\bsarafem\b/i
#remeron
body __DRUGS_DEPRESSION10	/\bremeron\b/i
meta T_DRUGS_DEPRESSION (__DRUGS_DEPRESSION1 || __DRUGS_DEPRESSION2 || __DRUGS_DEPRESSION3 || __DRUGS_DEPRESSION4 ||__DRUGS_DEPRESSION5 ||__DRUGS_DEPRESSION6 ||__DRUGS_DEPRESSION7 ||__DRUGS_DEPRESSION8 || __DRUGS_DEPRESSION9 || __DRUGS_DEPRESSION10)
describe T_DRUGS_DEPRESSION 	Contains a ref to a prescription antidepressant

#search for "weird" combinations that are unlikely to 
#be prescribed together for a single event, thus unlikely to be
#mentioned in the same email, except an online pharmacy ad.
# (jm: this is ridiculous.  I've had to make these descriptions unreadable
# because of the absurd 50-char limit. grrr!!)
meta T_DRUGS_DIET_EREC	(T_DRUGS_ERECTILE && T_DRUGS_DIET)
describe T_DRUGS_DIET_EREC 	Has refs to both an E.D. and a diet drug
meta T_DRUGS_PAIN_EREC	(T_DRUGS_ERECTILE && T_DRUGS_PAIN)
describe T_DRUGS_PAIN_EREC 	Has refs to both an E.D. and a painkiller
meta T_DRUGS_DEPR_EREC	(T_DRUGS_ERECTILE && T_DRUGS_DEPRESSION)
describe T_DRUGS_DEPR_EREC 	Has refs to both an E.D. and antidepressant
meta T_DRUGS_ANXIETY_EREC (T_DRUGS_ERECTILE && T_DRUGS_ANXIETY)
describe T_DRUGS_ANXIETY_EREC 	Has refs to both an E.D. and anti-anxiety drug
meta T_DRUGS_DIET_PAIN	(T_DRUGS_DIET && T_DRUGS_PAIN)
describe T_DRUGS_DIET_PAIN Has refs to diet drugs and painkillers
meta T_DRUGS_SLEEP_EREC	(T_DRUGS_ERECTILE && T_DRUGS_SLEEP)
describe T_DRUGS_SLEEP_EREC 	Has refs to an E.D. and prescription sleep aid

#this last rule is SA 2.5x and higher only
# note: some 3 item combos are "normal" ie: a patient might legitimately
# be prescribed depression, anxiety and sleep aid drugs all at once.
# however, I know of no "normal" 4-item combinations.
# don't use this rule with a sum-total that fires off for 3 or less
meta T_DRUGS_MANYKINDS	(T_DRUGS_ERECTILE + T_DRUGS_DIET + T_DRUGS_PAIN + T_DRUGS_SLEEP + T_DRUGS_MUSCLE + T_DRUGS_ANXIETY + T_DRUGS_DEPRESSION >3)
describe T_DRUGS_MANYKINDS 	contains refs to four different kinds of drugs

# I'm curious, may help explain more ALL_TRUSTED fps
body T_SA_MARKED_UP     /Spam detection software, running on the system /

# No, you can't make up those funny numbers.
header T_BAD_TIMEZONE_EST	ALL =~ /[+-]\d\d[30]0(?<!-0500|-0300|\+1000|\+1100) \(?EST\)?\b/
header T_BAD_TIMEZONE_CST_A	ALL =~ /[+-]\d\d[30]0(?<!-0600|-0400|\+0800|\+0930) \(?CST\)?\b/
header T_BAD_TIMEZONE_CST_B	ALL =~ /[+-]\d\d[30]0(?<!-0600|-0400|\+0800|\+0930|\+1030) \(?CST\)?\b/
header T_BAD_TIMEZONE_GMT_A	ALL =~ /[+-]\d\d[30]0(?<!\+0000) \(?GMT\)?\b/
header T_BAD_TIMEZONE_GMT_B	ALL =~ /[+-]\d\d[30]0(?<![+-]0000) \(?GMT\)?\b/
header T_BAD_TIMEZONE_UTC_A	ALL =~ /[+-]\d\d[30]0(?<!\+0000) \(?UTC\)?\b/
header T_BAD_TIMEZONE_UTC_B	ALL =~ /[+-]\d\d[30]0(?<![+-]0000) \(?UTC\)?\b/
header T_BAD_TIMEZONE_CDT_A	ALL =~ /[+-]\d\d[30]0(?<!-0500) \(?CDT\)?\b/
header T_BAD_TIMEZONE_CDT_B	ALL =~ /[+-]\d\d[30]0(?<!-0500|\+1030) \(?CDT\)?\b/
header T_BAD_TIMEZONE_MST	ALL =~ /[+-]\d\d[30]0(?<!-0700) \(?MST\)?\b/
