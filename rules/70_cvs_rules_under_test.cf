# SpamAssassin rules file: CVS rules under test
#
# This file is a placeholder for rules "under probation", ie. checked into
# CVS for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
###########################################################################

# should be fixed now
header T_INVALID_MSGID		Message-Id !~ /^<(?:[a-zA-Z0-9.,!\#\$%&'*\+\/=?\^_{}|~-]+|\".+\")\@(?:[a-zA-Z0-9_.-]+|\[\d{1,3}(?:\.\d{1,3}){3}\])>(?:\s*\(.*\))?\s*$/ [if-unset: <NO@MSGID>]
describe T_INVALID_MSGID	Message-Id is not valid, according to RFC 2822

# results for quinlan
#  0.149    0.458    0.000    1.00    0.72    0.50  T_FROM_TOPICA
header T_FROM_TOPICA		From:addr =~ /\@(?:\w+\.)?email-publisher\.com$/
describe T_FROM_TOPICA		From an address at email-publisher.com
score T_FROM_TOPICA		0.5

# results for quinlan
#  0.245    0.727    0.013    0.98    0.57    0.50  T_FROM_ALL_NUMS
header __FROM_JUST_NUMBER	From:addr =~ /^\d+\@/
header __FROM_PHONE		From:addr =~ /^\d{3}(?:[-.]?\d{3}[-.]?\d{4}|\d{7})\@/
meta T_FROM_ALL_NUMS		(__FROM_JUST_NUMBER && !__FROM_PHONE)
describe T_FROM_ALL_NUMS	From an address that is all numbers (non-phone)
score T_FROM_ALL_NUMS		0.5

body T_HTML_UNTITLED_TITLE	eval:html_eval('title_text', '=~ /Untitled/i')
describe T_HTML_UNTITLED_TITLE	HTML title contains "Untitled"
score T_HTML_UNTITLED_TITLE	2.5

body T_HTML_EMPTY_TITLE		eval:html_eval('title_text', '!~ /\S/s')
describe T_HTML_EMPTY_TITLE	HTML title contains no text
score T_HTML_EMPTY_TITLE	2.5

uri T_ADCLICK                   m,\Qhttp://www.adclick.ws/p\E,
describe T_ADCLICK              Contains adclick URL
score T_ADCLICK                 2.0

# bug 1022: MGM_POSTCARD #1
body T_UNSUBSCRIBE_POSTCARD	/send a postcard to Unsubscribe/
describe T_UNSUBSCRIBE_POSTCARD	Send a postcard to unsubscribe
score T_UNSUBSCRIBE_POSTCARD	2.0

# bug 1022: MGM_POSTCARD #2 original
body T_UNSUBSCRIBE_POSTAL	/(?:Send(?:ing|) a (?:postal mail|postcard) to (?:Unsubscribe|Customer ?Service|remove)|unsubscribe by (?:postal mail|postcard))/i
describe T_UNSUBSCRIBE_POSTAL	Send real mail to unsubscribe
score T_UNSUBSCRIBE_POSTAL	2.0

# bug 1022: MGM_POSTCARD #2 small change
body T_UNSUBSCRIBE_POSTAL2	/(?:Send(?:ing|) a (?:postal mail|postcard) to (?:Unsubscribe|Customer ?Service|remov(?:e|al))|unsubscribe by (?:postal mail|postcard))/i
describe T_UNSUBSCRIBE_POSTAL2	Send real mail to unsubscribe
score T_UNSUBSCRIBE_POSTAL2	2.0

# quinlan: this is not any better on my corpus, but I figured it was
# worth a shot
body T_UNSUBSCRIBE_WTF		/(?:(?:customer ?service|unsubscribe|remov[ae]).{0,16}\b(?:postal mail|letter|postcard|fax)|\b(?:postal mail|letter|postcard|fax).{0,16}(?:customer ?service|unsubscribe|remov[ae]))/i
describe T_UNSUBSCRIBE_WTF	Send a postcard/letter/fax to unsubscribe
score T_UNSUBSCRIBE_WTF		2.0

# intended to replace URGENT_BIZ
body T_URGENT_BIZ		/URGENT.{0,16}(?:ASSISTANCE|BUSINESS|BUY|CONFIDENTIAL|NOTICE|PROPOSAL)/i
describe T_URGENT_BIZ		Contains URGENT matter

body T_HTML_COMMENT_EMAIL	eval:html_test('comment_email')
describe T_HTML_COMMENT_EMAIL	HTML comment contains email address

body T_HTML_COMMENT_SKY		eval:html_test('comment_sky')
describe T_HTML_COMMENT_SKY	HTML comment contains SKY database codes

# Needs testing
body T_QUOTE_TWICE_1            /^> >\s/
describe T_QUOTE_TWICE_1        Contains twice quoted reply
score T_QUOTE_TWICE_1           -1.0

# Needs testing
body T_QUOTE_TWICE_2            /^>>/
describe T_QUOTE_TWICE_2        Contains twice quoted reply
score T_QUOTE_TWICE_2           -1.0

# Needs testing
# Outlook Express has spaces around the text, Outlook doesn't
# (jm comment: please add ^ anchor if possible.)
body T_OUTLOOK_REPLY            /----- ?Original Message ?-----/s
describe T_OUTLOOK_REPLY        Contains what looks like an outlook reply
score T_OUTLOOK_REPLY           -1.0

# some good spamsign Message-IDs from another list...
header T_MSGID_SPAMSIGN_ZEROES    Message-Id =~ /^<0000[0-9a-f]{8}\$0000[0-9a-f]{4}\$0000[0-9a-f]{4}\@/
describe T_MSGID_SPAMSIGN_ZEROES  Message-Id generated by spam tool (zeroes variant)
score T_MSGID_SPAMSIGN_ZEROES     2.0

header T_MSGID_SPAMSIGN_6LETTER   Message-Id =~ /^<[0-9][0-9][0-9][a-f]..[a-f]..[a-f].[a-f]\$[0-9a-f]{4}[a-f].[a-f].\$.[a-f][a-f]..[a-f][a-f].\@[a-z]{6}>/
describe T_MSGID_SPAMSIGN_6LETTER Message-Id generated by spam tool (6-letter variant)
score T_MSGID_SPAMSIGN_6LETTER    1.0

# avoid an FP; good ones have a hostname after the @
header T_MSGID_GOOD_EXCHANGE      Message-Id =~ /^<[A-Z]{28}\.\S+\@\S+>$/
score T_MSGID_GOOD_EXCHANGE       -1.0
tflags T_MSGID_GOOD_EXCHANGE      nice

# Looks good, but should be tested first.  fixes current THIS_AINT_SPAM
body T_THIS_AINT_SPAM             /This.{0,30}is.{1,10}not?.{0,15}spam/is
describe T_THIS_AINT_SPAM         Claims "This is not spam"

# possible replacement for GAPPY_SUBJECT
header T_GAPPY_SUBJECT	Subject =~ /\b(?:[a-z][-_. ]{1,3}){4,}/i

###########################################################################
# quinlan: I converted almost 2000 postfix anti-spam rules into SA format,
# tested many permutations of each, refined some into better rules, and
# here are the ones still left standing.  Some are quite good.
#
# to keep this somewhat sane
# - all rulenames are prefixed with "T_Q_"
# - close-variants of same rule have same name with "_V[0-9]" ending
# - other numbered rules are just similar in concept

body T_Q_THIS_IS_AN_AD		/this message is an advertisement/i
header T_Q_ADV_GAPPY		Subject =~ /\bA\s+D\s+V\b/i

body T_Q_APPLY_FREE		/(?-i:F)ree (?-i:A)pplication|free application.{0,32}(?:today|minute|less than)/i

uri T_Q_BTAMAIL_URL		/btamail\.net\.cn/i
header T_Q_FRIEND_PUBLIC	ALL =~ /^(to|cc|from):.*friend\@public\.com/im

header T_Q_FIND_OUT_ANY1 	Subject =~ /Find Out Any/i
body T_Q_FIND_OUT_ANY2		/Find Out Anything About Anyone/i

body T_Q_INSTANT_QUOTE		/free.{0,12}(?:(?:instant|express|online|no.?obligation).{0,4})+.{0,32}\bquote/i

body T_Q_MORTGAGE_BEST		/(?:low(?:est|er)?|free|second|rate|best|refinanc(?:e|ing)|online|instant) mortgage/i
body T_Q_MORTGAGE_PITCH		/mortgage (?:rates?|quotes?|approv(?:al|ed)|payment|interest|loans?|app(?:\b|lication))/i

body T_Q_OKAY1			/cannot be considered spam/i
body T_Q_OKAY2			/sent (?:to you )?in compliance (?:with|of)/i
body T_Q_OKAY3			/Under Bill s.?1618/i

body T_Q_ONETIME1		/One[- ]?Time Mail/i
body T_Q_ONETIME2		/this is a one[- ]?time (?:e-?mail|mailing|offer)/i
body T_Q_ONETIME3		/Never Receive Another Mailing/i

body T_Q_OPT_IN			/(?-i:O)pt.?(?-i:I)n/i
body T_Q_OPT_OUT		/(?-i:O)pt.?(?-i:O)ut/i

rawbody T_Q_PROGRAM_FILE	/name=\".*\.(?:asd|bat|chm|com|dll|exe|hta|lnk|js|jse|ocx|pif|scr|shb|shm|shs|vb|vbe|vbs|vxd|wsf|wsh)\"/i

header T_Q_RATWARE_ENTITY	X-Mailer =~ /MIME-tools.*Entity/i

# this works best as rawbody
rawbody T_Q_REMOVE_URL		/mailto:.*\@.*\?subject=(?:"|3D)*(?:remove?|delete|please.?(?:delete|remove|unsubscribe)|abuse|off\b|stop|take.?me.?off)/i

body T_Q_REMOVE1		/(?:respect|honou?r) all removal requests/i
body T_Q_REMOVE3		/click here to be (?:permanently )?(?:removed|deleted)/i
body T_Q_REMOVE4		/If you no longer wish to receive/i
body T_Q_REMOVE5		/to be removed from (?:the|my|our) (?:mailing|e.?mail|opt[ -]?in)? list/i
body T_Q_REMOVE6		/to be removed from.{0,99}(?:mailings|offers)/i

body T_Q_WEGOTYOU1		/because (?:you're|you (?:are )?)(?:registered|.{0,20}\bopt.{0,3}in)/i
body T_Q_WEGOTYOU2		/you(?:'ve|'re| have| are)? receiv(?:ed|ing) this (?:e.?mail|advertisement) (?:by either|because)/i
body T_Q_WEGOTYOU3		/You Registered At One Of Our/i
body T_Q_WEGOTYOU4		/Your e.?mail Address Was Obtained/i
body T_Q_WEGOTYOU5		/You Are Receiving This Special Offer/i
body T_Q_WEGOTYOU6		/You Have Provided Permission/i

header T_Q_DOMAINS_CHEAP	Subject =~ /(?:new extensions|domain names) now only \$\s*\d+/i
header T_Q_AS_SEEN		Subject =~ /\bAs Seen/i
header T_Q_BAD_CREDIT	 	Subject =~ /Bad Credit/i
header T_Q_DOUBLE_YOUR 		Subject =~ /Double Your/i
header T_Q_FOR_ONLY 		Subject =~ /For Only/i
header T_Q_FREE_INSTANT 	Subject =~ /Free Instant/i
header T_Q_INKJET_PITCH		Subject =~ /inkjet cartridges/i
header T_Q_LIFE_INSURANCE	Subject =~ /Life Insurance/i
header T_Q_LOSE_WEIGHT		Subject =~ /(?:lose .*(?:weight|pounds|lbs)|weight.loss)/i
header T_Q_NOW_ONLY		Subject =~ /\bNow Only/i
header T_Q_RIPPED		Subject =~ /Ripped & Strong/i
header T_Q_SAVE_PERCENT		Subject =~ /save (?:[6-9]\d%|up to \d+%)/i
header T_Q_VIAGRA_SUBJECT	Subject =~ /Viagra/i
header T_Q_YOUR_DEBT		Subject =~ /Your (?:Bills|Debt|Credit)/i
header T_Q_YOUR_FAMILY		Subject =~ /Your Family/i
header T_Q_YOUR_OWN		Subject =~ /Your Own/i
header T_Q_YOUR_PENIS_V1	Subject =~ /Your Penis/i
header T_Q_YOUR_PENIS_V2	Subject =~ /Your (?:Penis|Dick|Sc?hlong)/i

body T_Q_UNPRINTABLE		/[[:^print:]]{8,}/
body T_Q_CREDIT_BODY		/Accept Credit Cards/i
body T_Q_BURNING_FAT		/Aging While Burning Fat/i
body T_Q_CONSOLIDATE_DEBT	/(?:Debt[ -]?Consolidation|Consolidate (?:Debt|Bills))/i
body T_Q_FREE_ADULT		/Free Adult/i
body T_Q_FREE_MEMBERSHIP	/FREE MEMBERSHIP/i
body T_Q_GUARANTEED_BANG	/GUARANTEED!/i
body T_Q_HOME_LOANS		/Home Loans/i
body T_Q_INVALUABLE		/Invaluable Marketing Information/i
body T_Q_LOCATE_ASSETS		/Locate Hidden Assets/i
body T_Q_MILLION_EMAIL		/Million (?:\w+ )?(?:E-?mail )?Addresses/i
body T_Q_NOT_ADVISOR		/not a registered investment advisor/i
body T_Q_PRODUCT_SERVICE_V1	/PRODUCT or SERVICE/i
body T_Q_PRODUCT_SERVICE_V2	/PRODUCTS? or SERVICES?/i
body T_Q_RECEIVE_OFFER		/Receive Special Offer/i
body T_Q_RECEIVE_EMAIL		/Receive Third Party Email/i
body T_Q_REFINANCE_HOME		/Refinance Your Home/i
body T_Q_USE_IDENTITY		/Using Your Identity/i
body T_Q_YOU_CAN_SEARCH		/You Can Search For Anyone/i
body T_Q_YOUR_SIZE_V1		/Your Penis Size/i
body T_Q_YOUR_SIZE_V2		/Your (?:Penis|Dick|Sc?hlong) Size/i
###########################################################################

header FORGED_TELESP_RCVD       Received =~ /\.(?!br).. \(\d+-\d+-\d+-\d+\.dsl\.telesp\.net\.br /
describe FORGED_TELESP_RCVD     Contains forged hostname for a DSL IP in Brazil

# These seem to work well for me to find a "unique identifier" which
# happens to be a rot13 email address
body	T_ROT13_EMAIL	/^(\w+\^\S+\(\S+)(?:\s+\#+\s+\1)?\s*$/m
describe	T_ROT13_EMAIL	Message has what looks like a ROT13 encoded email address

body	T_ROT13_EMAIL_2	/^(\w+\^\S+\(\S+)(?:\s+\#+\s+\1)?[\s\n]*\Z/m
describe	T_ROT13_EMAIL_2	Message has what looks like a ROT13 encoded email address

body	T_ROT13_EMAIL_3	/^(\w+\^\S+\(\S+)/m
describe	T_ROT13_EMAIL_3	Message has what looks like a ROT13 encoded email address
