# SpamAssassin rules file: CVS rules under test
#
# This file is a placeholder for rules "under probation", ie. checked into
# CVS for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
###########################################################################

# should be fixed now
# %%% INVALID_MSGID
header T_INVALID_MSGID		Message-Id !~ /^<(?:[a-zA-Z0-9.,!\#\$%&'*\+\/=?\^_{}|~-]+|\".+\")\@(?:[a-zA-Z0-9_.-]+|\[\d{1,3}(?:\.\d{1,3}){3}\])>(?:\s*\(.*\))?\s*$/ [if-unset: <NO@MSGID>]
describe T_INVALID_MSGID	Message-Id is not valid, according to RFC 2822

# results for quinlan
#  0.149    0.458    0.000    1.00    0.72    0.50  T_FROM_TOPICA
header T_FROM_TOPICA		From:addr =~ /\@(?:\w+\.)?email-publisher\.com$/
describe T_FROM_TOPICA		From an address at email-publisher.com
score T_FROM_TOPICA		0.5

# results for quinlan
#  0.245    0.727    0.013    0.98    0.57    0.50  T_FROM_ALL_NUMS
header __FROM_JUST_NUMBER	From:addr =~ /^\d+\@/
header __FROM_PHONE		From:addr =~ /^\d{3}(?:[-.]?\d{3}[-.]?\d{4}|\d{7})\@/
meta T_FROM_ALL_NUMS		(__FROM_JUST_NUMBER && !__FROM_PHONE)
describe T_FROM_ALL_NUMS	From an address that is all numbers (non-phone)
score T_FROM_ALL_NUMS		0.5

# seems like the hit rate is a bit too low on this one
uri T_ADCLICK_URL		m,\Qhttp://www.adclick.ws/p\E,
describe T_ADCLICK_URL		Contains adclick URL

# Needs testing
body T_QUOTE_TWICE_1		/^> >\s/
describe T_QUOTE_TWICE_1	Contains twice quoted reply
tflags T_QUOTE_TWICE_1		nice
score T_QUOTE_TWICE_1		-1.0

header __ORIGINAL_MESSAGE_AGENT	X-Mailer =~ /\b(?:Microsoft Outlook|Internet Mail Service|Mozilla|AOL)\b/
rawbody __ORIGINAL_MESSAGE_LINE	/^-{5,8} ?Original Message ?-{5,8}$/
meta T_ORIGINAL_MESSAGE		(__ORIGINAL_MESSAGE_AGENT && __ORIGINAL_MESSAGE_LINE)
describe T_ORIGINAL_MESSAGE	Looks like a reply to a message
tflags T_ORIGINAL_MESSAGE	nice
score T_ORIGINAL_MESSAGE	-1.0

# avoid an FP; good ones have a hostname after the @
header T_MSGID_GOOD_EXCHANGE	Message-Id =~ /^<[A-Z]{28}\.\S+\@\S+>$/
tflags T_MSGID_GOOD_EXCHANGE	nice
score T_MSGID_GOOD_EXCHANGE	-1.0

# this rule may need to factor in ok_languages or ok_locales
body T_BODY_UNPRINTABLE		/[\x00-\x08\x0b\x0c\x0e-\x1f\x7f]{3,}/
describe T_BODY_UNPRINTABLE	Body includes 3 consecutive unprintable characters

# this rule may need to factor in ok_languages or ok_locales
body T_BODY_8BITS		/[\x80-\xff]{8,}/
describe T_BODY_8BITS		Body includes 8 consecutive 8-bit characters

# HTML control -- HTML spam rules should all have better S/O than this
body T_HTML_MESSAGE		eval:html_message()

# HTML input form tests
# T_HTML_TAG_EXISTS_FORM has about the same accuracy as HTML_MESSAGE
body T_HTML_TAG_EXISTS_FORM     eval:html_tag_exists('form')
body T_HTML_FORM_HIDDEN_EMAIL1	eval:html_test('t_form_hidden_email1')
body T_HTML_FORM_HIDDEN_EMAIL2	eval:html_test('t_form_hidden_email2')

# replacements
# %%% HTML_JAVASCRIPT
# %%% HTML_JAVASCRIPT_UNSAFE
# %%% HTML_JAVASCRIPT_VERY_UNSAFE
body T_HTML_EVENT		eval:html_test('t_html_event')
body T_HTML_EVENT_UNSAFE	eval:html_test('t_html_event_unsafe')

# a new JAVASCRIPT rule
body T_HTML_WIN_FOCUS		eval:html_test('window_focus')

# spam URLs containing "china"
header T_CHINA_HEADER		ALL =~ /\@china\.com/i
uri T_CHINA_URL			/(?:freehost|yada)china\.com/i

# plain old body rule
# group with SENT_IN_COMPLIANCE
body T_FURTHER_TRANSMISSIONS	/further transmissions to you by the sender/i
describe T_FURTHER_TRANSMISSIONS	Claims compliance with spam regulations
score T_FURTHER_TRANSMISSIONS	1.0

# mortgage and refinance rules
body T_MORTGAGE_WAITING		/mortgage companies make you wait/i
body T_MORTGAGE_NETWORK		/will be transmitted to our network of mortgage specialists/i
body T_REFINANCE_NOW		/time to refinance|refinanc\w{1,3}\b.{0,16}\bnow\b/i
body T_HELPED_FINANCE		/you helped me finance a new home and I got a very good deal/i
body T_FALLING_INTEREST		/falling interest/i

body T_ORDER_REPORT		/order report .\s?\d from/i
describe T_ORDER_REPORT		Order a report from someone

# some body tests
body T_BROADCAST_EMAIL		/broadcast e.?mail/i
body T_OUR_AFFILIATE_PARTNERS	/our affiliate partners/i
body T_OUR_BROADCAST_EMAIL	/our broadcast e.?mail/i
body T_OUR_COMPENSATION		/our (?:full )?compensation/i
body T_OUR_OVERWHELMING_GROWTH	/our overwhelming growth/i
body T_OUR_POLICY_ON_SELLING	/our policy on selling/i
body T_OUR_PRIVACY_POLICY	/our privacy policy can be found/i
body T_OUR_READERS		/our readers (?:to|with)/i
body T_OUR_STRICT_ANTI		/our strict anti/i
body T_OUR_PUBLICATIONS		/our website (?:and|or) publications/i
# more body tests
body T_CELL_PHONE_BOOST		/(?:boost|antenna|reception|signal).{0,32}(?:cell|mobile|phone|cord.?less)|(?:cell|mobile|phone|cord.?less).{0,32}(?:boost|antenna|reception|signal)/i
body T_OFFERS_ETC_1		/(?:(?:wish|want|unsub|reward|receive|recurring|remove|permission|partner|further|future|e.?mail|continue|click).{0,64}){2}.{0,8}(?:specials?|offers?|coupons?|discounts?)\b/i
body T_OFFERS_ETC_2		/(?:(?:wish|want|unsub|reward|receive|recurring|remove|permission|partner|further|future|e.?mail|continue|click).{0,48}){2}.{0,32}(?:specials?|offers?|coupons?|discounts?)\b/i

# replacement
# do not add "new" since there's non-spam about "new cell phone numbers"
# %%% FREE_CELL_PHONE
body T_FREE_CELL_PHONE		/\bfree\b.{0,24}(?:cell(?:ular)?|mobile).{0,4}phones?|(?:cell(?:ular)?|mobile).{0,4}phones?.{0,24}\bfree\b/i

# dear user
body T_DEAR_USER		/dear(?: \w+)? user/i

# new porn rules
body T_PORN_15			/(?:college|eating|licking|spears|tight|wet|shaved|voyeur|young|teen(?:age)?).{0,16}pussy/i
body T_PORN_16			/(?:nasty|teen|dir(?:ty|iest)?|little).{0,16}\bsluts?/i

# 419 spam, group/merge with other Nigeria rules
body T_MILLION_USD		/Million\b.{0,40}\b(?:United States? Dollars?|USD)/i

# multiple spaces in subject lines, and other ways of embedding tracking codes
header T_SUBJ_HAS_TIME_ID	Subject =~ /\sTime[: ]+\d+:\d+:\d+ [AP]M\s*$/i

# faked addresses tend to come from big public sites
#
# first rule just requires fewer digits than the second, I get no FPs for
# length 4 and above
#
# I get FPs and not many more spam hits if I try to allow hits on more than
# one line (it seems like spammers tend to put the faked addresses at the
# beginning of address lists)
#
header T_ADDR_NUMS_BIGSITE_1	ALL =~ /^(To|From|Cc|Reply-To):\s*<?\S+\d{4,}\@(?:aol|bigfoot|compuserve|excite|hotmail|juno|prodigy|yahoo)\.(?:com|net|org)/mi
header T_ADDR_NUMS_BIGSITE_2	ALL =~ /^(To|From|Cc|Reply-To):\s*<?\S+\d{5,}\@(?:aol|bigfoot|compuserve|excite|hotmail|juno|prodigy|yahoo)\.(?:com|net|org)/mi

# to replace CHARSET_FARAWAY_BODY
# %%% CHARSET_FARAWAY_BODY
rawbody __MIME_FARAWAY_CHARSET	eval:check_for_mime_faraway_charset()
body __HIGHBITS			/(?:[\x80-\xff].?){4,}/
meta T_MIME_FARAWAY_CHARSET	(__MIME_FARAWAY_CHARSET && __HIGHBITS)
tflags T_MIME_FARAWAY_CHARSET userconf

body T_MIME_EXCESSIVE_BASE64		eval:check_for_mime_excessive_base64()
describe T_MIME_EXCESSIVE_BASE64	base64 encoding without base64 header

########################################################################

header __CD			exists:Content-Disposition
header __CT			exists:Content-Type
header __CTE			exists:Content-Transfer-Encoding
header __MIME_VERSION		exists:MIME-Version

# best four variants so far (rename later)
meta T_MIME_NO_VERSION_ODD	((__CD + __CTE + __CT == 1) && !__MIME_VERSION)
meta T_MIME_NO_VERSION_LONER	(__CD + __CTE + __CT + __MIME_VERSION == 1)
meta T_MIME_NO_VERSION_CTYPE	(__CT && !__MIME_VERSION)
meta T_MIME_NO_VERSION_ANY	((__CD || __CTE || __CT) && !__MIME_VERSION)
# new test variants (at least as good as the above variants)
meta T_MIME_HEADER_CTYPE_ONLY	(!__CD && !__CTE && __CT && !__MIME_VERSION)

########################################################################
# bug 1106: forged MUAs
# only needed a \b around the shortest X-Mailer regular expressions

# AOL
header __AOL_MUA		X-Mailer =~ /\bAOL\b/
header __AOL_MSGID		Message-Id =~ /^<[0-9a-f]{1,3}\.[0-9a-f]{6,8}\.[0-9a-f]{8}\@aol.com>$/
meta T_FORGED_MUA_AOL		(__AOL_MUA && !__AOL_MSGID)
describe T_FORGED_MUA_AOL	Forged mail pretending to be from AOL
score T_FORGED_MUA_AOL		1.0

# Internet Mail Service
header __IMS_MUA		X-Mailer =~ /Internet Mail Service/
header __IMS_MSGID		Message-Id =~ /^<[A-F\d]{36,40}\@\S+>$/
meta T_FORGED_MUA_IMS		(__IMS_MUA && !__IMS_MSGID)
describe T_FORGED_MUA_IMS	Forged mail pretending to be from IMS
score T_FORGED_MUA_IMS		1.0

# Mozilla
header __MOZILLA_MUA		X-Mailer =~ /\bMozilla\b/
header __MOZILLA_MSGID		Message-Id =~ /^<[A-F\d]{8}\.[A-F\d]{6,8}\@\S+>$/
meta T_FORGED_MUA_MOZILLA	(__MOZILLA_MUA && !__MOZILLA_MSGID)
describe T_FORGED_MUA_MOZILLA	Forged mail pretending to be from Mozilla
score T_FORGED_MUA_MOZILLA	1.0

header __MOZILLA_WEB		X-Mailer =~ /\bvia\s+https?:\/\//i
header __MOZILLA_MSGID2		Message-Id =~ /^<[A-F\d]{8}\.[A-F\d]{4,8}\@\S+>$/
meta T_FORGED_MUA_MOZILLA2	(__MOZILLA_MUA && !__MOZILLA_MSGID2 && !__MOZILLA_WEB)
meta T_FORGED_MUA_MOZILLA3	(__MOZILLA_MUA && !__MOZILLA_MSGID2)

# Outlook
header __OUTLOOK_MUA		X-Mailer =~ /\bOutlook\b(?! IMO)/
header __OUTLOOK_MSGID_1	Message-Id =~ /^<[0-9a-f]{12}\$[0-9a-f]{8}\$[0-9a-f]{8}\@\S+>$/
header __OUTLOOK_MSGID_2	Message-Id =~ /^<OE[0-9A-Za-z]{25}\@hotmail\.com>$/
header __OUTLOOK_MSGID_3	Message-Id =~ /^<DAV[0-9A-Za-z]{24}\@hotmail\.com>$/
meta T_FORGED_MUA_OUTLOOK	(__OUTLOOK_MUA && !(__OUTLOOK_MSGID_1 || __OUTLOOK_MSGID_2 || __OUTLOOK_MSGID_3))
describe T_FORGED_MUA_OUTLOOK	Forged mail pretending to be from Outlook
score T_FORGED_MUA_OUTLOOK	1.0

# Outlook IMO (Internet Mail Only)
header __OIMO_MUA		X-Mailer =~ /Outlook IMO/
header __OIMO_MSGID		Message-Id =~ /^<[A-P]{26}AA\.[\w.-]+\@\S+>$/
meta T_FORGED_MUA_OIMO		(__OIMO_MUA && !__OIMO_MSGID)
describe T_FORGED_MUA_OIMO	Forged mail pretending to be from Outlook IMO
score T_FORGED_MUA_OIMO		1.0

# QUALCOMM Eudora
header __EUDORA_MUA		X-Mailer =~ /\b(?:QUALCOMM|Eudora)\b/
header __EUDORA_MSGID		Message-Id =~ /^<(?:\d\d?\.){4,5}\d{14}\.[a-f0-9]{8}\@\S+>$/
meta T_FORGED_MUA_EUDORA	(__EUDORA_MUA && !__EUDORA_MSGID)
describe T_FORGED_MUA_EUDORA	Forged mail pretending to be from Eudora
score T_FORGED_MUA_EUDORA	1.0

# The Bat!
header __THEBAT_MUA		X-Mailer =~ /The Bat!/
header __THEBAT_MSGID		Message-Id =~ /^<\d+\.\d+\@\S+>$/
meta T_FORGED_MUA_THEBAT	(__THEBAT_MUA && !__THEBAT_MSGID)
describe T_FORGED_MUA_THEBAT	Forged mail pretending to be from The Bat!
score T_FORGED_MUA_THEBAT	1.0

########################################################################

# this is the only To/Cc/From "no lower" version of this idea with a
# somewhat reasonable S/O ratio
header T_FROM_NO_LOWER		From !~ /[a-z]/

###########################################################################

body T_BANG_BOSS		/\bboss!/i
body T_BANG_CARTOONS		/\bcartoons!/i
body T_BANG_CYBERANALYSTS	/\bcyberanalysts!/i
body T_BANG_EXERCISE		/\bexercis(?:e|er|es)!/i
body T_BANG_GUARANTEE		/\bguaranteed?\!/i
body T_BANG_MONEY		/\bmoney!/i
body T_BANG_MORE		/\b(?-i:M)ore!/i
body T_BANG_OFFER		/\boffer(?:ed|s)!/i
body T_BANG_OPRAH		/\boprah!/i
body T_BANG_QUOTE		/\b(?-i:Q)uotes?\!/i

###########################################################################

body T_OBSCURED_EMAIL		/^\w+\^\S+\(\w{2,3}\b/m
describe T_OBSCURED_EMAIL	Message seems to contain obscured email address (rot13)

# mailman list reminder mails are getting tagged in 2.41, adding a rule to check for these
header __FROM_MAILMAN_OWNER	From:addr =~ /^mailman-owner@/
header __SUBJECT_MAILMAN_REMIND	Subject =~ /\bmailing list memberships reminder\b/
meta T_MAILMAN_REMINDER		(__FROM_MAILMAN_OWNER && __SUBJECT_MAILMAN_REMIND)
describe T_MAILMAN_REMINDER	Mail headers indicate a mailman membership reminder
score T_MAILMAN_REMINDER		-3
tflags T_MAILMAN_REMINDER nice

########################################################

header   T_NONSENSE_FROM_1      From:addr =~ /[^\W\daeiouy_-]{5}\S*\@/i
describe T_NONSENSE_FROM_1      From user name appears to be nonsense (1)

header   T_NONSENSE_FROM_2      From:addr =~ /[^\W\daeiouy_-]{6,}\S*\@/i
describe T_NONSENSE_FROM_2      From user name appears to be nonsense (2)

header   T_NONSENSE_FROM_00_10  eval:nonsense_from_percent('00', '10')
describe T_NONSENSE_FROM_00_10  0%-10% weird trigraphs in From

header   T_NONSENSE_FROM_10_20  eval:nonsense_from_percent('10', '20')
describe T_NONSENSE_FROM_10_20  10%-20% weird trigraphs in From

header   T_NONSENSE_FROM_20_30  eval:nonsense_from_percent('20', '30')
describe T_NONSENSE_FROM_20_30  20%-30% weird trigraphs in From

header   T_NONSENSE_FROM_30_40  eval:nonsense_from_percent('30', '40')
describe T_NONSENSE_FROM_30_40  30%-40% weird trigraphs in From

header   T_NONSENSE_FROM_40_50  eval:nonsense_from_percent('40', '50')
describe T_NONSENSE_FROM_40_50  40%-50% weird trigraphs in From

header   T_NONSENSE_FROM_50_60  eval:nonsense_from_percent('50', '60')
describe T_NONSENSE_FROM_50_60  50%-60% weird trigraphs in From

header   T_NONSENSE_FROM_60_70  eval:nonsense_from_percent('60', '70')
describe T_NONSENSE_FROM_60_70  60%-70% weird trigraphs in From

header   T_NONSENSE_FROM_70_80  eval:nonsense_from_percent('70', '80')
describe T_NONSENSE_FROM_70_80  70%-80% weird trigraphs in From

header   T_NONSENSE_FROM_80_90  eval:nonsense_from_percent('80', '90')
describe T_NONSENSE_FROM_80_90  80%-90% weird trigraphs in From

#header   T_NONSENSE_FROM_90_100 eval:nonsense_from_percent('90', '100')
#describe T_NONSENSE_FROM_90_100 90%-100% weird trigraphs in From

header   T_NONSENSE_FROM_90_91 eval:nonsense_from_percent('90', '91')
header   T_NONSENSE_FROM_91_92 eval:nonsense_from_percent('91', '92')
header   T_NONSENSE_FROM_92_93 eval:nonsense_from_percent('92', '93')
header   T_NONSENSE_FROM_93_94 eval:nonsense_from_percent('93', '94')
header   T_NONSENSE_FROM_94_95 eval:nonsense_from_percent('94', '95')
header   T_NONSENSE_FROM_95_96 eval:nonsense_from_percent('95', '96')
header   T_NONSENSE_FROM_96_97 eval:nonsense_from_percent('96', '97')
header   T_NONSENSE_FROM_97_98 eval:nonsense_from_percent('97', '98')
header   T_NONSENSE_FROM_98_99 eval:nonsense_from_percent('98', '99')
header   T_NONSENSE_FROM_99_100 eval:nonsense_from_percent('99', '100')

############################################################

body T_HTML_IMAGE_AREA01	eval:html_range('total_image_area','0','1000')
body T_HTML_IMAGE_AREA02	eval:html_range('total_image_area','1000','5000')
body T_HTML_IMAGE_AREA03	eval:html_range('total_image_area','10000','20000')
body T_HTML_IMAGE_AREA04	eval:html_range('total_image_area','20000','30000')
body T_HTML_IMAGE_AREA05	eval:html_range('total_image_area','30000','40000')
body T_HTML_IMAGE_AREA06	eval:html_range('total_image_area','40000','50000')
body T_HTML_IMAGE_AREA07	eval:html_range('total_image_area','50000','60000')
body T_HTML_IMAGE_AREA08	eval:html_range('total_image_area','60000','70000')
body T_HTML_IMAGE_AREA09	eval:html_range('total_image_area','70000','80000')
body T_HTML_IMAGE_AREA10	eval:html_range('total_image_area','80000','90000')
body T_HTML_IMAGE_AREA11	eval:html_range('total_image_area','100000','200000')
body T_HTML_IMAGE_AREA12	eval:html_range('total_image_area','200000','300000')
body T_HTML_IMAGE_AREA13	eval:html_range('total_image_area','300000','400000')
body T_HTML_IMAGE_AREA14	eval:html_range('total_image_area','400000','500000')
body T_HTML_IMAGE_AREA15	eval:html_range('total_image_area','500000','600000')
body T_HTML_IMAGE_AREA16	eval:html_range('total_image_area','600000','700000')
body T_HTML_IMAGE_AREA17	eval:html_range('total_image_area','700000','800000')
body T_HTML_IMAGE_AREA18	eval:html_range('total_image_area','800000','900000')
body T_HTML_IMAGE_AREA19	eval:html_range('total_image_area','1000000')

body T_HTML_NUM_IMGS01          eval:html_range('num_imgs','0','1')
body T_HTML_NUM_IMGS02          eval:html_range('num_imgs','1','2')
body T_HTML_NUM_IMGS03          eval:html_range('num_imgs','2','3')
body T_HTML_NUM_IMGS04          eval:html_range('num_imgs','3','4')
body T_HTML_NUM_IMGS05          eval:html_range('num_imgs','4','5')
body T_HTML_NUM_IMGS06          eval:html_range('num_imgs','5','6')
body T_HTML_NUM_IMGS07          eval:html_range('num_imgs','6','7')
body T_HTML_NUM_IMGS08          eval:html_range('num_imgs','7','8')
body T_HTML_NUM_IMGS09          eval:html_range('num_imgs','8','9')
body T_HTML_NUM_IMGS10          eval:html_range('num_imgs','9','10')
body T_HTML_NUM_IMGS11          eval:html_range('num_imgs','10','20')
body T_HTML_NUM_IMGS12          eval:html_range('num_imgs','20','30')
body T_HTML_NUM_IMGS13          eval:html_range('num_imgs','30','40')
body T_HTML_NUM_IMGS14          eval:html_range('num_imgs','40','50')
body T_HTML_NUM_IMGS15          eval:html_range('num_imgs','50','60')
body T_HTML_NUM_IMGS16          eval:html_range('num_imgs','60','70')
body T_HTML_NUM_IMGS17          eval:html_range('num_imgs','70','80')
body T_HTML_NUM_IMGS18          eval:html_range('num_imgs','80','90')
body T_HTML_NUM_IMGS19          eval:html_range('num_imgs','90','100')
body T_HTML_NUM_IMGS20          eval:html_range('num_imgs','100')

body T_HTML_CONSEC_IMGS01       eval:html_range('max_consec_imgs','1','2')
body T_HTML_CONSEC_IMGS02       eval:html_range('max_consec_imgs','2','3')
body T_HTML_CONSEC_IMGS03       eval:html_range('max_consec_imgs','3','4')
body T_HTML_CONSEC_IMGS04       eval:html_range('max_consec_imgs','4','5')
body T_HTML_CONSEC_IMGS05       eval:html_range('max_consec_imgs','5','6')
body T_HTML_CONSEC_IMGS06       eval:html_range('max_consec_imgs','6','7')
body T_HTML_CONSEC_IMGS07       eval:html_range('max_consec_imgs','7','8')
body T_HTML_CONSEC_IMGS08       eval:html_range('max_consec_imgs','8','9')
body T_HTML_CONSEC_IMGS09       eval:html_range('max_consec_imgs','9','10')
body T_HTML_CONSEC_IMGS10       eval:html_range('max_consec_imgs','10','20')
body T_HTML_CONSEC_IMGS11       eval:html_range('max_consec_imgs','20','30')
body T_HTML_CONSEC_IMGS12       eval:html_range('max_consec_imgs','30','40')
body T_HTML_CONSEC_IMGS13       eval:html_range('max_consec_imgs','40','50')
body T_HTML_CONSEC_IMGS14       eval:html_range('max_consec_imgs','50','60')
body T_HTML_CONSEC_IMGS15       eval:html_range('max_consec_imgs','60','70')
body T_HTML_CONSEC_IMGS16       eval:html_range('max_consec_imgs','70','80')
body T_HTML_CONSEC_IMGS17       eval:html_range('max_consec_imgs','80','90')
body T_HTML_CONSEC_IMGS18       eval:html_range('max_consec_imgs','90','100')
body T_HTML_CONSEC_IMGS19       eval:html_range('max_consec_imgs','100')



body T_HTML_MAX_IMG_RATIO01     eval:html_range('max_img_ratio','0.0','0.5')
body T_HTML_MAX_IMG_RATIO02     eval:html_range('max_img_ratio','0.5','0.999')
meta T_HTML_MAX_IMG_RATIO02B    (T_HTML_MAX_IMG_RATIO02 && !FROM_EGROUPS)
body T_HTML_MAX_IMG_RATIO03     eval:html_range('max_img_ratio','5','10')
meta T_HTML_MAX_IMG_RATIO03B    (T_HTML_MAX_IMG_RATIO03 && !FROM_EGROUPS)
body T_HTML_MAX_IMG_RATIO04     eval:html_range('max_img_ratio','10','20')
body T_HTML_MAX_IMG_RATIO05     eval:html_range('max_img_ratio','20','30')
body T_HTML_MAX_IMG_RATIO06     eval:html_range('max_img_ratio','30','40')
body T_HTML_MAX_IMG_RATIO07     eval:html_range('max_img_ratio','40','50')
body T_HTML_MAX_IMG_RATIO08     eval:html_range('max_img_ratio','50','75')
body T_HTML_MAX_IMG_RATIO09     eval:html_range('max_img_ratio','75','100')
body T_HTML_MAX_IMG_RATIO10     eval:html_range('max_img_ratio','100')

body T_HTML_MIN_IMG_RATIO1      eval:html_range('min_img_ratio','0.0','0.01')
body T_HTML_MIN_IMG_RATIO2      eval:html_range('min_img_ratio','0.01','0.1')
body T_HTML_MIN_IMG_RATIO3      eval:html_range('min_img_ratio','0.1','0.25')
body T_HTML_MIN_IMG_RATIO4      eval:html_range('min_img_ratio','0.25','0.50')
body T_HTML_MIN_IMG_RATIO5      eval:html_range('min_img_ratio','0.50','0.75')
body T_HTML_MIN_IMG_RATIO6      eval:html_range('min_img_ratio','0.75','0.999')

#---------------------------------------------------------

meta T_HTML_NUM_IMGS01B         (T_HTML_NUM_IMGS01 && !FROM_EGROUPS)
meta T_HTML_NUM_IMGS02B         (T_HTML_NUM_IMGS02 && !FROM_EGROUPS)

meta T_HTML_CONSEC_IMGS01B      (T_HTML_CONSEC_IMGS01 && !FROM_EGROUPS)

meta T_HTML_IMAGE_AREA03B       (T_HTML_IMAGE_AREA03 && !FROM_EGROUPS)
meta T_HTML_IMAGE_AREA04B       (T_HTML_IMAGE_AREA04 && !FROM_EGROUPS)
meta T_HTML_IMAGE_AREA05B       (T_HTML_IMAGE_AREA05 && !FROM_EGROUPS)
meta T_HTML_IMAGE_AREA06B       (T_HTML_IMAGE_AREA06 && !FROM_EGROUPS)

# HTML_50_70 with at least 3 IMG tags
body __T_HTML_NUM_IMGS_3        eval:html_range('num_imgs','3')
meta T_HTML_50_70_IMGS3         (HTML_50_70 && __T_HTML_NUM_IMGS_3)

#---------------------------------------------------------

####################################################################

header T_FROM_ENDS_IN_NUMS1       From =~ /\D\d\@/
header T_FROM_ENDS_IN_NUMS2       From =~ /\D\d\d\@/
header T_FROM_ENDS_IN_NUMS3       From =~ /\D\d\d\d\@/
header T_FROM_ENDS_IN_NUMS4       From =~ /\D\d\d\d\d\@/
header T_FROM_ENDS_IN_NUMS5       From =~ /\D\d\d\d\d\d\@/
header T_FROM_ENDS_IN_NUMS6       From =~ /\d\d\d\d\d\d\@/

############################################################

meta T_CONFIRMED_FORGED         (FORGED_RCVD_TRAIL && (FORGED_AOL_RCVD || FORGED_HOTMAIL_RCVD || FORGED_EUDORAMAIL_RCVD || FORGED_YAHOO_RCVD || FORGED_JUNO_RCVD || FORGED_GW05_RCVD || FORGED_MX_HOTMAIL))

meta T_MULTI_FORGED             ((FORGED_AOL_RCVD + FORGED_HOTMAIL_RCVD + FORGED_EUDORAMAIL_RCVD + FORGED_YAHOO_RCVD + FORGED_JUNO_RCVD + FORGED_GW05_RCVD) > 1)

###########################################################

body T_HTML_TAG_EXISTS_CENTER    eval:html_tag_exists('center')
# T_HTML_TAG_EXISTS_HX has about the same accuracy as HTML_MESSAGE
body T_HTML_TAG_EXISTS_HX        eval:html_test('header_tag')

body T_HTML_BIG_FONT_B           eval:html_test('big_font_B')
body T_HTML_FONT_SIZE_PX         eval:html_test('font_px')
body T_HTML_STYLE_LINE_HEIGHT    eval:html_test('line_height')

body T_HTML_SHOUTING1            eval:html_range('max_shouting','0','1')
body T_HTML_SHOUTING2            eval:html_range('max_shouting','1','2')
body T_HTML_SHOUTING3            eval:html_range('max_shouting','2','3')
body T_HTML_SHOUTING4            eval:html_range('max_shouting','3','4')
body T_HTML_SHOUTING5            eval:html_range('max_shouting','4','5')
body T_HTML_SHOUTING6            eval:html_range('max_shouting','5','6')
body T_HTML_SHOUTING7            eval:html_range('max_shouting','6','7')
body T_HTML_SHOUTING8            eval:html_range('max_shouting','7','8')
body T_HTML_SHOUTING9            eval:html_range('max_shouting','8')

##################################################################
# testing the HTML percentage range
# this will be necessary if the HTML heuristics test is changed
# (probably best to go with deciles, replacing HTML_XX_YY rules)

body T_HTML_P1_00_20		eval:html_percentage('00','20')
body T_HTML_P1_20_40		eval:html_percentage('20','40')
body T_HTML_P1_40_60		eval:html_percentage('40','60')
body T_HTML_P1_60_80		eval:html_percentage('60','80')
body T_HTML_P1_80_100		eval:html_percentage('80','100')

body T_HTML_P2_00_10		eval:html_percentage('00','10')
body T_HTML_P2_10_20		eval:html_percentage('10','20')
body T_HTML_P2_20_30		eval:html_percentage('20','30')
body T_HTML_P2_30_40		eval:html_percentage('30','40')
body T_HTML_P2_40_50		eval:html_percentage('40','50')
body T_HTML_P2_50_60		eval:html_percentage('50','60')
body T_HTML_P2_60_70		eval:html_percentage('60','70')
body T_HTML_P2_70_80		eval:html_percentage('70','80')
body T_HTML_P2_80_90		eval:html_percentage('80','90')
body T_HTML_P2_90_100		eval:html_percentage('90','100')

##################################################################

body T_HTML_MAIL_ONLY             /HTML only email, sorry/i

# Most/all of these require that From addresses do not start with numbers.
# let's see how this does... (jm)
header T_FROM_NUM_AT_WEBMAIL    From:addr =~ /^\d\S+\@(?:msn\.com|flashmail\.com|mailexcite\.com|prodigy\.net|yahoo\.\S+|hotmail\.com|eudoramail\.com|aol\.com|excite\.com|email\.com|earthlink\.net|geocities\.com|hknetmail\.com|angelfire\.com)/i
describe T_FROM_NUM_AT_WEBMAIL  From address is webmail, but starts with a number

# actually, this looks really good!
header T_FROM_OFFERS            From:addr =~ /offers\S*\@/
describe T_FROM_OFFERS          From address is "offers at something"

# These three have had their ' ' (space) with \s+ for slightly better
# results on my corpus.  If it looks good for everyone, these can replace
# the non-T_ version.  Ignore the scores, they're just there to
# avoid confusion.
rawbody T_CLICK_HERE_LINK               /click\s+here.{0,100}<\/a>/is
rawbody T_CLICK_HERE_CAPS_LINK  /CLICK\s+HERE.{0,100}<\/[aA]>/s
rawbody T_QUOTED_EMAIL_TEXT     /^>+\s+.{60,72}$/
score T_CLICK_HERE_CAPS_LINK           0.634
score T_QUOTED_EMAIL_TEXT              -0.2
score T_CLICK_HERE_LINK                0.317
tflags T_QUOTED_EMAIL_TEXT nice

body     T_HTML_LINK_CLICK_HERE eval:html_eval('anchor_text', '=~ /click\s+here/i')
body     T_HTML_LINK_MONEY      eval:html_eval('anchor_text', '=~/\s\$/')
body     T_HTML_LINK_UNSUB      eval:html_eval('anchor_text', '=~/unsubscribe/i')

# Some spammers try to get multiple negative scores by adding in different
# user-agent looking headers.  TOO_MANY_UA adds up all of our USER_AGENT
# tests and matches if more than 1 hits.  UA_AND_XM actually matches a
# good amount of non-spam at the moment, the above problem can trigger
# this rule as well.
#
# quinlan: these don't work too well for me
#  0.000    0.000    0.000    0.00    0.00    1.00  T_TOO_MANY_UA
#  0.202    0.000    0.325    0.00    0.00    1.00  T_UA_AND_XM
#
# T_TOO_MANY_UA uses "regexp and operator": all of the tests matching
# regexp /USER_AGENT.*/ will be strung together with "+" between them.
#meta T_TOO_MANY_UA	( (USER_AGENT.+ +) > 1)
#meta T_UA_AND_XM	( USER_AGENT && __HAS_X_MAILER )
#
# quinlan: these might work better, but I have no hits (they should be
# syntactically correct, though)
#
header T_MANY_X_MAILER		ALL =~ /(?:\nX-Mailer:.*){2}/si
header T_MANY_USER_AGENT	ALL =~ /(?:\nUser-Agent:.*){2}/si

# thanks to Jason Staples for this suggestion. Sendmail and other MTAs
# will often query the ident server on a relay; Squid proxies should not be
# sending mail.

header T_IDENT_SQUID		Received =~ /ident[:=]squid\b/i
describe T_IDENT_SQUID		Message was sent by a Squid HTTP proxy
score T_IDENT_SQUID		1.0

header T_IDENT_NOBODY		Received =~ /ident[:=]nobody\b/i
describe T_IDENT_NOBODY		Message was sent by nobody
score T_IDENT_NOBODY		1.0

# I spent the better part of a day hacking around with the Message-Id
# stuff.  I found a few new regexps that works fairly well on my corpus
# with no overlap of the current MSGID_* rules. - tvd
#  1.222    3.058    0.066    0.98    0.63    1.00  T_MSGID_S_1
header __T_MSGID_17	Message-Id =~ /^<?DGTBAD\S+\@/
header __T_MSGID_10	Message-Id =~ /^<?(?:\d+\$){3}\d+\@/
header __T_MSGID_8	Message-Id =~ /^<?\d{4}\$\w+\@/
header __T_MSGID_20	Message-Id =~ /^<?EXCH\S+\@/
header __T_MSGID_19	Message-Id =~ /^<?\w{7}-\w{6}-\w{2}\.\d{4}(?:-\d{2}){5}\@/
header __T_MSGID_11	Message-Id =~ /^<?\d\w+\$\w{4,}\@/
header __T_MSGID_24	Message-Id =~ /^<?[A-Z0-9_-]*SERV[A-Za-z0-9_-]+[0-9a-f]{8}\@/
header __T_MSGID_26	Message-Id =~ /^<?[A-Z0-9_-]*MAIL[a-zA-Z0-9_-]+0000[0-9a-f]{4}\@/
#header __T_MSGID_37	Message-Id =~ /^<?\d{13,}\.SM\d+\@[^>]/
#header __T_MSGID_16	Message-Id =~ /^<?[A-Z]\d{10}\@/
header __T_MSGID_32	Message-Id =~ /^<?auto-00000\d+\@/
meta T_MSGID_S_1	( __T_MSGID_17 || __T_MSGID_10 || __T_MSGID_8 || __T_MSGID_20 || __T_MSGID_19 || __T_MSGID_11 || __T_MSGID_24 || __T_MSGID_26 || __T_MSGID_32 )

# Matt Cline: New ratware and user-agent tests
header T_RATWARE_BIXON       X-Mailer =~ /Bixon ThunderMail/
header T_RATWARE_BULK_MAILER X-Mailer =~ /BulkMailer/
header T_RATWARE_BANG_HASH   X-Mailer =~ /!.*\#.*\*/
header T_RATWARE_HASH_2_V2   X-Mailer =~ /^[A-Za-z0-9\._]{14,}$/
header T_RATWARE_FLOAT       X-Mailer =~ /^\d\.\d\d/
header T_RATWARE_CHARSET_V2  X-Mailer =~ /^normal \W \W\s*charset.*=\"/

header T_USER_AGENT_FORTE    X-Mailer =~ /^Forte Agent \d\.\d+\/\d+\.\d+$/
score  T_USER_AGENT_FORTE    -0.5
tflags T_USER_AGENT_FORTE    nice

header T_USER_AGENT_MSN      X-Mailer =~ /^MSN Explorer \d\.\d\d\.\d{4}\.\d{4}$/
score  T_USER_AGENT_MSN      -0.5
tflags T_USER_AGENT_MSN      nice

header T_USER_AGENT_PERL1    X-Mailer =~ /^Perl\d Mail::Internet v\d\.\d+$/
score  T_USER_AGENT_PERL1    -0.5
tflags T_USER_AGENT_PERL1    nice

header T_USER_AGENT_PERL2    X-Mailer =~ /^Perl Mail::Sender \d\.\d+\.\d+/
score  T_USER_AGENT_PERL2    -0.5
tflags T_USER_AGENT_PERL2    nice

header T_USER_AGENT_PERL3    X-Mailer =~ /^Perl Powered Socket Mailer$/
score  T_USER_AGENT_PERL3    -0.5
tflags T_USER_AGENT_PERL3    nice

header T_USER_AGENT_PHP1     X-Mailer =~ m!^PHP(?:/\d+\.\d+\.\d+)?$!
score  T_USER_AGENT_PHP1     -0.5
tflags T_USER_AGENT_PHP1     nice

header T_USER_AGENT_PHP2     X-Mailer =~ /^phpmailer \[version \d\.\d+\]$/
score  T_USER_AGENT_PHP2     -0.5
tflags T_USER_AGENT_PHP2     nice

header T_USER_AGENT_T_ONLINE X-Mailer =~ /^T-Online eMail \d+\.\d+$/
score  T_USER_AGENT_T_ONLINE -0.5
tflags T_USER_AGENT_T_ONLINE nice

header T_USER_AGENT_UBB      X-Mailer =~ /^UBB\.?[Tt]hreads$/
score  T_USER_AGENT_UBB      -0.5
tflags T_USER_AGENT_UBB      nice

header T_USER_AGENT_XIMIAN   X-Mailer =~ /^Ximian Evolution \d+\.\d+\.\d+(?:\.\d+)?\s$/
score  T_USER_AGENT_XIMIAN   -0.5
tflags T_USER_AGENT_XIMIAN   nice

# OS/2 specific mailer
header T_USER_AGENT_PMMAIL   X-Mailer =~ m!^PMMail \d\.\d+(?:\w|\.\d+)? [Ff]or OS/2(?: Warp \d\.\d+)?$!
score  T_USER_AGENT_PMMAIL   -0.5
tflags T_USER_AGENT_PMMAIL   nice

# Bug 1133
header T_BAD_HELO2           eval:check_for_bad_helo2()

# jm: thrown up by bayes.
header T_X_INFO2		exists:X-Info2
header T_X_VMP_TEXT		exists:X-VMP-Text
header T_X_RMD_TEXT		exists:X-RMD-Text
# might as well test it while we're here ;)
header T_X_GCMULTI		exists:X-GCMulti

##############################################################################
# bug 1163: image only test from mgm

body __IMG_TAG			eval:html_tag_exists('img')
uri __IMG_URI			/\.(?:gif|jpe?g|png)$/i

body __TEXT_A025		/.{25}/i
body __TEXT_A050		/.{50}/i
body __TEXT_A075		/.{75}/i
body __TEXT_A100		/.{100}/i
body __TEXT_A125		/.{125}/i
body __TEXT_A150		/.{150}/i
body __TEXT_A175		/.{175}/i
body __TEXT_A200		/.{200}/i
       
body __TEXT_B025		/(?:\S\s*){25}/i
body __TEXT_B050		/(?:\S\s*){50}/i
body __TEXT_B075		/(?:\S\s*){75}/i
body __TEXT_B100		/(?:\S\s*){100}/i
body __TEXT_B125		/(?:\S\s*){125}/i
body __TEXT_B150		/(?:\S\s*){150}/i
body __TEXT_B175		/(?:\S\s*){175}/i
body __TEXT_B200		/(?:\S\s*){200}/i

# first number is minimum text, the second is one more than the maximum

meta T_IMAGE_ONLY_2_A_025_050	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A025 && ! __TEXT_A050)
meta T_IMAGE_ONLY_2_A_050_075	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A050 && ! __TEXT_A075)
meta T_IMAGE_ONLY_2_A_075_100	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A075 && ! __TEXT_A100)
meta T_IMAGE_ONLY_2_A_100_125	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A100 && ! __TEXT_A125)
meta T_IMAGE_ONLY_2_A_125_150	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A125 && ! __TEXT_A150)
meta T_IMAGE_ONLY_2_A_150_175	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A150 && ! __TEXT_A175)
meta T_IMAGE_ONLY_2_A_175_200	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_A175 && ! __TEXT_A200)
				 
meta T_IMAGE_ONLY_2_B_025_050	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B025 && ! __TEXT_B050)
meta T_IMAGE_ONLY_2_B_050_075	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B050 && ! __TEXT_B075)
meta T_IMAGE_ONLY_2_B_075_100	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B075 && ! __TEXT_B100)
meta T_IMAGE_ONLY_2_B_100_125	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B100 && ! __TEXT_B125)
meta T_IMAGE_ONLY_2_B_125_150	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B125 && ! __TEXT_B150)
meta T_IMAGE_ONLY_2_B_150_175	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B150 && ! __TEXT_B175)
meta T_IMAGE_ONLY_2_B_175_200	((__IMG_URI && T_HTML_MESSAGE) && __TEXT_B175 && ! __TEXT_B200)

meta T_IMAGE_ONLY_3_A_025_050	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A025 && ! __TEXT_A050)
meta T_IMAGE_ONLY_3_A_050_075	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A050 && ! __TEXT_A075)
meta T_IMAGE_ONLY_3_A_075_100	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A075 && ! __TEXT_A100)
meta T_IMAGE_ONLY_3_A_100_125	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A100 && ! __TEXT_A125)
meta T_IMAGE_ONLY_3_A_125_150	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A125 && ! __TEXT_A150)
meta T_IMAGE_ONLY_3_A_150_175	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A150 && ! __TEXT_A175)
meta T_IMAGE_ONLY_3_A_175_200	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_A175 && ! __TEXT_A200)
				 
meta T_IMAGE_ONLY_3_B_025_050	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B025 && ! __TEXT_B050)
meta T_IMAGE_ONLY_3_B_050_075	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B050 && ! __TEXT_B075)
meta T_IMAGE_ONLY_3_B_075_100	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B075 && ! __TEXT_B100)
meta T_IMAGE_ONLY_3_B_100_125	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B100 && ! __TEXT_B125)
meta T_IMAGE_ONLY_3_B_125_150	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B125 && ! __TEXT_B150)
meta T_IMAGE_ONLY_3_B_150_175	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B150 && ! __TEXT_B175)
meta T_IMAGE_ONLY_3_B_175_200	((__IMG_TAG || (__IMG_URI && T_HTML_MESSAGE)) && __TEXT_B175 && ! __TEXT_B200)

meta T_IMAGE_ONLY_4_A_025_050	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A025 && ! __TEXT_A050)
meta T_IMAGE_ONLY_4_A_050_075	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A050 && ! __TEXT_A075)
meta T_IMAGE_ONLY_4_A_075_100	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A075 && ! __TEXT_A100)
meta T_IMAGE_ONLY_4_A_100_125	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A100 && ! __TEXT_A125)
meta T_IMAGE_ONLY_4_A_125_150	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A125 && ! __TEXT_A150)
meta T_IMAGE_ONLY_4_A_150_175	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A150 && ! __TEXT_A175)
meta T_IMAGE_ONLY_4_A_175_200	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_A175 && ! __TEXT_A200)
				 					 
meta T_IMAGE_ONLY_4_B_025_050	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B025 && ! __TEXT_B050)
meta T_IMAGE_ONLY_4_B_050_075	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B050 && ! __TEXT_B075)
meta T_IMAGE_ONLY_4_B_075_100	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B075 && ! __TEXT_B100)
meta T_IMAGE_ONLY_4_B_100_125	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B100 && ! __TEXT_B125)
meta T_IMAGE_ONLY_4_B_125_150	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B125 && ! __TEXT_B150)
meta T_IMAGE_ONLY_4_B_150_175	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B150 && ! __TEXT_B175)
meta T_IMAGE_ONLY_4_B_175_200	(__IMG_TAG && __IMG_URI && T_HTML_MESSAGE && __TEXT_B175 && ! __TEXT_B200)

meta T_IMAGE_ONLY_5_A_025_050	(__IMG_URI && __IMG_TAG && __TEXT_A025 && ! __TEXT_A050)
meta T_IMAGE_ONLY_5_A_050_075	(__IMG_URI && __IMG_TAG && __TEXT_A050 && ! __TEXT_A075)
meta T_IMAGE_ONLY_5_A_075_100	(__IMG_URI && __IMG_TAG && __TEXT_A075 && ! __TEXT_A100)
meta T_IMAGE_ONLY_5_A_100_125	(__IMG_URI && __IMG_TAG && __TEXT_A100 && ! __TEXT_A125)
meta T_IMAGE_ONLY_5_A_125_150	(__IMG_URI && __IMG_TAG && __TEXT_A125 && ! __TEXT_A150)
meta T_IMAGE_ONLY_5_A_150_175	(__IMG_URI && __IMG_TAG && __TEXT_A150 && ! __TEXT_A175)
meta T_IMAGE_ONLY_5_A_175_200	(__IMG_URI && __IMG_TAG && __TEXT_A175 && ! __TEXT_A200)

meta T_IMAGE_ONLY_5_B_025_050	(__IMG_URI && __IMG_TAG && __TEXT_B025 && ! __TEXT_B050)
meta T_IMAGE_ONLY_5_B_050_075	(__IMG_URI && __IMG_TAG && __TEXT_B050 && ! __TEXT_B075)
meta T_IMAGE_ONLY_5_B_075_100	(__IMG_URI && __IMG_TAG && __TEXT_B075 && ! __TEXT_B100)
meta T_IMAGE_ONLY_5_B_100_125	(__IMG_URI && __IMG_TAG && __TEXT_B100 && ! __TEXT_B125)
meta T_IMAGE_ONLY_5_B_125_150	(__IMG_URI && __IMG_TAG && __TEXT_B125 && ! __TEXT_B150)
meta T_IMAGE_ONLY_5_B_150_175	(__IMG_URI && __IMG_TAG && __TEXT_B150 && ! __TEXT_B175)
meta T_IMAGE_ONLY_5_B_175_200	(__IMG_URI && __IMG_TAG && __TEXT_B175 && ! __TEXT_B200)

meta T_IMAGE_ONLY_6_A_025_050	(__IMG_TAG && __TEXT_A025 && ! __TEXT_A050)
meta T_IMAGE_ONLY_6_A_050_075	(__IMG_TAG && __TEXT_A050 && ! __TEXT_A075)
meta T_IMAGE_ONLY_6_A_075_100	(__IMG_TAG && __TEXT_A075 && ! __TEXT_A100)
meta T_IMAGE_ONLY_6_A_100_125	(__IMG_TAG && __TEXT_A100 && ! __TEXT_A125)
meta T_IMAGE_ONLY_6_A_125_150	(__IMG_TAG && __TEXT_A125 && ! __TEXT_A150)
meta T_IMAGE_ONLY_6_A_150_175	(__IMG_TAG && __TEXT_A150 && ! __TEXT_A175)
meta T_IMAGE_ONLY_6_A_175_200	(__IMG_TAG && __TEXT_A175 && ! __TEXT_A200)

meta T_IMAGE_ONLY_6_B_025_050	(__IMG_TAG && __TEXT_B025 && ! __TEXT_B050)
meta T_IMAGE_ONLY_6_B_050_075	(__IMG_TAG && __TEXT_B050 && ! __TEXT_B075)
meta T_IMAGE_ONLY_6_B_075_100	(__IMG_TAG && __TEXT_B075 && ! __TEXT_B100)
meta T_IMAGE_ONLY_6_B_100_125	(__IMG_TAG && __TEXT_B100 && ! __TEXT_B125)
meta T_IMAGE_ONLY_6_B_125_150	(__IMG_TAG && __TEXT_B125 && ! __TEXT_B150)
meta T_IMAGE_ONLY_6_B_150_175	(__IMG_TAG && __TEXT_B150 && ! __TEXT_B175)
meta T_IMAGE_ONLY_6_B_175_200	(__IMG_TAG && __TEXT_B175 && ! __TEXT_B200)

meta T_IMAGE_ONLY_7_A_025_050	((__IMG_URI || __IMG_TAG) && __TEXT_A025 && ! __TEXT_A050)
meta T_IMAGE_ONLY_7_A_050_075	((__IMG_URI || __IMG_TAG) && __TEXT_A050 && ! __TEXT_A075)
meta T_IMAGE_ONLY_7_A_075_100	((__IMG_URI || __IMG_TAG) && __TEXT_A075 && ! __TEXT_A100)
meta T_IMAGE_ONLY_7_A_100_125	((__IMG_URI || __IMG_TAG) && __TEXT_A100 && ! __TEXT_A125)
meta T_IMAGE_ONLY_7_A_125_150	((__IMG_URI || __IMG_TAG) && __TEXT_A125 && ! __TEXT_A150)
meta T_IMAGE_ONLY_7_A_150_175	((__IMG_URI || __IMG_TAG) && __TEXT_A150 && ! __TEXT_A175)
meta T_IMAGE_ONLY_7_A_175_200	((__IMG_URI || __IMG_TAG) && __TEXT_A175 && ! __TEXT_A200)

meta T_IMAGE_ONLY_7_B_025_050	((__IMG_URI || __IMG_TAG) && __TEXT_B025 && ! __TEXT_B050)
meta T_IMAGE_ONLY_7_B_050_075	((__IMG_URI || __IMG_TAG) && __TEXT_B050 && ! __TEXT_B075)
meta T_IMAGE_ONLY_7_B_075_100	((__IMG_URI || __IMG_TAG) && __TEXT_B075 && ! __TEXT_B100)
meta T_IMAGE_ONLY_7_B_100_125	((__IMG_URI || __IMG_TAG) && __TEXT_B100 && ! __TEXT_B125)
meta T_IMAGE_ONLY_7_B_125_150	((__IMG_URI || __IMG_TAG) && __TEXT_B125 && ! __TEXT_B150)
meta T_IMAGE_ONLY_7_B_150_175	((__IMG_URI || __IMG_TAG) && __TEXT_B150 && ! __TEXT_B175)
meta T_IMAGE_ONLY_7_B_175_200	((__IMG_URI || __IMG_TAG) && __TEXT_B175 && ! __TEXT_B200)

##############################################################################

header   T_SENDER_NO_REVERSE    eval:check_for_sender_no_reverse()
describe T_SENDER_NO_REVERSE    No reverse lookup for sender's IP

##############################################################################

# Potential replacement for our current nigerian stuff - tvd
# I was hoping bayes would do it, but so far it only catches ~30% of
# these based on "train on half the corpus".  They test well for me
# (no FPs) but I want to see how they work for everyone else. :) )
# ideally, I'd like to use just 9, but subject and body may be good too
# depending on fp levels.  If we get rid of 5, we can trim a lot of the
# meta stuff out since most of it is a list of african geography.
#
# OVERALL%   SPAM% NONSPAM%     S/O    RANK   SCORE  NAME
#   22895     8987    13908    0.393   0.00    0.00  (all messages)
# 100.000  39.2531  60.7469    0.393   0.00    0.00  (all messages as %)
#   0.581   1.4799   0.0000    1.000   1.00    0.01  T_NIGERIAN_9
#   0.476   1.2129   0.0000    1.000   0.70    0.01  T_NIGERIAN_BODY
#   0.450   1.1461   0.0000    1.000   0.63    0.01  T_NIGERIAN_5
#   0.227   0.5786   0.0000    1.000   0.00    0.01  T_NIGERIAN_SUBJECT

body __NIGERIAN_BODY_1	/\b(?:financial|confiden(?:tial|ce)|safe(?:ty)?|mutual|secret|success(?:ful)?|risk-?free|details|business).{1,30}\btransaction\b/i
body __NIGERIAN_BODY_2	/\btransaction\b.{1,30}\b(?:magnitude|diplomatic|strict|absolute|secret|confiden(?:tial|ce)|guarantee)/i
body __NIGERIAN_BODY_3	/BASED ON INFORMATION GATHERED ABOUT YOU, WE BELIEVE\s*YOU WOULD BE IN A POSITION TO HELP US IN TRANSFER/i
body __NIGERIAN_BODY_4	/\bBarrister\b/i
body __NIGERIAN_BODY_6	/\bIt is with trust and confidentiality\b/i
body __NIGERIAN_BODY_7	/\bUSD?\s*(?:\$\s*)?(?:\d+,\d+,\d+|\d+\.\d+\s*million)/i
body __NIGERIAN_BODY_8	/\b(?:You may be surprised to receive this letter from me|this letter will be a surprise)\b/i
body __NIGERIAN_BODY_9	/\bthe .{1,10} son of\b/i
body __NIGERIAN_BODY_10	/\burgent and(?: very)? confidential business proposition\b/i
body __NIGERIAN_BODY_11	/\bassistance to relocate\b/i
body __NIGERIAN_BODY_12 /\bto which will be transferred the sum\b/i
body __NIGERIAN_BODY_13	/\byour(?: private)? (?:tele)?phone (?:and|&) fax Numbers?\b/i
body __NIGERIAN_BODY_14	/\bthe importance of Secrecy\b/i
body __NIGERIAN_BODY_15	/\bmodalities\b/i
body __NIGERIAN_BODY_16	/\bI am a Private Investigator\b/i
body __NIGERIAN_BODY_17	/\bWRITING THIS LETTER TO SOLICIT\b/i
body __NIGERIAN_BODY_18	/\bSEVERAL ATTEMPTS HAVE BEEN MADE WITH OUT SUCCESS\b/i
body __NIGERIAN_BODY_19	/\bMY PROPOSAL IS ACCEPTABLE\b/i
body __NIGERIAN_BODY_20	/\d+% (?:of the total (?:amount|sum)|for you|for my investment|for (?:us|me))\b/i
body __NIGERIAN_BODY_21 /\bforeign account\b/i
body __NIGERIAN_BODY_22 /\btrust (?:and|&) confidentiality\b/i
body __NIGERIAN_BODY_25	/\bvery beneficial to both of us\b/i
body __NIGERIAN_BODY_26	/\bmillion (?:.{1,25} thousand\s*)?(?:(?:united states|u\.?s\.?) dollars|(?i:U\.?S\.?D?))\b/i
body __NIGERIAN_BODY_27	/\bcorrespondent branch\b/i
body __NIGERIAN_BODY_28	/\btransaction is .{1,15} risk free.\b/i
body __NIGERIAN_BODY_29	/\b(?:percentage|rate) of this money\b/i
body __NIGERIAN_BODY_30	/\bfavou?rable response\b/i
body __NIGERIAN_BODY_31	/\btotal acceptance and commitment\b/i
body __NIGERIAN_BODY_32 /\blocate(?: .{1,20})? extended relative/i
body __NIGERIAN_BODY_33 /\bhonest cooperation\b/i


meta T_NIGERIAN_SUBJECT	(__NIGERIAN_SUBJECT.+ +) > 0
header __NIGERIAN_SUBJECT1	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:(?:very )?URGENT|ATTENTION)\s*$/i
header __NIGERIAN_SUBJECT2	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:very )?urgent\s+(?:(?:and|&)\s+)?(?:confidential|assistance|business|attention|reply|response|help)\b/i
header __NIGERIAN_SUBJECT3	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*your assistance\b/i
header __NIGERIAN_SUBJECT4	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*i need your urgent\b/i
header __NIGERIAN_SUBJECT5	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*treat as urgent\b/i
header __NIGERIAN_SUBJECT6	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:family )?assis?tance\s*$/i
header __NIGERIAN_SUBJECT7	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*[!*_-]+\s*(?:business|urgent)/i
header __NIGERIAN_SUBJECT8	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:appeal|request) for urgent/i

meta T_NIGERIAN_BODY	( __NIGERIAN_BODY_.+ + ) > 1
meta T_NIGERIAN_5	(( __AFRICAN_COUNTRY.+ + ) > 0) && ( (( __NIGERIAN_BODY_.+ + ) > 1) || T_NIGERIAN_SUBJECT )
meta T_NIGERIAN_9	T_NIGERIAN_SUBJECT || (( __NIGERIAN_BODY_.+ + ) > 1)


body __AFRICAN_COUNTRY_1	/\bAlgeria/i
body __AFRICAN_COUNTRY_7	/\bCameroon\b/i
body __AFRICAN_COUNTRY_10	/\bCongo\b/i
body __AFRICAN_COUNTRY_12	/\bEgypt(?:ian)?\b/i
body __AFRICAN_COUNTRY_14	/\bEthiopia/i
body __AFRICAN_COUNTRY_19	/\bIvory\s+Coast\b/i
body __AFRICAN_COUNTRY_20	/\bKenya/i
body __AFRICAN_COUNTRY_22	/\bLiberia/i
body __AFRICAN_COUNTRY_23	/\bLibya\b/i
body __AFRICAN_COUNTRY_30	/\bMozambique\b/i
body __AFRICAN_COUNTRY_31	/\bNamibia/i
body __AFRICAN_COUNTRY_35	/\bSenegal\b/i
body __AFRICAN_COUNTRY_37	/\bSierra Leone\b/i
body __AFRICAN_COUNTRY_38	/\bSomalia/i
body __AFRICAN_COUNTRY_39	/\bS(?:outh|o?\.)\s+Africa/i
body __AFRICAN_COUNTRY_40	/\bSudan\b/i
body __AFRICAN_COUNTRY_34	/\bRwanda/i
body __AFRICAN_COUNTRY_32	/\bNigeria/i
body __AFRICAN_COUNTRY_48	/\bZimbabwe\b/i
body __AFRICAN_COUNTRY_CONT	/\bAfrica/i
body __AFRICAN_COUNTRY_50	/\bjohannesburg\b/i
body __AFRICAN_COUNTRY_51	/\bLagos\b/i
body __AFRICAN_COUNTRY_52	/\bcape town\b/i

##############################################################################
