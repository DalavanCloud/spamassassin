# SpamAssassin rules file: CVS rules under test
#
# This file is a placeholder for rules "under probation", ie. checked into
# CVS for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
###########################################################################

# should be fixed now
# updated per bug 1217
# %%% INVALID_MSGID
# Dec 17 2002 jm: added subtest since part of my corpus has no msgid
# Dec 17 2002 jm: btw, one FP is for
# <41340.2001:770:18:1:250:4ff:feea:4364.1028136205.squirrel@webmail.heanet.ie>,
# ie an IPv6 address in the msgid.  Not sure if that's interesting or not ;)

# Dec 24 2002 jm: ok, I think we should drop these... not really getting
# around the FPs

header __VALID_MSGID MESSAGEID =~ /^<(?:[a-zA-Z0-9.,!\#\$%&'*\+\/=?\^_{}|~-]+|\".+\")\@(?:[a-zA-Z0-9_.-]+|\[\d{1,3}(?:\.\d{1,3}){3}\])>(?:\s*\(.*\))?\s*$/m [if-unset: <NO@MSGID>]
header __HAS_MSGID		MESSAGEID =~ /\S/
meta T_INVALID_MSGID		__HAS_MSGID && !__VALID_MSGID
describe T_INVALID_MSGID	Message-Id is not valid, according to RFC 2822
#
# quinlan: If this has a better S/O for others (all of my FPs are from the
# same person), it should be an eval so this can be done properly: strip
# comments on each Message-Id header, then use regular expression.
# Dec 18 2002 jm: S/Os aren't much better for others, but I think we should
# do it that way anyway.
#
header __MSGID_COMMENT		MESSAGEID =~ /\(.*\)/m
meta T_INVALID_MSGID2		__HAS_MSGID && !(__VALID_MSGID || __MSGID_COMMENT)


# these rules may need to factor in ok_languages or ok_locales
# Dec 18 2002 jm: but how? ;)  They are ready to be promoted otherwise
#freqs:  0.084   0.2047   0.0095    0.956   0.84    0.01  T_BODY_UNPRINTABLE
body T_BODY_UNPRINTABLE		/[\x00-\x07\x0b\x0c\x0e-\x1f\x7f]{3,}/
describe T_BODY_UNPRINTABLE	Body includes 3 consecutive unprintable characters
#freqs:  3.660   9.4529   0.0442    0.995   0.96    0.01  T_BODY_8BITS
body T_BODY_8BITS		/[\x80-\xff]{8,}/
describe T_BODY_8BITS		Body includes 8 consecutive 8-bit characters

########################################################################
# bug 1106: forged MUAs
# only needed a \b around the shortest X-Mailer regular expressions

# Mozilla
# Dec 10 2002 jm: dan, you have fps for this, could you check 'em?
#
# 12/26 quinlan: my FPs are fixed now, all three versions of the rule
# have zero FPs for me now, only easmith benefits a very small amount
# from versions 2 and 3.
#
header __MOZILLA_MUA		X-Mailer =~ /\bMozilla\b/
header __MOZILLA_MSGID		MESSAGEID =~ /^<[A-F\d]{8}\.[A-F\d]{4,8}\@\S+>$/
meta T_FORGED_MUA_MOZILLA	(__MOZILLA_MUA && !__UNUSABLE_MSGID && !__MOZILLA_MSGID)
describe T_FORGED_MUA_MOZILLA	Forged mail pretending to be from Mozilla
score T_FORGED_MUA_MOZILLA	1.0

# Hmm... maybe possible to use a variant on the check_outlook_timestamp_token
# test for the time component of the MOZILLA rules. - Allen
# Dec 24 2002 jm: probably worth a try.
# 12/26 quinlan: see above
header __MOZILLA_MSGID2         MESSAGEID =~ /^<[A-F\d]{8}\.[A-F\d]{4,8}\@\S+>$/m
meta T_FORGED_MUA_MOZILLA2      (__MOZILLA_MUA && !__UNUSABLE_MSGID && !__MOZILLA_MSGID2)
describe T_FORGED_MUA_MOZILLA2  Forged mail pretending to be from Mozilla (2)
score T_FORGED_MUA_MOZILLA2     1.0

# 12/26 quinlan: see above
header __MOZILLA_MSGID3         MESSAGEID =~ /^<[A-F\d]{8}\.[A-F1-9][A-F\d]{0,7}\@\S+>$/m
meta T_FORGED_MUA_MOZILLA3      (__MOZILLA_MUA && !__UNUSABLE_MSGID && !__MOZILLA_MSGID3)
describe T_FORGED_MUA_MOZILLA3  Forged mail pretending to be from Mozilla (3)
score T_FORGED_MUA_MOZILLA3     1.0

########################################################################

# Nov 12 2002 jm: not keen on this.  many ISPs do not provide rDNS these
# days as policy. stupid policy, but there we are. and SpamAssassin policy
# is not to punish users with stupid ISPs...
#
# Dec 20 2002 jm: should make fantastic meta-fodder though. ;)
#
#freqs: 11.817  22.1680   5.3554    0.805   0.53    0.01  T_SENDER_NO_REVERSE
header   T_SENDER_NO_REVERSE    eval:check_for_sender_no_reverse()
describe T_SENDER_NO_REVERSE    No reverse lookup for sender's IP

# test for weird double quoting in the body
body T_BODY_QUOTES_A1	/[\042\222\223\224\262\263\271]{2}\S{0,16}[\042\222\223\224\262\263\271]{2}/
describe T_BODY_QUOTES_A1	Weird repeated quotation marks in body

# test for weird double quoting in the body (no single quotes)
body T_BODY_QUOTES_Z1	/[\042\223\224\262\263\271]{2}\S{0,16}[\042\223\224\262\263\271]{2}/
describe T_BODY_QUOTES_Z1	Weird repeated double-quotation marks in body

#bug 1010
body T_CHECK_EMAIL_ISFREE	eval:check_email_isfree()
describe T_CHECK_EMAIL_ISFREE Body contains an e-mail address listed by Email::IsFree

# bug 1014
# from Allen
# 12/20 - Not great, but looks ok, what say ye?  - tvd
# sounds like it's worth something.  maybe combined with from_webmail
# type meta subrule...
# 12/25 - this was looking for T_REPLY_TO_HAS_UNDERLINE_NUMS which got promoted
# we need to be more careful about this kind of stuff. :(
header __FROM_HAS_UNDERLINE_NUMS	From =~ /_\S?(?:[a-z]+\w*?\d+|\d+\w*?[a-z]+)\w*\@/i
meta T_FROM_HAS_UNDERLINE_NUMS		(!REPLY_TO_HAS_UNDERLINE_NUMS && __FROM_HAS_UNDERLINE_NUMS)
describe T_FROM_HAS_UNDERLINE_NUMS	From: contains an underline and numbers/letters

# tvd - 12/25 - part of me says to promote this with strong ham sign, but
# another part says that since it's only 1 person who really gets any hits,
# we shouldn't promote and just let them have local rules.  Thoughts?
# bug 1171
# Listproc - Allen (example: nonspam:<199811090515.AAA28259@chem.harvard.edu>)
# 12/22 - hits a lot for allen (4.3%), a tiny amount for theo (0.05%), and that's it. - tvd
header T_LISTPROC1		X-Listprocessor-version =~ /^\s*(?:\d\.)+\w*\s+--\s+List[Pp]roc(?:essor)?\b/
score T_LISTPROC1		-0.01
tflags T_LISTPROC1		nice

########################################################################

# more work on slow rules, mostly adding \b, but with one or two other
# performance improvement attempts, total speed-up if all of these are
# applied is 2.0%
#   RULE                  TIME FRACTION
# large speed-up, use unless the new rule is significantly worse than original 
#   T_PORN_16             0.34
#   T_VERB_UP_TO_OR_MORES 0.44
#   T_SELECTED_YOU        0.50
#   T_SOME_BREAKTHROUGH   0.62
#   T_CELEBRITY_PORN      0.64
#   T_AMATEUR_PORN        0.76
# small speed-up, use if the new rule is about the same as original or better
#   T_RAPE                0.87
#   T_MARKETING_PARTNERS  0.89
#   T_HAIR_LOSS           0.91
# no measurable speed-up, only use if rule is equal or better
#   T_ONLINE_PHARMACY     1.00
#   T_WINNER              1.03

body T_CELEBRITY_PORN		/\bceleb(?:rity|rities|s).{0,15}(?:sex|porn|pics|caught|nude|exposed|content)|\b(?:steamy|hot|nude|shocking|free|h[a\@]rdcore) celeb(?:rity|rities|s)/i
body T_MARKETING_PARTNERS	/\b(?:marketing|network) partner|\bpartner (?:web)?site/i
body T_PORN_16			/\b(?:nasty|teen|dir(?:ty|iest)?|little).{0,16}\bsluts?/i 
body T_ONLINE_PHARMACY		/\bonline pharmacy|\b(?:drugs|medications) online/i
body T_SOME_BREAKTHROUGH	/\b(?:science|medical|major|scientific|fundamental|technology|revolutionary)\s+breakthrough/i
body T_AMATEUR_PORN		/\bamateur .{0,9}(?:sex|porn|star|sites?|college|babes|action|pics|trash|gang|rape)|\b(?:real|best) amateur/i
body T_HAIR_LOSS		/\b(?:thinn?ing|restore|grow|new) hair|\bhair loss/i
body T_VERB_UP_TO_OR_MORES	/\b(add|lose|make|save) up to \S+( \S+)? or more/i
body T_SELECTED_YOU		/\b(?:you (?:have been|were) selected|\bwe (?:have )?selected you)/i
body T_RAPE			/\b(?:virgin|gang|teen|amateur) rape|\brape (?:sites?|sex)\b/i
body T_WINNER			/\byou.{0,4} a winner|\bregister to win/i
body T__NIGERIAN_BODY_1		/\b(?:financial|confiden(?:tial|ce)|safe|mutual|secret|success|risk-?free|details|business).{1,30}\btransaction\b/i

########################################################################

# Dec 24 2002 jm: random check
# 12/25 - tvd - great for quinlan (2.69%), hits under .05% for everyone else, no fps
# quinlan: just a note that I didn't write the rule :-)
uri T_BARGAIN_URL		/bargains?\.(?:com|biz)/
# 12/25 - tvd - fps a bit for rod, my fp is homestead.com redirect to:
#http://professional.homestead.com/splash.ffhtml?ref=3564&target=www.homestead.com/splash.html%3F3564%26target%3Dwww.hspromos.com/webring.html
uri T_PROMO_URL			/promo(?:tion)?s?\.(?:com|biz)/

