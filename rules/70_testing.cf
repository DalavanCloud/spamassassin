# SpamAssassin rules file: rules under test, $Rev$
#
# This file is a placeholder for rules "under probation", i.e. checked into
# SVN for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
# <@LICENSE>
# Copyright 2004 Apache Software Foundation
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
#     http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# </@LICENSE>
#
########################################################################

# partial messages; currently-theoretical attack
# unsurprisingly this hits 0/0 right now.  But should we promote it anyway
# to protect against the possibility?
header T_FRAGMENTED_MESSAGE	Content-Type =~ /message\/partial/i

# I'm curious, may help explain more ALL_TRUSTED fps
body T_SA_MARKED_UP     /Spam detection software, running on the system /

########################################################################

# IADB
header __RCVD_IN_IADB		eval:check_rbl('iadb', 'iadb.isipp.com.')
tflags __RCVD_IN_IADB		net nice

header T_RCVD_IN_IADB_LIST	eval:check_rbl_sub('iadb', '127.0.0.1')
describe T_RCVD_IN_IADB_LIST	Sender is listed in ISIPP IADB
tflags T_RCVD_IN_IADB_LIST	net nice

# IADB trusted
header __RCVD_IN_IADB_T		eval:check_rbl('iadbt-firsttrusted', 'iadb.isipp.com.')
tflags __RCVD_IN_IADB_T		net nice

header T_RCVD_IN_IADB_LIST_T	eval:check_rbl_sub('iadbtr', '127.0.0.1')
describe T_RCVD_IN_IADB_LIST_T	Sender is listed in ISIPP IADB
tflags T_RCVD_IN_IADB_LIST_T	net nice

########################################################################

# possible replacements for SB_NSP_VOLUME_SPIKE
# accounting for rounding, "> 0.3" means at least a 59% volume spike
header T_NSP_S41_38_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 3.8 && S40 - S41 > 0.3')
header T_NSP_S41_39_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 3.9 && S40 - S41 > 0.3')
header T_NSP_S41_40_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.0 && S40 - S41 > 0.3')
header T_NSP_S41_41_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.1 && S40 - S41 > 0.3')
header T_NSP_S41_42_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.2 && S40 - S41 > 0.3')
header T_NSP_S41_43_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.3 && S40 - S41 > 0.3')
header T_NSP_S41_44_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.4 && S40 - S41 > 0.3')
header T_NSP_S41_45_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.5 && S40 - S41 > 0.3')
header T_NSP_S41_46_03	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.6 && S40 - S41 > 0.3')

# accounting for rounding, "> 0.4" means at least a 251% volume spike
header T_NSP_S41_38_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 3.8 && S40 - S41 > 0.4')
header T_NSP_S41_39_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 3.9 && S40 - S41 > 0.4')
header T_NSP_S41_40_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.0 && S40 - S41 > 0.4')
header T_NSP_S41_41_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.1 && S40 - S41 > 0.4')
header T_NSP_S41_42_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.2 && S40 - S41 > 0.4')
header T_NSP_S41_43_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.3 && S40 - S41 > 0.4')
header T_NSP_S41_44_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.4 && S40 - S41 > 0.4')
header T_NSP_S41_45_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.5 && S40 - S41 > 0.4')
header T_NSP_S41_46_04	eval:check_rbl_sub('senderbase', 'S5 =~ /NSP/ && S41 > 4.6 && S40 - S41 > 0.4')

tflags T_NSP_S41_38_03 net
tflags T_NSP_S41_39_03 net
tflags T_NSP_S41_40_03 net
tflags T_NSP_S41_41_03 net
tflags T_NSP_S41_42_03 net
tflags T_NSP_S41_43_03 net
tflags T_NSP_S41_44_03 net
tflags T_NSP_S41_45_03 net
tflags T_NSP_S41_46_03 net
tflags T_NSP_S41_38_04 net
tflags T_NSP_S41_39_04 net
tflags T_NSP_S41_40_04 net
tflags T_NSP_S41_41_04 net
tflags T_NSP_S41_42_04 net
tflags T_NSP_S41_43_04 net
tflags T_NSP_S41_44_04 net
tflags T_NSP_S41_45_04 net
tflags T_NSP_S41_46_04 net

########################################################################

# let's see how this works
meta T_SPF_PASS_NO_SBL		(SPF_PASS && !RCVD_IN_SBL)
meta T_SPF_HELO_PASS_NO_SBL	(SPF_HELO_PASS && !RCVD_IN_SBL)
tflags T_SPF_PASS_NO_SBL	net nice
tflags T_SPF_HELO_PASS_NO_SBL	net nice

# long-term test
# IP-based volume and date of first email might be better considering
# that SBL is a domain blacklist, but this is a start
header __SENDERBASE_VOL_SPIKE	eval:check_rbl_sub('senderbase', 'S23 > S24 + 1')
header __SENDERBASE_45_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 45*86400)')
header __SENDERBASE_90_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 90*86400)')
header __SENDERBASE_180_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 180*86400)')
header __SENDERBASE_360_DAYS	eval:check_rbl_sub('senderbase', '(time - S25 > 360*86400)')
meta T_SPF_PASS_NO_SBL_45D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_45_DAYS)
meta T_SPF_PASS_NO_SBL_90D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_90_DAYS)
meta T_SPF_PASS_NO_SBL_180D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_180_DAYS)
meta T_SPF_PASS_NO_SBL_360D	(SPF_PASS && !RCVD_IN_SBL && !__SENDERBASE_VOL_SPIKE && __SENDERBASE_360_DAYS)
tflags T_SPF_PASS_NO_SBL_45D net nice
tflags T_SPF_PASS_NO_SBL_90D net nice
tflags T_SPF_PASS_NO_SBL_180D net nice
tflags T_SPF_PASS_NO_SBL_360D net nice

# Carl Hutzler of AOL says: "block on sight" (mail sent 07 May 2004 to discuss
# at lists.surbl.org).  not much hits for me, but let's see for everyone else
uri T_REDIR_AOL_CLICKTHRU     /www\.aol\.com\/ams\/clickThruRedirect\.adp/i

# Suresh says: these will never be used as HELOs from real mail.com relays.
# Just check the most recent handover; the connection to a trusted host.
# This way a legit sender can send to their MSA using that HELO (quite a few
# MUAs will do that), but a spammer gets caught.  (List of domains comes from
# the drop-down list on the Mail.com signup page.)
header T_FAKE_HELO_MAIL_COM_DOM  X-Spam-Relays-Untrusted =~ /^[^\]]+ helo=(?:\S+\.|)(?:(?:mail|email|iname|cheerful|consultant|europe|mindless|myself|post|techie|usa|writeme|2die4|artlover|bikerider|catlover|cliffhanger|cutey|doglover|gardener|hot-shot|inorbit|loveable|mad\.scientist|playful|poetic|popstar|saintly|seductive|soon|whoever|winning|witty|yours|africamail|arcticmail|asia|australiamail|europe|japan|samerica|usa|berlin|dublin|london|madrid|moscowmail|munich|nycmail|paris|rome|sanfranmail|singapore|tokyo|accountant|adexec|allergist|alumnidirector|archaeologist|chemist|clerk|columnist|comic|consultant|counsellor|deliveryman|diplomats|doctor|dr|engineer|execs|financier|geologist|graphic-designer|insurer|journalist|lawyer|legislator|lobbyist|minister|optician|pediatrician|presidency|priest|publicist|realtyagent|registerednurses|repairman|representative|rescueteam|scientist|sociologist|teacher|techietechnologist|umpire)\.com|(?:programmer|earthling|hairdresser)\.net|musician\.org) /i
header T_FAKE_HELO_MAIL_COM_DOM2  X-Spam-Relays-Untrusted =~ /^[^\]]+ helo=(?:(?:mail|email|iname|cheerful|consultant|europe|mindless|myself|post|techie|usa|writeme|2die4|artlover|bikerider|catlover|cliffhanger|cutey|doglover|gardener|hot-shot|inorbit|loveable|mad\.scientist|playful|poetic|popstar|saintly|seductive|soon|whoever|winning|witty|yours|africamail|arcticmail|asia|australiamail|europe|japan|samerica|usa|berlin|dublin|london|madrid|moscowmail|munich|nycmail|paris|rome|sanfranmail|singapore|tokyo|accountant|adexec|allergist|alumnidirector|archaeologist|chemist|clerk|columnist|comic|consultant|counsellor|deliveryman|diplomats|doctor|dr|engineer|execs|financier|geologist|graphic-designer|insurer|journalist|lawyer|legislator|lobbyist|minister|optician|pediatrician|presidency|priest|publicist|realtyagent|registerednurses|repairman|representative|rescueteam|scientist|sociologist|teacher|techietechnologist|umpire)\.com|(?:programmer|earthling|hairdresser)\.net|musician\.org) /i

# cream of the rules removed from old releases, may need some work
body T_GREAT_OFFER_A		/offer expires/i
body T_GREAT_OFFER_B		/see full offer for details/i
body T_GREAT_OFFER_C		/great offer/i
body T_SAVE_BUCKS		/\bsave \$/i

# concept: you have a choice + something great
body T_OFFER_BY_CHOICE_1	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_2	/\b(?:wish|want|question|unsub\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_3	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_4	/\b(?:wish|want|question|unsub\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_5	/\b(?:wish|want|question|unsubscrib\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_6	/\b(?:wish|want|question|unsub\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion)/i
body T_OFFER_BY_CHOICE_7	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_8	/\b(?:wish|want|question|unsub\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_9	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_10	/\b(?:wish|want|question|unsub\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_11	/\b(?:wish|want|question|unsubscrib\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_12	/\b(?:wish|want|question|unsub\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount)/i
body T_OFFER_BY_CHOICE_13	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_14	/\b(?:wish|want|question|unsub\w+|discontinue|remove).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_15	/\b(?:wish|want|question|unsubscrib\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_16	/\b(?:wish|want|question|unsub\w+|discontinue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_17	/\b(?:wish|want|question|unsubscrib\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i
body T_OFFER_BY_CHOICE_18	/\b(?:wish|want|question|unsub\w+|(?:dis)?continue|remove|permission).{0,64}\b(?:gift|offer|special|promotion|coupon|discount|reward)/i

# Added a few more versions and removed some old ones
header T_MANY_MX_4 From:addr =~ /\@mx\d{2,4}\..{1,30}\./i
header T_MANY_MX_5 From:addr =~ /\@mx\d{2,4}\..{1,20}\./i
header T_MANY_MX_6 From:addr =~ /\@mx\d+\..{1,30}\./i
header T_MANY_MX_7 From:addr =~ /\@\w\d+\..{1,30}\./i
header T_MANY_MX_8 From:addr =~ /\@\w\d+/i

# hmmm... body doesn't seem to work for these
rawbody T_OBSCURED_EMAIL_3	/^\w+\^\S+\(\w{2,3}\b/m
rawbody T_OBSCURED_EMAIL_4	/^\s*\w+\^\S+\(\w{2,3}\b/m
rawbody T_OBSCURED_EMAIL_5	/^\s?\w+\^\S+\(\w{2,3}\b/m
# so try looking anywhere on the line
body T_OBSCURED_EMAIL_6		/\w+\^\S+\(\w{2,3}\b/m
body T_OBSCURED_EMAIL_7		/\w+\^\S+\(\w{2,4}\b/m
rawbody T_OBSCURED_EMAIL_8	/\w+\^\S+\(\w{2,3}\b/m
rawbody T_OBSCURED_EMAIL_9	/\w+\^\S+\(\w{2,4}\b/m
# test these for completeness
uri T_OBSCURED_EMAIL_10		/^\w+\^\S+\(\w{2,3}\b/m
uri T_OBSCURED_EMAIL_11		/^\s*\w+\^\S+\(\w{2,3}\b/m
uri T_OBSCURED_EMAIL_12		/^\s?\w+\^\S+\(\w{2,3}\b/m

# another spin
body T_TRACKER_ID_6	/[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
body T_TRACKER_ID_7	/\b[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
rawbody T_TRACKER_ID_8	/[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is
rawbody T_TRACKER_ID_9	/\b[a-z0-9]{6,24}[-_a-z0-9]{12,36}[a-z0-9]{6,24}\s*\z/is

# Bug 3349, rule written by yackley
header T_FAKE_MS_XMIME	X-MimeOLE =~ /mircosoft/i
header T_MISSPELLED_MS	ALL =~ /mircosoft/i

# Updated test rules for fraud, uses existing rules and updated rules
body __T_FRAUD_92	/youre? country/i
body __T_FRAUD_110	/the total sum/i
body __T_FRAUD_2	/\bass?ylum\b/i
body __T_FRAUD_102	/foreign (?:offshore )?(?:bank|account)/i
body __T_FRAUD_144	/\bnext of kin\b/i
body __T_FRAUD_235	/(?:international|luckyday|overseas stake|promo|world) lott(?:o|ery)/i
body __T_FRAUD_258	/computer ballot system/i
body __T_FRAUD_113	/win cash/i
body __T_FRAUD_63	/\blagos\b/i
body __T_FRAUD_44	/(?:may i first|to) introduce my ?self/i
body __T_FRAUD_52	/\balgeria\b/i
body __T_FRAUD_81	/as the beneficiary/i
body __T_FRAUD_58	/\bcongo\b/i
body __T_FRAUD_259	/drawn	?from.{0,10}\d{2,3},?\d{3}/i
body __T_FRAUD_149	/as a minister/i
body __T_FRAUD_51	/\babidjan\b/i
body __T_FRAUD_236	/lott(?:o|ery) (?:co,?ordinator|international)/i
body __T_FRAUD_249	/bequest/i
body __T_FRAUD_125	/(?:white|black|zimbabwean) farmers?/i
body __T_FRAUD_56	/\bbotswana\b/i
body __T_FRAUD_252	/modalit(?:y|ies)/i
body __T_FRAUD_132	/(?:who was a|as a|an? honest|you being a|to any) foreigner/i
body __T_FRAUD_227	/(?:negotiate|reasonable|acc?or?ding|certain|agg?ree).{1,20}percentage/i
body __T_FRAUD_100	/(?:claim|concerning) (?:the|this) money/i
body __T_FRAUD_26	/charity organization/i
body __T_FRAUD_53	/\bangola\b/i
body __T_FRAUD_88	/remains unclaimed/i
body __T_FRAUD_16	/land dispute/i
body __T_FRAUD_240	/award notification/i
body __T_FRAUD_157	/god gives .{1,10}second chance/i
body __T_FRAUD_46	/i am contacting you/i
body __T_FRAUD_133	/foreign (?:business partner|customer)/i
body __T_FRAUD_228	/percentage.{1,10}(?:indicat|previous|involved)/i
body __T_FRAUD_120	/letter of authority/i
body __T_FRAUD_114	/you are.{0,8}winner/i
body __T_FRAUD_142	/my late (?:husband|wife|brother|uncle|aunt|father|mother) (?:is|[hw]a[ds])\b/i
body __T_FRAUD_94	/(?:huge|substantial) amount of m[o0]ney/i
body __T_FRAUD_146	/the (?:wife|heir) (?:to|of)\b/i
body __T_FRAUD_96	/(?:will share the money|your share.{1,10}(?:shall|sum|total|money|funds))/i
body __T_FRAUD_41	/prize award dept/i
body __T_FRAUD_216	/reliable person/i
body __T_FRAUD_74	/\bsierra.leone\b/i
body __T_FRAUD_137	/fiduciary agent/i
body __T_FRAUD_82	/compliments? of the season/i
body __T_FRAUD_251	/magnanimity/i
body __T_FRAUD_162	/in the (?:lord'?s name|name of (?:our|the) lord)/i
body __T_FRAUD_19	/political crisis/i
body __T_FRAUD_254	/\bnumbered time\b/i
body __T_FRAUD_241	/urgent and(?: very)? (?:profitable|confidential) business propos(?:al|ition)/i
body __T_FRAUD_35	/international court of justice/i
body __T_FRAUD_35B	/international bank\b/i
body __T_FRAUD_217	/secrecy and confidentiality/i
body __T_FRAUD_221	/(?:the importance of|utmost) secrecy/i
body __T_FRAUD_124	/vital documents/i
body __T_FRAUD_60	/\bgabon\b/i
body __T_FRAUD_18	/over-invoice/i
body __T_FRAUD_42	/(?:finance|holding|securit(?:ies|y)) (?:company|firm|storage house)/i
body __T_FRAUD_31	/embassy/i
body __T_FRAUD_115	/your share shall be\b/i
body __T_FRAUD_115B	/your pr[i1]ze/i
body __T_FRAUD_3	/assassinate/i
body __T_FRAUD_220	/\bto assure you\b/i
body __T_FRAUD_220B	/\bto redeem\b/i
meta T_NIGERIAN_BODY_1	( __NIGERIAN_BODY_1 + __NIGERIAN_BODY_2 + __NIGERIAN_BODY_3 + __NIGERIAN_BODY_5 + __NIGERIAN_BODY_6 + __NIGERIAN_BODY_7 + __NIGERIAN_BODY_8 + __NIGERIAN_BODY_9 + __NIGERIAN_BODY_10 + __NIGERIAN_BODY_11 + __NIGERIAN_BODY_12 + __NIGERIAN_BODY_13 + __NIGERIAN_BODY_14 + __NIGERIAN_BODY_16 + __NIGERIAN_BODY_17 + __NIGERIAN_BODY_18 + __NIGERIAN_BODY_19 + __NIGERIAN_BODY_20 + __NIGERIAN_BODY_21 + __NIGERIAN_BODY_22 + __NIGERIAN_BODY_25 + __NIGERIAN_BODY_26 + __NIGERIAN_BODY_27 + __NIGERIAN_BODY_28 + __NIGERIAN_BODY_29 + __NIGERIAN_BODY_30 + __NIGERIAN_BODY_31 + __NIGERIAN_BODY_32 + __NIGERIAN_BODY_33 + __NIGERIAN_BODY_34 + __NIGERIAN_BODY_35 + __NIGERIAN_BODY_36 + __NIGERIAN_BODY_37 + __NIGERIAN_BODY_39 + __NIGERIAN_BODY_40 + __NIGERIAN_BODY_41 + __NIGERIAN_BODY_42 + __NIGERIAN_BODY_43 + __NIGERIAN_BODY_44 + __NIGERIAN_BODY_45 + __NIGERIAN_BODY_46 + __T_FRAUD_92 + __T_FRAUD_110 + __T_FRAUD_2 + __T_FRAUD_102 + __T_FRAUD_144 + __T_FRAUD_235 + __T_FRAUD_258 + __T_FRAUD_113 + __T_FRAUD_63 + __T_FRAUD_44 + __T_FRAUD_52 + __T_FRAUD_81 + __T_FRAUD_58 + __T_FRAUD_259 + __T_FRAUD_149 + __T_FRAUD_51 + __T_FRAUD_236 + __T_FRAUD_249 + __T_FRAUD_125 + __T_FRAUD_56 + __T_FRAUD_252 + __T_FRAUD_132 + __T_FRAUD_227 + __T_FRAUD_100 + __T_FRAUD_26 + __T_FRAUD_53 + __T_FRAUD_88 + __T_FRAUD_16 + __T_FRAUD_240 + __T_FRAUD_157 + __T_FRAUD_46 + __T_FRAUD_133 + __T_FRAUD_228 + __T_FRAUD_120 + __T_FRAUD_114 + __T_FRAUD_142 + __T_FRAUD_94 + __T_FRAUD_146 + __T_FRAUD_96 + __T_FRAUD_41 + __T_FRAUD_216 + __T_FRAUD_74 + __T_FRAUD_137 + __T_FRAUD_82 + __T_FRAUD_251 + __T_FRAUD_162 + __T_FRAUD_19 + __T_FRAUD_254 + __T_FRAUD_241 + __T_FRAUD_35 + __T_FRAUD_217 + __T_FRAUD_221 + __T_FRAUD_124 + __T_FRAUD_60 + __T_FRAUD_18 + __T_FRAUD_42 + __T_FRAUD_31 + __T_FRAUD_115 + __T_FRAUD_3 + __T_FRAUD_220 ) > 1
meta T_NIGERIAN_BODY_2	( __NIGERIAN_BODY_1 + __NIGERIAN_BODY_2 + __NIGERIAN_BODY_3 + __NIGERIAN_BODY_5 + __NIGERIAN_BODY_6 + __NIGERIAN_BODY_7 + __NIGERIAN_BODY_8 + __NIGERIAN_BODY_9 + __NIGERIAN_BODY_10 + __NIGERIAN_BODY_11 + __NIGERIAN_BODY_12 + __NIGERIAN_BODY_13 + __NIGERIAN_BODY_14 + __NIGERIAN_BODY_16 + __NIGERIAN_BODY_17 + __NIGERIAN_BODY_18 + __NIGERIAN_BODY_19 + __NIGERIAN_BODY_20 + __NIGERIAN_BODY_21 + __NIGERIAN_BODY_22 + __NIGERIAN_BODY_25 + __NIGERIAN_BODY_26 + __NIGERIAN_BODY_27 + __NIGERIAN_BODY_28 + __NIGERIAN_BODY_29 + __NIGERIAN_BODY_30 + __NIGERIAN_BODY_31 + __NIGERIAN_BODY_32 + __NIGERIAN_BODY_33 + __NIGERIAN_BODY_34 + __NIGERIAN_BODY_35 + __NIGERIAN_BODY_36 + __NIGERIAN_BODY_37 + __NIGERIAN_BODY_39 + __NIGERIAN_BODY_40 + __NIGERIAN_BODY_41 + __NIGERIAN_BODY_42 + __NIGERIAN_BODY_43 + __NIGERIAN_BODY_44 + __NIGERIAN_BODY_45 + __NIGERIAN_BODY_46 + __T_FRAUD_92 + __T_FRAUD_110 + __T_FRAUD_2 + __T_FRAUD_102 + __T_FRAUD_144 + __T_FRAUD_235 + __T_FRAUD_258 + __T_FRAUD_113 + __T_FRAUD_63 + __T_FRAUD_44 + __T_FRAUD_52 + __T_FRAUD_81 + __T_FRAUD_58 + __T_FRAUD_259 + __T_FRAUD_149 + __T_FRAUD_51 + __T_FRAUD_236 + __T_FRAUD_249 + __T_FRAUD_125 + __T_FRAUD_56 + __T_FRAUD_252 + __T_FRAUD_132 + __T_FRAUD_227 + __T_FRAUD_100 + __T_FRAUD_26 + __T_FRAUD_53 + __T_FRAUD_88 + __T_FRAUD_16 + __T_FRAUD_240 + __T_FRAUD_157 + __T_FRAUD_46 + __T_FRAUD_133 + __T_FRAUD_228 + __T_FRAUD_120 + __T_FRAUD_114 + __T_FRAUD_142 + __T_FRAUD_94 + __T_FRAUD_146 + __T_FRAUD_96 + __T_FRAUD_41 + __T_FRAUD_216 + __T_FRAUD_74 + __T_FRAUD_137 + __T_FRAUD_82 + __T_FRAUD_251 + __T_FRAUD_162 + __T_FRAUD_19 + __T_FRAUD_254 + __T_FRAUD_241 + __T_FRAUD_35 + __T_FRAUD_217 + __T_FRAUD_221 + __T_FRAUD_124 + __T_FRAUD_60 + __T_FRAUD_18 + __T_FRAUD_42 + __T_FRAUD_31 + __T_FRAUD_115 + __T_FRAUD_3 + __T_FRAUD_220 ) > 2
meta T_NIGERIAN_BODY_3	( __NIGERIAN_BODY_1 + __NIGERIAN_BODY_2 + __NIGERIAN_BODY_3 + __NIGERIAN_BODY_5 + __NIGERIAN_BODY_6 + __NIGERIAN_BODY_7 + __NIGERIAN_BODY_8 + __NIGERIAN_BODY_9 + __NIGERIAN_BODY_10 + __NIGERIAN_BODY_11 + __NIGERIAN_BODY_12 + __NIGERIAN_BODY_13 + __NIGERIAN_BODY_14 + __NIGERIAN_BODY_16 + __NIGERIAN_BODY_17 + __NIGERIAN_BODY_18 + __NIGERIAN_BODY_19 + __NIGERIAN_BODY_20 + __NIGERIAN_BODY_21 + __NIGERIAN_BODY_22 + __NIGERIAN_BODY_25 + __NIGERIAN_BODY_26 + __NIGERIAN_BODY_27 + __NIGERIAN_BODY_28 + __NIGERIAN_BODY_29 + __NIGERIAN_BODY_30 + __NIGERIAN_BODY_31 + __NIGERIAN_BODY_32 + __NIGERIAN_BODY_33 + __NIGERIAN_BODY_34 + __NIGERIAN_BODY_35 + __NIGERIAN_BODY_36 + __NIGERIAN_BODY_37 + __NIGERIAN_BODY_39 + __NIGERIAN_BODY_40 + __NIGERIAN_BODY_41 + __NIGERIAN_BODY_42 + __NIGERIAN_BODY_43 + __NIGERIAN_BODY_44 + __NIGERIAN_BODY_45 + __NIGERIAN_BODY_46 + __T_FRAUD_92 + __T_FRAUD_110 + __T_FRAUD_2 + __T_FRAUD_102 + __T_FRAUD_144 + __T_FRAUD_235 + __T_FRAUD_258 + __T_FRAUD_113 + __T_FRAUD_63 + __T_FRAUD_44 + __T_FRAUD_52 + __T_FRAUD_81 + __T_FRAUD_58 + __T_FRAUD_259 + __T_FRAUD_149 + __T_FRAUD_51 + __T_FRAUD_236 + __T_FRAUD_249 + __T_FRAUD_125 + __T_FRAUD_56 + __T_FRAUD_252 + __T_FRAUD_132 + __T_FRAUD_227 + __T_FRAUD_100 + __T_FRAUD_26 + __T_FRAUD_53 + __T_FRAUD_88 + __T_FRAUD_16 + __T_FRAUD_240 + __T_FRAUD_157 + __T_FRAUD_46 + __T_FRAUD_133 + __T_FRAUD_228 + __T_FRAUD_120 + __T_FRAUD_114 + __T_FRAUD_142 + __T_FRAUD_94 + __T_FRAUD_146 + __T_FRAUD_96 + __T_FRAUD_41 + __T_FRAUD_216 + __T_FRAUD_74 + __T_FRAUD_137 + __T_FRAUD_82 + __T_FRAUD_251 + __T_FRAUD_162 + __T_FRAUD_19 + __T_FRAUD_254 + __T_FRAUD_241 + __T_FRAUD_35 + __T_FRAUD_217 + __T_FRAUD_221 + __T_FRAUD_124 + __T_FRAUD_60 + __T_FRAUD_18 + __T_FRAUD_42 + __T_FRAUD_31 + __T_FRAUD_115 + __T_FRAUD_3 + __T_FRAUD_220 ) > 3
meta T_NIGERIAN_BODY_4	( __NIGERIAN_BODY_1 + __NIGERIAN_BODY_2 + __NIGERIAN_BODY_3 + __NIGERIAN_BODY_5 + __NIGERIAN_BODY_6 + __NIGERIAN_BODY_7 + __NIGERIAN_BODY_8 + __NIGERIAN_BODY_9 + __NIGERIAN_BODY_10 + __NIGERIAN_BODY_11 + __NIGERIAN_BODY_12 + __NIGERIAN_BODY_13 + __NIGERIAN_BODY_14 + __NIGERIAN_BODY_16 + __NIGERIAN_BODY_17 + __NIGERIAN_BODY_18 + __NIGERIAN_BODY_19 + __NIGERIAN_BODY_20 + __NIGERIAN_BODY_21 + __NIGERIAN_BODY_22 + __NIGERIAN_BODY_25 + __NIGERIAN_BODY_26 + __NIGERIAN_BODY_27 + __NIGERIAN_BODY_28 + __NIGERIAN_BODY_29 + __NIGERIAN_BODY_30 + __NIGERIAN_BODY_31 + __NIGERIAN_BODY_32 + __NIGERIAN_BODY_33 + __NIGERIAN_BODY_34 + __NIGERIAN_BODY_35 + __NIGERIAN_BODY_36 + __NIGERIAN_BODY_37 + __NIGERIAN_BODY_39 + __NIGERIAN_BODY_40 + __NIGERIAN_BODY_41 + __NIGERIAN_BODY_42 + __NIGERIAN_BODY_43 + __NIGERIAN_BODY_44 + __NIGERIAN_BODY_45 + __NIGERIAN_BODY_46 + __T_FRAUD_92 + __T_FRAUD_110 + __T_FRAUD_2 + __T_FRAUD_102 + __T_FRAUD_144 + __T_FRAUD_235 + __T_FRAUD_258 + __T_FRAUD_113 + __T_FRAUD_63 + __T_FRAUD_44 + __T_FRAUD_52 + __T_FRAUD_81 + __T_FRAUD_58 + __T_FRAUD_259 + __T_FRAUD_149 + __T_FRAUD_51 + __T_FRAUD_236 + __T_FRAUD_249 + __T_FRAUD_125 + __T_FRAUD_56 + __T_FRAUD_252 + __T_FRAUD_132 + __T_FRAUD_227 + __T_FRAUD_100 + __T_FRAUD_26 + __T_FRAUD_53 + __T_FRAUD_88 + __T_FRAUD_16 + __T_FRAUD_240 + __T_FRAUD_157 + __T_FRAUD_46 + __T_FRAUD_133 + __T_FRAUD_228 + __T_FRAUD_120 + __T_FRAUD_114 + __T_FRAUD_142 + __T_FRAUD_94 + __T_FRAUD_146 + __T_FRAUD_96 + __T_FRAUD_41 + __T_FRAUD_216 + __T_FRAUD_74 + __T_FRAUD_137 + __T_FRAUD_82 + __T_FRAUD_251 + __T_FRAUD_162 + __T_FRAUD_19 + __T_FRAUD_254 + __T_FRAUD_241 + __T_FRAUD_35 + __T_FRAUD_217 + __T_FRAUD_221 + __T_FRAUD_124 + __T_FRAUD_60 + __T_FRAUD_18 + __T_FRAUD_42 + __T_FRAUD_31 + __T_FRAUD_115 + __T_FRAUD_3 + __T_FRAUD_220 ) > 4


# bug 3395
header    T_YAHOO_MSGID_CAPS          Message-ID =~ /<[A-Z]+\@yahoo.com>/
describe  T_YAHOO_MSGID_CAPS          Message-ID has all-caps@yahoo.com

# bug 3396
header    T_CT_BOUND_DDNUM        Content-Type =~ /boundary="--\d+"/
describe  T_CT_BOUND_DDNUM	  Content-Type header has boundary in ratware form

# bug 3399
header   T_MSGID_CAPS  Message-ID =~ /<[A-Z]+\@[a-z]+\.[a-z]{2,4}>/
header   T_MSGID_CAPS2  Message-ID =~ /<[A-Z]+\@(?!mailcity\.com)[a-z]+\.[a-z]{2,4}>/
header   T_MSGID_CAPS3		Message-ID =~ /^\s*<?[A-Z]+\@(?!mailcity\.com)/

# bug 3403: not decoded, as we're explicitly searching for the encoded
# version catches all versions of IP obfuscation mentioned here:
# http://www.pc-help.org/obscure.htm
uri T_HEXOCTDWORD_U	m{(?:h|%68|%48)(?:t|%74|%54)(?:t|%74|%54)(?:p|%70|%50)(?:s|%73|%53)?(?::|%3a)(?:/|%2f){0,2}(?:(?:(?!\@|%40|\?).)+(?:\@|%40))*(?!123\.456\.789\.(?:999|012)|(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)(?:$|\.(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)(?:$|\.(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)(?:$|\.(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)))))(?:(?:%3[0-9]|\d)+|(?:0|%30)(?:x|%[57]8)(?:%(?:3[0-9]|[46][1-6])|[0-9A-Fa-f])+|(?:0|%30)(?:%3[0-9]|[0-7])+)(?:(?:\.|%2e)(?:%3[0-9]|\d)+|(?:0|%30)(?:x|%[57]8)(?:%(?:3[0-9]|[46][1-6])|[0-9A-Fa-f])+|(?:0|%30)(?:%3[0-9]|[0-7])+){0,3}(?:[:\?;&/\\]|%3[abABfF]|%2[6fF]|%5[cC]|$)}i
describe T_HEXOCTDWORD_U	Uses an encoded IP address

rawbody T_HEXOCTDWORD_R	m{(?:h|%68|%48)(?:t|%74|%54)(?:t|%74|%54)(?:p|%70|%50)(?:s|%73|%53)?(?::|%3a)(?:/|%2f){0,2}(?:(?:(?!\@|%40|\?).)+(?:\@|%40))*(?!123\.456\.789\.(?:999|012)|(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)(?:$|\.(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)(?:$|\.(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)(?:$|\.(?:2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)))))(?:(?:%3[0-9]|\d)+|(?:0|%30)(?:x|%[57]8)(?:%(?:3[0-9]|[46][1-6])|[0-9A-Fa-f])+|(?:0|%30)(?:%3[0-9]|[0-7])+)(?:(?:\.|%2e)(?:%3[0-9]|\d)+|(?:0|%30)(?:x|%[57]8)(?:%(?:3[0-9]|[46][1-6])|[0-9A-Fa-f])+|(?:0|%30)(?:%3[0-9]|[0-7])+){0,3}(?:[:\?;&/\\]|%3[abABfF]|%2[6fF]|%5[cC]|$)}i
describe T_HEXOCTDWORD_R	Uses an encoded IP address
