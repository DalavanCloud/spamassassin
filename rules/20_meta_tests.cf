# SpamAssassin rules file: meta tests
#
# Please don't modify this file as your changes will be overwritten with
# the next update. Use @@LOCAL_RULES_DIR@@/local.cf instead.
# See 'perldoc Mail::SpamAssassin::Conf' for details.
#
# Add meta tests which cover *both* headers and body here.
#
# Note: body tests are run with long lines, so be sure to limit the
# size of searches; use /.{0,30}/ instead of /.*/ to avoid huge
# search times.
#
###########################################################################

require_version @@VERSION@@

# some tests that will trigger FPs on ISO-2022-JP mails.

body __ISO_2022_JP_DELIM	/\e\$B/

body __THREE_DOLLARS		/\${3,}/
header __MANY_EXCLS             Subject =~ /![^!]+!/
header __PLING_PLING            Subject =~ /!!!/

body __UPPERCASE_25_50          eval:check_for_uppercase('25', '50')
body __UPPERCASE_50_75          eval:check_for_uppercase('50', '75')
body __UPPERCASE_75_100         eval:check_for_uppercase('75', '100')

meta CASHCASHCASH		(!__ISO_2022_JP_DELIM && __THREE_DOLLARS)
describe CASHCASHCASH		Contains at least 3 dollar signs in a row
meta MANY_EXCLAMATIONS          (!__ISO_2022_JP_DELIM && __MANY_EXCLS)
describe MANY_EXCLAMATIONS      Subject has many exclamations
meta UPPERCASE_25_50            (!__ISO_2022_JP_DELIM && __UPPERCASE_25_50)
describe UPPERCASE_25_50        message body is 25-50% uppercase
meta UPPERCASE_50_75            (!__ISO_2022_JP_DELIM && __UPPERCASE_50_75)
describe UPPERCASE_50_75        message body is 50-75% uppercase
meta UPPERCASE_75_100           (!__ISO_2022_JP_DELIM && __UPPERCASE_75_100)
describe UPPERCASE_75_100       message body is 75-100% uppercase
meta PLING_PLING                (!__ISO_2022_JP_DELIM && __PLING_PLING)
describe PLING_PLING            Subject has lots of exclamation marks

# Steve Linford via Charlie Watts: good test!
header __RCVD_BY_HOTMAIL	Received =~ / by hotmail\.com /
body __MIME_HTML_ONLY		eval:check_for_mime_html_only()
meta MIME_HTML_ONLY		(!__RCVD_BY_HOTMAIL && __MIME_HTML_ONLY)

##############################################################################

meta NIGERIAN_BODY	(( __NIGERIAN_BODY_.+ + ) > 1)
describe NIGERIAN_BODY	Message body indicates a Nigerian spam
body __NIGERIAN_BODY_1	/\b(?:financial|confiden(?:tial|ce)|safe(?:ty)?|mutual|secret|success(?:ful)?|risk-?free|details|business).{1,30}\btransaction\b/i
body __NIGERIAN_BODY_2	/\btransaction\b.{1,30}\b(?:magnitude|diplomatic|strict|absolute|secret|confiden(?:tial|ce)|guarantee)/i
body __NIGERIAN_BODY_3	/BASED ON INFORMATION GATHERED ABOUT YOU, WE BELIEVE\s*YOU WOULD BE IN A POSITION TO HELP US IN TRANSFER/i
#body __NIGERIAN_BODY_4	/\bBarrister\b/i
body __NIGERIAN_BODY_5 /\bpoisoned (?:to death )?by his business associate/i
body __NIGERIAN_BODY_6	/\bIt is with trust and confidentiality\b/i
body __NIGERIAN_BODY_7	/\bU\.?S\.?(?:D\.?)?\s*(?:\$\s*)?(?:\d+,\d+,\d+|\d+\.\d+\.\d+|\d+(?:\.\d+)?\s*milli?on)/i
body __NIGERIAN_BODY_8	/\b(?:You may be sur?prised to receive this letter from me|this (?:letter|mail) (?:(?:may|will) come to you as|will be) a sur?prise)\b/i
body __NIGERIAN_BODY_9	/\bthe .{1,10} son of\b/i
body __NIGERIAN_BODY_10	/\burgent and(?: very)? (?:profitable|confidential) business (?:proposal|proposition)\b/i
body __NIGERIAN_BODY_11	/\bassistance to relocate\b/i
body __NIGERIAN_BODY_12 /\bto which will be transferred the sum\b/i
body __NIGERIAN_BODY_13	/\byour(?: private)? (?:tele)?phone (?:and|&) fax Numbers?\b/i
body __NIGERIAN_BODY_14	/\bthe importance of Secrecy\b/i
body __NIGERIAN_BODY_15	/\bmodalities\b/i
body __NIGERIAN_BODY_16	/\bI am a Private Investigator\b/i
body __NIGERIAN_BODY_17	/\bWRITING THIS LETTER TO SOLICIT\b/i
body __NIGERIAN_BODY_18	/\bSEVERAL ATTEMPTS HAVE BEEN MADE WITH OUT SUCCESS\b/i
body __NIGERIAN_BODY_19	/\bMY PROPOSAL IS ACCEPTABLE\b/i
body __NIGERIAN_BODY_20	/\d+%\)? (?:of (?:the total|this|the) (?:amount|sum|money)|for you|for my investment|for (?:us|me)|.{0,15}\bfor your expenses)\b/i
body __NIGERIAN_BODY_21 /\bforeign account\b/i
body __NIGERIAN_BODY_22 /\btrust (?:and|&) confidentiality\b/i
body __NIGERIAN_BODY_25	/\bvery beneficial to both of us\b/i
body __NIGERIAN_BODY_26	/\bmilli?on (?:.{1,25} thousand\s*)?(?:(?:united states|u\.?s\.?) dollars|(?i:U\.?S\.?D?))\b/i
body __NIGERIAN_BODY_27	/\bcorrespondent branch\b/i
body __NIGERIAN_BODY_28	/\btransaction is .{1,15} risk free.\b/i
body __NIGERIAN_BODY_29	/\b(?:percentage|rate) of this money\b/i
body __NIGERIAN_BODY_30	/\bfavou?rable response\b/i
body __NIGERIAN_BODY_31	/\btotal acceptance and commitment\b/i
body __NIGERIAN_BODY_32 /\blocate(?: .{1,20})? extended relative/i
body __NIGERIAN_BODY_33 /\bhonest cooperation\b/i
body __NIGERIAN_BODY_34 /\b(?:wife|son|brother|daughter) of the late\b/i
body __NIGERIAN_BODY_35 /\bintuitive confidence/i
body __NIGERIAN_BODY_36 /\battached to ticket number\b/i
body __NIGERIAN_BODY_37 /\ball funds will be returned\b/i
body __NIGERIAN_BODY_38 /\b(?:International\b.{1,15}\bLottery|lottery\b.{1,15}\binternational)\b/i
body __NIGERIAN_BODY_39 /\bYOUR FULL NAMES?,?(?:and|&)? FULL CONTACT ADDRESS\b/i
body __NIGERIAN_BODY_40	/\bsend .{1,30}\byour telefax Numbers?\b/i


header NIGERIAN_SUBJECT1	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:(?:very )?URGENT|ATTENTION)\s*$/i
describe NIGERIAN_SUBJECT1	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT2	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:very )?urgent\s+(?:(?:and|&)\s+)?(?:confidential|assistance|business|attention|reply|response|help)\b/i
describe NIGERIAN_SUBJECT2	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT3	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*your assistance\b/i
describe NIGERIAN_SUBJECT3	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT4	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*i need your urgent\b/i
describe NIGERIAN_SUBJECT4	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT5	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*treat as urgent\b/i
describe NIGERIAN_SUBJECT5	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT6	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:family )?assis?tance\s*$/i
describe NIGERIAN_SUBJECT6	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT7	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*[!*_-]+\s*(?:business|urgent)/i
describe NIGERIAN_SUBJECT7	Subject is indicitive of a Nigerian spam
header NIGERIAN_SUBJECT8	Subject =~ /^(?:Re:|\[.{1,10}\])?\s*(?:appeal|request) for urgent assistance$/i
describe NIGERIAN_SUBJECT8	Subject is indicitive of a Nigerian spam

##############################################################################
