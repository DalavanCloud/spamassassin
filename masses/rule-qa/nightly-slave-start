#!/bin/sh

echo "Using ssh-nightly-slave settings from $HOME/.corpus"
. $HOME/.corpus

host="$1"

# use $PERL from env if unset
[ "x${PERL:-}" = x ] && PERL=perl
set -x
set -e

tar=tar
[ -x /usr/sfw/bin/gtar ] && tar=/usr/sfw/bin/gtar

cd $tree
$tar cfz $tmp/tf \
        --exclude="*.log" \
        --exclude=".svn" \
        --exclude="tmp" \
        .

[ "$clienttree" = "" ] && clienttree=tree

ssh $host rm -rf $clienttree \; mkdir $clienttree
ssh $host cd $clienttree \; tar xvfz - < $tmp/tf

ssh -f $host cd $clienttree/masses \; \
    TZ=UTC ./mass-check --cs_ssl --client $serverhost &

