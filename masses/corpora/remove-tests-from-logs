#!/usr/bin/perl
use Getopt::Std;
getopt('t');

my @tests = @ARGV;

my $sub = '
        while (<STDIN>) {
';
if ( defined $opt_t ) {
	  $sub .= '
	  /\btime=(\d+)/;
	  # strip out the tests up to a given timestamp
	  if ( !defined $1 || '.$opt_t.' > $1 ) {
';
}

foreach my $test (@tests) {
          $sub .= q{ s/\b\Q}.$test.q{\E\b//g; };
}
$sub .= '
            s/,,+/,/g; s/,+$//; s/ ,/ /;
';

$sub .= '}' if ( defined $opt_t );

$sub .= '
	  print;
        }
';

#print $sub;die;
eval $sub;
