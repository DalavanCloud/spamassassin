#!/usr/bin/perl
#
# Split a mass-check log into n identically-sized buckets, evenly
# taking messages from all checked corpora and preserving comments.
# It does this evenly by running through all buckets sequentially
# as each line is read.

my $numbuckets = 10;

my %buckets = ();
foreach my $i (1 .. $numbuckets) {
  print "Creating out-$i.log\n";
  open ($buckets{$i}, ">out-$i.log");
}

my $current = 0;
while (<>) {
  select $buckets{$current+1}; print $_;
  if (/^#/) { next; }
  $current = ($current+1) % $numbuckets;
}

foreach my $i (1 .. $numbuckets) {
  close $buckets{$i};
}

