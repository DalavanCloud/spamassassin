# SpamAssassin rules file: CVS rules under test
#
# This file is a placeholder for rules "under probation", ie. checked into
# CVS for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
###########################################################################

# should be fixed now
header T_INVALID_MSGID		Message-Id !~ /^<(?:[a-zA-Z0-9.,!\#\$%&'*\+\/=?\^_{}|~-]+|\".+\")\@(?:[a-zA-Z0-9_.-]+|\[\d{1,3}(?:\.\d{1,3}){3}\])>(?:\s*\(.*\))?\s*$/ [if-unset: <NO@MSGID>]
describe T_INVALID_MSGID	Message-Id is not valid, according to RFC 2822

# results for quinlan
#  0.149    0.458    0.000    1.00    0.72    0.50  T_FROM_TOPICA
header T_FROM_TOPICA		From:addr =~ /\@(?:\w+\.)?email-publisher\.com$/
describe T_FROM_TOPICA		From an address at email-publisher.com
score T_FROM_TOPICA		0.5

# results for quinlan
#  0.245    0.727    0.013    0.98    0.57    0.50  T_FROM_ALL_NUMS
header __FROM_JUST_NUMBER	From:addr =~ /^\d+\@/
header __FROM_PHONE		From:addr =~ /^\d{3}(?:[-.]?\d{3}[-.]?\d{4}|\d{7})\@/
meta T_FROM_ALL_NUMS		(__FROM_JUST_NUMBER && !__FROM_PHONE)
describe T_FROM_ALL_NUMS	From an address that is all numbers (non-phone)
score T_FROM_ALL_NUMS		0.5

# seems like the hit rate is a bit too low on this one
uri ADCLICK_URL		m,\Qhttp://www.adclick.ws/p\E,
describe ADCLICK_URL	Contains adclick URL

# Needs testing
body T_QUOTE_TWICE_1		/^> >\s/
describe T_QUOTE_TWICE_1	Contains twice quoted reply
tflags T_QUOTE_TWICE_1		nice
score T_QUOTE_TWICE_1		-1.0

# Needs testing
# Outlook Express has spaces around the text, Outlook doesn't
# (jm comment: please add ^ anchor if possible.)
body T_OUTLOOK_REPLY		/----- ?Original Message ?-----/s
describe T_OUTLOOK_REPLY	Contains what looks like an outlook reply
tflags T_OUTLOOK_REPLY		nice
score T_OUTLOOK_REPLY		-1.0
#
# anchored version of T_OUTLOOK_REPLY
# T_OUTLOOK_REPLY gets some FPs and matches messages that are replies to
# replies
header __ORIGINAL_MESSAGE_AGENT	X-Mailer =~ /\b(?:Microsoft Outlook|Internet Mail Service|Mozilla|AOL)\b/
rawbody __ORIGINAL_MESSAGE_LINE	/^-{5,8} ?Original Message ?-{5,8}$/
meta T_ORIGINAL_MESSAGE		(__ORIGINAL_MESSAGE_AGENT && __ORIGINAL_MESSAGE_LINE)
describe T_ORIGINAL_MESSAGE	Looks like a reply to a message
tflags T_ORIGINAL_MESSAGE	nice
score T_ORIGINAL_MESSAGE	-1.0

# avoid an FP; good ones have a hostname after the @
header T_MSGID_GOOD_EXCHANGE	Message-Id =~ /^<[A-Z]{28}\.\S+\@\S+>$/
tflags T_MSGID_GOOD_EXCHANGE	nice
score T_MSGID_GOOD_EXCHANGE	-1.0

# Looks good, but should be tested first.  fixes current THIS_AINT_SPAM
body T_THIS_AINT_SPAM		/This.{0,30}is.{1,10}not?.{0,15}spam/is
describe T_THIS_AINT_SPAM	Claims "This is not spam"

# this rule needs some tweaking to reduce FPs
body T_EXCUSE_24		/you(?:'ve|'re| have| are)? receiv(?:ed|ing) this (?:e.?mail|advertisement) (?:by either|because)/i

###########################################################################
# quinlan: I converted almost 2000 postfix anti-spam rules into SA format,
# tested many permutations of each, refined some into better rules, and
# here are the ones still left standing.  Some are quite good.
#
# to keep this somewhat sane
# - all rulenames are prefixed with "T_Q_"
# - close-variants of same rule have same name with "_V[0-9]" ending
# - other numbered rules are just similar in concept

body T_Q_THIS_IS_AN_AD		/this message is an advertisement/i
header T_Q_ADV_GAPPY		Subject =~ /\bA\s+D\s+V\b/i

body T_Q_APPLY_FREE		/(?-i:F)ree (?-i:A)pplication|free application.{0,32}(?:today|minute|less than)/i

header T_Q_FRIEND_PUBLIC	ALL =~ /^(to|cc|from):.*friend\@public\.com/im

header T_Q_FIND_OUT_ANY1 	Subject =~ /Find Out Any/i
body T_Q_FIND_OUT_ANY2		/Find Out Anything About Anyone/i

# similar to THIS_AINT_SPAM
body T_Q_OKAY1			/cannot be considered spam/i
# similar to SENT_IN_COMPLIANCE
body T_Q_OKAY2			/sent (?:to you )?in compliance (?:with|of)/i
# similar to various 1618 rules
body T_Q_OKAY3			/Under Bill s.?1618/i

body T_Q_ONETIME1		/One[- ]?Time Mail/i
body T_Q_ONETIME2		/this is a one[- ]?time (?:e-?mail|mailing|offer)/i
body T_Q_ONETIME3		/Never Receive Another Mailing/i

header T_Q_AS_SEEN		Subject =~ /\bAs Seen/i
header T_Q_DOUBLE_YOUR 		Subject =~ /Double Your/i
header T_Q_FOR_ONLY 		Subject =~ /For Only/i
header T_Q_FREE_INSTANT 	Subject =~ /Free Instant/i
header T_Q_INKJET_PITCH		Subject =~ /inkjet cartridges/i
header T_Q_LIFE_INSURANCE	Subject =~ /Life Insurance/i
header T_Q_LOSE_WEIGHT		Subject =~ /(?:lose .{0,16}(?:weight|pounds|lbs)|weight.loss)/i
header T_Q_NOW_ONLY		Subject =~ /\bNow Only/i
header T_Q_RIPPED		Subject =~ /Ripped & Strong/i
header T_Q_SAVE_PERCENT		Subject =~ /save (?:[6-9]\d%|up to \d+%)/i
header T_Q_VIAGRA_SUBJECT	Subject =~ /Viagra/i
header T_Q_YOUR_DEBT		Subject =~ /Your (?:Bills|Debt|Credit)/i
header T_Q_YOUR_FAMILY		Subject =~ /Your Family/i
header T_Q_YOUR_OWN		Subject =~ /Your Own/i
header T_Q_YOUR_PENIS		Subject =~ /Your Penis/i

# UNPRINTABLE is supposedly 5.6 specific so it will need to be fixed/delayed
body T_Q_UNPRINTABLE		/[[:^print:]]{8,}/
body T_Q_CREDIT_BODY		/Accept Credit Cards/i
body T_Q_BURNING_FAT		/Aging While Burning Fat/i
body T_Q_FREE_ADULT		/Free Adult/i
body T_Q_FREE_MEMBERSHIP	/FREE MEMBERSHIP/i
body T_Q_GUARANTEED_BANG	/GUARANTEED!/i
body T_Q_HOME_LOANS		/Home Loans/i
body T_Q_INVALUABLE		/Invaluable Marketing Information/i
body T_Q_LOCATE_ASSETS		/Locate Hidden Assets/i
body T_Q_MILLION_EMAIL		/Million (?:\w+ )?(?:E-?mail )?Addresses/i
# do not pluralize next rule
body T_Q_PRODUCT_SERVICE	/PRODUCT or SERVICE/i
# similar to OFFER, but fewer FPs
body T_Q_RECEIVE_OFFER		/Receive Special Offer/i
body T_Q_RECEIVE_EMAIL		/Receive Third Party Email/i
body T_Q_REFINANCE_HOME		/Refinance Your Home/i
body T_Q_YOUR_SIZE		/Your Penis Size/i
###########################################################################

# These seem to work well for me to find a "unique identifier" which happens
# to be a rot13 email address, note that these don't actually test for rot13
# encoding, they look for the obscuring of the "@" and "."  characters.
body T_ROT13_EMAIL		/^(\w+\^\S+\(\S+)(?:\s+\#+\s+\1)?\s*$/m
describe T_ROT13_EMAIL		Message has what looks like a ROT13 encoded email address

body T_ROT13_EMAIL_2		/^(\w+\^\S+\(\S+)(?:\s+\#+\s+\1)?[\s\n]*\Z/m
describe T_ROT13_EMAIL_2	Message has what looks like a ROT13 encoded email address

body T_ROT13_EMAIL_3		/^(\w+\^\S+\(\S+)/m
describe T_ROT13_EMAIL_3	Message has what looks like a ROT13 encoded email address

# should have all the hits of T_ROT13_EMAIL_3 but perhaps be slightly less
# prone to FPs
body T_ROT13_EMAIL_4		/^\w+\^\S+\(\w{2,3}\b/m
describe T_ROT13_EMAIL_4	Message has what looks like a ROT13 encoded email address

# mailman list reminder mails are getting tagged in 2.41, adding a rule to check for these
header __FROM_MAILMAN_OWNER	From:addr =~ /^mailman-owner@/
header __SUBJECT_MAILMAN_REMIND	Subject =~ /\bmailing list memberships reminder\b/
meta T_MAILMAN_REMINDER		(__FROM_MAILMAN_OWNER && __SUBJECT_MAILMAN_REMIND)
describe T_MAILMAN_REMINDER	Mail headers indicate a mailman membership reminder
score T_MAILMAN_REMINDER		-3
tflags T_MAILMAN_REMINDER nice

########################################################

header   T_NONSENSE_FROM_1      From:addr =~ /[^\W\daeiouy_-]{5}\S*\@/i
describe T_NONSENSE_FROM_1      From user name appears to be nonsense (1)

header   T_NONSENSE_FROM_2      From:addr =~ /[^\W\daeiouy_-]{6,}\S*\@/i
describe T_NONSENSE_FROM_2      From user name appears to be nonsense (2)

header   T_NONSENSE_FROM_00_10  eval:nonsense_from_percent('00', '10')
describe T_NONSENSE_FROM_00_10  0%-10% weird trigraphs in From

header   T_NONSENSE_FROM_10_20  eval:nonsense_from_percent('10', '20')
describe T_NONSENSE_FROM_10_20  10%-20% weird trigraphs in From

header   T_NONSENSE_FROM_20_30  eval:nonsense_from_percent('20', '30')
describe T_NONSENSE_FROM_20_30  20%-30% weird trigraphs in From

header   T_NONSENSE_FROM_30_40  eval:nonsense_from_percent('30', '40')
describe T_NONSENSE_FROM_30_40  30%-40% weird trigraphs in From

header   T_NONSENSE_FROM_40_50  eval:nonsense_from_percent('40', '50')
describe T_NONSENSE_FROM_40_50  40%-50% weird trigraphs in From

header   T_NONSENSE_FROM_50_60  eval:nonsense_from_percent('50', '60')
describe T_NONSENSE_FROM_50_60  50%-60% weird trigraphs in From

header   T_NONSENSE_FROM_60_70  eval:nonsense_from_percent('60', '70')
describe T_NONSENSE_FROM_60_70  60%-70% weird trigraphs in From

header   T_NONSENSE_FROM_70_80  eval:nonsense_from_percent('70', '80')
describe T_NONSENSE_FROM_70_80  70%-80% weird trigraphs in From

header   T_NONSENSE_FROM_80_90  eval:nonsense_from_percent('80', '90')
describe T_NONSENSE_FROM_80_90  80%-90% weird trigraphs in From

#header   T_NONSENSE_FROM_90_100 eval:nonsense_from_percent('90', '100')
#describe T_NONSENSE_FROM_90_100 90%-100% weird trigraphs in From

header   T_NONSENSE_FROM_90_91 eval:nonsense_from_percent('90', '91')
header   T_NONSENSE_FROM_91_92 eval:nonsense_from_percent('91', '92')
header   T_NONSENSE_FROM_92_93 eval:nonsense_from_percent('92', '93')
header   T_NONSENSE_FROM_93_94 eval:nonsense_from_percent('93', '94')
header   T_NONSENSE_FROM_94_95 eval:nonsense_from_percent('94', '95')
header   T_NONSENSE_FROM_95_96 eval:nonsense_from_percent('95', '96')
header   T_NONSENSE_FROM_96_97 eval:nonsense_from_percent('96', '97')
header   T_NONSENSE_FROM_97_98 eval:nonsense_from_percent('97', '98')
header   T_NONSENSE_FROM_98_99 eval:nonsense_from_percent('98', '99')
header   T_NONSENSE_FROM_99_100 eval:nonsense_from_percent('99', '100')

score   T_NONSENSE_FROM_00_10  0.01
score   T_NONSENSE_FROM_10_20  0.01
score   T_NONSENSE_FROM_20_30  0.01
score   T_NONSENSE_FROM_30_40  0.01
score   T_NONSENSE_FROM_40_50  0.01
score   T_NONSENSE_FROM_50_60  0.01
score   T_NONSENSE_FROM_60_70  0.01
score   T_NONSENSE_FROM_70_80  0.01
score   T_NONSENSE_FROM_80_90  0.01
#score   T_NONSENSE_FROM_90_100 0.01

score   T_NONSENSE_FROM_90_91 0.01
score   T_NONSENSE_FROM_91_92 0.01
score   T_NONSENSE_FROM_92_93 0.01
score   T_NONSENSE_FROM_93_94 0.01
score   T_NONSENSE_FROM_94_95 0.01
score   T_NONSENSE_FROM_95_96 0.01
score   T_NONSENSE_FROM_96_97 0.01
score   T_NONSENSE_FROM_97_98 0.01
score   T_NONSENSE_FROM_98_99 0.01
score   T_NONSENSE_FROM_99_100 0.01
