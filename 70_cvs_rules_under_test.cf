# SpamAssassin rules file: CVS rules under test
#
# This file is a placeholder for rules "under probation", ie. checked into
# CVS for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of either the Artistic License or the GNU General
# Public License as published by the Free Software Foundation; either
# version 1 of the License, or (at your option) any later version.
#
# See the file "License" in the top level of the SpamAssassin source
# distribution for more details.
#
###########################################################################

header T_DATE_SPAMWARE_Y2K		Date =~ /^[A-Z][a-z]{2}, \d\d [A-Z][a-z]{2} [0-6]\d \d\d:\d\d:\d\d [A-Z]{3}$/
describe T_DATE_SPAMWARE_Y2K		Date header uses unusual Y2K formatting

# quinlan: I worked at a company that used CorporateTime which very annoyingly
# always used an ISO-8859-1 encoded header even when the Subject: did not have
# a non-ASCII character.  I think other false positives are likely due to
# similarly broken software.
# jm: I notice that all my FPs are gw'd thru IMS; let's try that.
header __SUBJ_BASE64			Subject:raw =~ /=\?[^\?]+\?B\?/
header __SUBJ_QP			Subject:raw =~ /=\?[^\?]+\?Q\?/
header __SUBJ_HAS_NON_ASCII		Subject =~ /[\x00-\x06\x0e-\x1f\x80-\xff]/
header __RCVD_IMS			Received =~ /Internet\s+Mail\s+Service/
meta T_UNNECESSARY_SUBJ_B64_ENCODING	(__SUBJ_BASE64 && !__SUBJ_HAS_NON_ASCII && !__RCVD_IMS)
meta T_UNNECESSARY_SUBJ_QP_ENCODING	(__SUBJ_QP && !__SUBJ_HAS_NON_ASCII && !__RCVD_IMS)
describe T_UNNECESSARY_SUBJ_B64_ENCODING Subject encoded to hide from filters (B64)
describe T_UNNECESSARY_SUBJ_QP_ENCODING Subject encoded to hide from filters (QP)

# A new spamware creates invalid Date stamps, using printf ("%d:%d:%d").
# Catch it here (assuming one of the above doesn't catch it anyway).
header __DATE_TIME_INVALID	Date =~ /\s(?!\d\d:\d\d:\d\d)\d{1,2}:\d{1,2}:\d{1,2}\s/
header __XM_BAD_DATE_MUAS	X-Mailer =~ /(?:FoxMail|EMUmail|TFS Secure Messaging|sendEmail|EarthLink MailBox \d\.\d)/i
meta T_INVALID_DATE_HMS		(__DATE_TIME_INVALID && !__XM_BAD_DATE_MUAS)
describe T_INVALID_DATE_HMS	Date header does not use valid HH:MM:SS formatting

# possible replacement for INVALID_DATE.
# rfc822:                       date-time =          [ day-of-week "," ]         (day / obs-day)                 month                           (year / obs-year)   hour ":" minute [ ":" second ]       (zone / obs-zone)          [ comment ]
header __INVALID_DATE		Date !~ /^\s*(?:(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), )?[0-3 ]?[0-9] (?:Jan|Feb|Ma[ry]|Apr|Ju[nl]|Aug|Sep|Oct|Nov|Dec) (?:19|20)?[0-9]{2} [0-2][0-9](?:\:[0-5][0-9]){1,2} (?:[+-][0-9]{4}|UT|[A-Z]{2,3}T)(?:\s+\(.*\))?\s*$/ [if-unset: Mon, 24 Feb 2003 09:30 +0100 (mss)]
header __XM_BAD_DATE_MUAS	X-Mailer =~ /(?:FoxMail|EMUmail|TFS Secure Messaging|sendEmail|EarthLink MailBox \d\.\d)/i
header __XM_FOXMAIL		X-Mailer =~ /FoxMail/
meta T_INVALID_DATE_2		(__INVALID_DATE && !__XM_BAD_DATE_MUAS)
describe T_INVALID_DATE_2	Invalid Date: header (not RFC 2822)

# Wierd.  Can only assume this is caused by PEBKAC on the sending side...
meta T_HTML_WITHOUT_HTML_1	(MIME_HTML_ONLY && !HTML_MESSAGE)
describe T_HTML_WITHOUT_HTML_1	Claims to be HTML, but there is no HTML text
# uses __MIME_HTML test from below and eval in EvalTests.pm (at least for now)
meta T_HTML_WITHOUT_HTML_2	(__MIME_HTML && !HTML_MESSAGE)
describe T_HTML_WITHOUT_HTML_2	Claims to be HTML, but there is no HTML text

# Jul  3 2002 jm: modified PENIS_ENLARGE patterns: removed "add", replaced with "inches",
# because that seems to be another typical word in the pattern.
# Feb 11 2003 jm: removed "PP" from pattern, since "pp. 234-237" is std usage
# in academic circles.  I don't think the hit-rate will be affected. ;)
# bug: http://www.hughes-family.org/bugzilla/show_bug.cgi?id=1471
body T_PENIS_ENLARGE		/\b(?:enlarge|increase|grow|lengthen|larger\b|bigger\b|longer\b|thicker\b|\binches\b).{0,50}\b(?:penis|male organ|pee[ -]?pee|dick|sc?hlong|wh?anger|breast)/i
describe T_PENIS_ENLARGE		Information on getting a larger penis or breasts
body T_PENIS_ENLARGE2		/\b(?:penis|male organ|pee[ -]?pee|dick|sc?hlong|wh?anger|breast).{0,50}\b(?:enlarge|increase|grow|lengthen|larger\b|bigger\b|longer\b|thicker\b|\binches\b)/i
describe T_PENIS_ENLARGE2		Information on getting a larger penis or breasts (2)

# Feb 18 2003 jm: another Nigerian scam
body T_NIGERIAN_SCAM_VIRTUE	/by virtue of its nature as being utterly confidential/i
describe T_NIGERIAN_SCAM_VIRTUE	Contains Nigerian scam text (virtue of its nature)

# Feb 18 2003 jm: try another combo.  I'm not sure __NIGERIAN_HONESTY is req'd.
body __NIGERIAN_CODE_CONDUCT		/\bcode of conduct\b/i
body __NIGERIAN_CIV_SERVICE		/\bcivil service\b/i
body __NIGERIAN_TOP_SECRET		/\btop secret\b/i
body __NIGERIAN_STRICT_CONF		/\b(?:strictest confidence|utmost secrecy)\b/i
body __NIGERIAN_HONESTY		/\btransparent honesty\b/i
body __NIGERIAN_DISBURSE		/\bdisburs/i
meta T_NIGERIAN_BODY_GOVT_6	((__NIGERIAN_CODE_CONDUCT + __NIGERIAN_CIV_SERVICE + __NIGERIAN_HONESTY + __NIGERIAN_TOP_SECRET + __NIGERIAN_STRICT_CONF + __NIGERIAN_DISBURSE) >= 6)
meta T_NIGERIAN_BODY_GOVT_5	((__NIGERIAN_CODE_CONDUCT + __NIGERIAN_CIV_SERVICE + __NIGERIAN_HONESTY + __NIGERIAN_TOP_SECRET + __NIGERIAN_STRICT_CONF + __NIGERIAN_DISBURSE) >= 5)
meta T_NIGERIAN_BODY_GOVT_4	((__NIGERIAN_CODE_CONDUCT + __NIGERIAN_CIV_SERVICE + __NIGERIAN_HONESTY + __NIGERIAN_TOP_SECRET + __NIGERIAN_STRICT_CONF + __NIGERIAN_DISBURSE) >= 4)
meta T_NIGERIAN_BODY_GOVT_3	((__NIGERIAN_CODE_CONDUCT + __NIGERIAN_CIV_SERVICE + __NIGERIAN_HONESTY + __NIGERIAN_TOP_SECRET + __NIGERIAN_STRICT_CONF + __NIGERIAN_DISBURSE) >= 3)

# 2003-02-23: quinlan
# some useful meta rule sub-elements
body __MIME_HTML		eval:check_for_mime_html()
header __CTYPE_HTML		Content-Type =~ /text\/html/i

# 2003-02-23: quinlan
# bug 1376: HTML without <!DOCTYPE> from mailers that always use <!DOCTYPE>
#
# Note: some variations of this rule actually perform better, but they all
# overlap 96-100% with MIME_HTML_ONLY whereas this variation adds real value
# and has a high hit rate.
body __HTML_TAG_EXISTS_DOCTYPE	eval:html_tag_exists('!doctype')
meta T_MIME_HTML_NO_DOCTYPE	(__MIME_HTML && !__HTML_TAG_EXISTS_DOCTYPE)

# 2003-02-23: quinlan
# bug 1533: new Received: header forgery tests using HELO
header T_FORGED_RCVD_HELO	eval:check_for_forged_received_helo()
header T_RCVD_NUMERIC_HELO	Received =~ /helo[= ]\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/i

# 2003-02-25: quinlan
# Whee... more HTML tests!
# Note: these use __MIME_HTML, we might need to exempt MIME attachments from
# that rule
header __ANY_OUTLOOK_MUA	X-Mailer =~ /^Microsoft Outlook\b/
header __ANY_IMS_MUA		X-Mailer =~ /^Internet Mail Service\b/
header __ANY_AOL_MUA		X-Mailer =~ /^AOL\b/
header __ANY_QUALCOMM_MUA	X-Mailer =~ /^QUALCOMM\b/
body __TAG_EXISTS_BODY		eval:html_tag_exists('body')
body __TAG_EXISTS_DIV		eval:html_tag_exists('div')
body __TAG_EXISTS_HEAD		eval:html_tag_exists('head')
body __TAG_EXISTS_HTML		eval:html_tag_exists('html')
body __TAG_EXISTS_META		eval:html_tag_exists('meta')
meta T_HTML_FAKED_OUTLOOK	(__ANY_OUTLOOK_MUA && __MIME_HTML && !(__TAG_EXISTS_BODY && __TAG_EXISTS_DIV && __TAG_EXISTS_HEAD && __TAG_EXISTS_HTML && __TAG_EXISTS_META))
meta T_HTML_FAKED_IMS		(__ANY_IMS_MUA && __MIME_HTML && !(__TAG_EXISTS_BODY && __TAG_EXISTS_HEAD && __TAG_EXISTS_HTML && __TAG_EXISTS_META))
meta T_HTML_FAKED_AOL		(__ANY_AOL_MUA && __MIME_HTML && !__TAG_EXISTS_HTML)
meta T_HTML_FAKED_QUALCOMM	(__ANY_QUALCOMM_MUA && __MIME_HTML && !__TAG_EXISTS_HTML)

# MIME Content-Transfer-Encoding control rules
rawbody T_MIME_BASE64			eval:check_for_mime('t_mime_base64_count')
rawbody T_MIME_QP			eval:check_for_mime('t_mime_qp_count')

# 2003-03-06: quinlan
rawbody T_MIME_BASE64_BLANKS		eval:check_for_mime('t_mime_base64_blanks')
rawbody T_MIME_BASE64_ILLEGAL		eval:check_for_mime('t_mime_base64_illegal')
rawbody T_MIME_BASE64_SHORT_LINES	eval:check_for_mime('t_mime_base64_short_lines')
rawbody T_MIME_BASE64_WITHOUT_NAME	eval:check_for_mime('t_mime_base64_without_name')
rawbody T_MIME_QP_INLINE_NO_CHARSET	eval:check_for_mime('t_mime_qp_inline_no_charset')

# 2003-02-28: quinlan
# Note: I'll probably rename these later if they get added.
header T_MSG_ID_ADDED_BY_MTA_SHORT	eval:mta_added_message_id('short')
header T_MSG_ID_ADDED_BY_MTA_LATER	eval:mta_added_message_id('later')
header T_MSG_ID_ADDED_BY_MTA_BACKUP	eval:mta_added_message_id('backup')
tflags T_MSG_ID_ADDED_BY_MTA_BACKUP	net

# 2003-03-02: quinlan
header T_NO_DNS_FOR_RECIPS_ONE		eval:check_for_recips_dns('1','2')
header T_NO_DNS_FOR_RECIPS_TWO		eval:check_for_recips_dns('2','3')
header T_NO_DNS_FOR_RECIPS_MANY		eval:check_for_recips_dns('3','undef')
tflags T_NO_DNS_FOR_RECIPS_ONE		net
tflags T_NO_DNS_FOR_RECIPS_TWO		net
tflags T_NO_DNS_FOR_RECIPS_MANY		net

# bug 1416, possible replacement for AS_SEEN_ON
body     T_AS_SEEN_ON             /seen on\b\s*(?:T\.?V\.?|ABC|NBC|CBS|CNN|Oprah|USA Today|48 Hours|New York Times|\w+\s+T\.?V\.?|:)/i

# bug 1380
meta T_FAKED_OUTLOOK		(__OUTLOOK_MUA && __MIME_HTML_ONLY)
#describe FAKED_OUTLOOK		Outlook can't send HTML message only
#lang fr describe FAKED_OUTLOOK	Outlook ne sait pas envoyer de mail en HTML pur sans texte brut.
meta T_FAKED_AOL		(__AOL_MUA && __MIME_HTML_ONLY)
meta T_FAKED_THEBAT		(__THEBAT_MUA && __MIME_HTML_ONLY)
meta T_FAKED_IMS		(__IMS_MUA && __MIME_HTML_ONLY)

# quinlan: 2003-03-02, last updated 2003-03-25
# I'm sorry there are so many, this test seems effective enough to merit
# massive tweaking and exploration.  :-)
# double REMOVE tests
body T_REMOVE_REMOVAL_12	/remov(?:e|al).{0,12}remov(?:e|al)/i
body T_REMOVE_REMOVAL_16	/remov(?:e|al).{0,16}remov(?:e|al)/i
body T_REMOVE_REMOVAL_20	/remov(?:e|al).{0,20}remov(?:e|al)/i
body T_REMOVE_REMOVAL_24	/remov(?:e|al).{0,24}remov(?:e|al)/i
body T_REMOVE_REMOVAL_28	/remov(?:e|al).{0,28}remov(?:e|al)/i
body T_REMOVE_REMOVAL_32	/remov(?:e|al).{0,32}remov(?:e|al)/i
# bleh
rawbody T_REMOVE_REMOVAL_12_R	/remov(?:e|al).{0,12}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_16_R	/remov(?:e|al).{0,16}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_20_R	/remov(?:e|al).{0,20}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_24_R	/remov(?:e|al).{0,24}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_28_R	/remov(?:e|al).{0,28}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_32_R	/remov(?:e|al).{0,32}remov(?:e|al)/i
# one space
body T_REMOVE_REMOVAL_12_S	/remov(?:e|al)\S{0,6}\s*\S{0,6}remov(?:e|al)/i
body T_REMOVE_REMOVAL_16_S	/remov(?:e|al)\S{0,8}\s*\S{0,8}remov(?:e|al)/i
body T_REMOVE_REMOVAL_20_S	/remov(?:e|al)\S{0,10}\s*\S{0,10}remov(?:e|al)/i
body T_REMOVE_REMOVAL_24_S	/remov(?:e|al)\S{0,12}\s*\S{0,12}remov(?:e|al)/i
body T_REMOVE_REMOVAL_28_S	/remov(?:e|al)\S{0,14}\s*\S{0,14}remov(?:e|al)/i
body T_REMOVE_REMOVAL_32_S	/remov(?:e|al)\S{0,16}\s*\S{0,16}remov(?:e|al)/i
body T_REMOVE_REMOVAL_36_S	/remov(?:e|al)\S{0,18}\s*\S{0,18}remov(?:e|al)/i
body T_REMOVE_REMOVAL_40_S	/remov(?:e|al)\S{0,20}\s*\S{0,20}remov(?:e|al)/i
body T_REMOVE_REMOVAL_44_S	/remov(?:e|al)\S{0,22}\s*\S{0,22}remov(?:e|al)/i
body T_REMOVE_REMOVAL_48_S	/remov(?:e|al)\S{0,24}\s*\S{0,24}remov(?:e|al)/i
body T_REMOVE_REMOVAL_52_S	/remov(?:e|al)\S{0,26}\s*\S{0,26}remov(?:e|al)/i
body T_REMOVE_REMOVAL_56_S	/remov(?:e|al)\S{0,28}\s*\S{0,28}remov(?:e|al)/i
body T_REMOVE_REMOVAL_60_S	/remov(?:e|al)\S{0,30}\s*\S{0,30}remov(?:e|al)/i
body T_REMOVE_REMOVAL_64_S	/remov(?:e|al)\S{0,32}\s*\S{0,32}remov(?:e|al)/i
# one space
rawbody T_REMOVE_REMOVAL_12_RS	/remov(?:e|al)\S{0,6}\s*\S{0,6}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_16_RS	/remov(?:e|al)\S{0,8}\s*\S{0,8}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_20_RS	/remov(?:e|al)\S{0,10}\s*\S{0,10}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_24_RS	/remov(?:e|al)\S{0,12}\s*\S{0,12}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_28_RS	/remov(?:e|al)\S{0,14}\s*\S{0,14}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_32_RS	/remov(?:e|al)\S{0,16}\s*\S{0,16}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_36_RS	/remov(?:e|al)\S{0,18}\s*\S{0,18}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_40_RS	/remov(?:e|al)\S{0,20}\s*\S{0,20}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_44_RS	/remov(?:e|al)\S{0,22}\s*\S{0,22}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_48_RS	/remov(?:e|al)\S{0,24}\s*\S{0,24}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_52_RS	/remov(?:e|al)\S{0,26}\s*\S{0,26}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_56_RS	/remov(?:e|al)\S{0,28}\s*\S{0,28}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_60_RS	/remov(?:e|al)\S{0,30}\s*\S{0,30}remov(?:e|al)/i
rawbody T_REMOVE_REMOVAL_64_RS	/remov(?:e|al)\S{0,32}\s*\S{0,32}remov(?:e|al)/i
# no space
body T_REMOVE_REMOVAL_12_NS	/remov(?:e|al)\S{0,12}remov(?:e|al)/i
body T_REMOVE_REMOVAL_16_NS	/remov(?:e|al)\S{0,16}remov(?:e|al)/i
body T_REMOVE_REMOVAL_20_NS	/remov(?:e|al)\S{0,20}remov(?:e|al)/i
body T_REMOVE_REMOVAL_24_NS	/remov(?:e|al)\S{0,24}remov(?:e|al)/i
body T_REMOVE_REMOVAL_28_NS	/remov(?:e|al)\S{0,28}remov(?:e|al)/i
body T_REMOVE_REMOVAL_32_NS	/remov(?:e|al)\S{0,32}remov(?:e|al)/i
body T_REMOVE_REMOVAL_36_NS	/remov(?:e|al)\S{0,36}remov(?:e|al)/i
body T_REMOVE_REMOVAL_40_NS	/remov(?:e|al)\S{0,40}remov(?:e|al)/i
body T_REMOVE_REMOVAL_44_NS	/remov(?:e|al)\S{0,44}remov(?:e|al)/i
body T_REMOVE_REMOVAL_48_NS	/remov(?:e|al)\S{0,48}remov(?:e|al)/i
body T_REMOVE_REMOVAL_52_NS	/remov(?:e|al)\S{0,52}remov(?:e|al)/i
body T_REMOVE_REMOVAL_56_NS	/remov(?:e|al)\S{0,56}remov(?:e|al)/i
body T_REMOVE_REMOVAL_60_NS	/remov(?:e|al)\S{0,60}remov(?:e|al)/i
body T_REMOVE_REMOVAL_64_NS	/remov(?:e|al)\S{0,64}remov(?:e|al)/i
# remov versions
body T_REMOV_REMOV_12		/remov.{0,12}remov/i
body T_REMOV_REMOV_16		/remov.{0,16}remov/i
body T_REMOV_REMOV_20		/remov.{0,20}remov/i
body T_REMOV_REMOV_24		/remov.{0,24}remov/i
body T_REMOV_REMOV_28		/remov.{0,28}remov/i
body T_REMOV_REMOV_32		/remov.{0,32}remov/i
# bleh
rawbody T_REMOV_REMOV_12_R	/remov.{0,12}remov/i
rawbody T_REMOV_REMOV_16_R	/remov.{0,16}remov/i
rawbody T_REMOV_REMOV_20_R	/remov.{0,20}remov/i
rawbody T_REMOV_REMOV_24_R	/remov.{0,24}remov/i
rawbody T_REMOV_REMOV_28_R	/remov.{0,28}remov/i
rawbody T_REMOV_REMOV_32_R	/remov.{0,32}remov/i
# one space
body T_REMOV_REMOV_12_S		/remov\S{0,6}\s*\S{0,6}remov/i
body T_REMOV_REMOV_16_S		/remov\S{0,8}\s*\S{0,8}remov/i
body T_REMOV_REMOV_20_S		/remov\S{0,10}\s*\S{0,10}remov/i
body T_REMOV_REMOV_24_S		/remov\S{0,12}\s*\S{0,12}remov/i
body T_REMOV_REMOV_28_S		/remov\S{0,14}\s*\S{0,14}remov/i
body T_REMOV_REMOV_32_S		/remov\S{0,16}\s*\S{0,16}remov/i
body T_REMOV_REMOV_36_S		/remov\S{0,18}\s*\S{0,18}remov/i
body T_REMOV_REMOV_40_S		/remov\S{0,20}\s*\S{0,20}remov/i
body T_REMOV_REMOV_44_S		/remov\S{0,22}\s*\S{0,22}remov/i
body T_REMOV_REMOV_48_S		/remov\S{0,24}\s*\S{0,24}remov/i
body T_REMOV_REMOV_52_S		/remov\S{0,26}\s*\S{0,26}remov/i
body T_REMOV_REMOV_56_S		/remov\S{0,28}\s*\S{0,28}remov/i
body T_REMOV_REMOV_60_S		/remov\S{0,30}\s*\S{0,30}remov/i
body T_REMOV_REMOV_64_S		/remov\S{0,32}\s*\S{0,32}remov/i
# one space
rawbody T_REMOV_REMOV_12_RS	/remov\S{0,6}\s*\S{0,6}remov/i
rawbody T_REMOV_REMOV_16_RS	/remov\S{0,8}\s*\S{0,8}remov/i
rawbody T_REMOV_REMOV_20_RS	/remov\S{0,10}\s*\S{0,10}remov/i
rawbody T_REMOV_REMOV_24_RS	/remov\S{0,12}\s*\S{0,12}remov/i
rawbody T_REMOV_REMOV_28_RS	/remov\S{0,14}\s*\S{0,14}remov/i
rawbody T_REMOV_REMOV_32_RS	/remov\S{0,16}\s*\S{0,16}remov/i
rawbody T_REMOV_REMOV_36_RS	/remov\S{0,18}\s*\S{0,18}remov/i
rawbody T_REMOV_REMOV_40_RS	/remov\S{0,20}\s*\S{0,20}remov/i
rawbody T_REMOV_REMOV_44_RS	/remov\S{0,22}\s*\S{0,22}remov/i
rawbody T_REMOV_REMOV_48_RS	/remov\S{0,24}\s*\S{0,24}remov/i
rawbody T_REMOV_REMOV_52_RS	/remov\S{0,26}\s*\S{0,26}remov/i
rawbody T_REMOV_REMOV_56_RS	/remov\S{0,28}\s*\S{0,28}remov/i
rawbody T_REMOV_REMOV_60_RS	/remov\S{0,30}\s*\S{0,30}remov/i
rawbody T_REMOV_REMOV_64_RS	/remov\S{0,32}\s*\S{0,32}remov/i
# no space
body T_REMOV_REMOV_12_NS	/remov\S{0,12}remov/i
body T_REMOV_REMOV_16_NS	/remov\S{0,16}remov/i
body T_REMOV_REMOV_20_NS	/remov\S{0,20}remov/i
body T_REMOV_REMOV_24_NS	/remov\S{0,24}remov/i
body T_REMOV_REMOV_28_NS	/remov\S{0,28}remov/i
body T_REMOV_REMOV_32_NS	/remov\S{0,32}remov/i
body T_REMOV_REMOV_36_NS	/remov\S{0,36}remov/i
body T_REMOV_REMOV_40_NS	/remov\S{0,40}remov/i
body T_REMOV_REMOV_44_NS	/remov\S{0,44}remov/i
body T_REMOV_REMOV_48_NS	/remov\S{0,48}remov/i
body T_REMOV_REMOV_52_NS	/remov\S{0,52}remov/i
body T_REMOV_REMOV_56_NS	/remov\S{0,56}remov/i
body T_REMOV_REMOV_60_NS	/remov\S{0,60}remov/i
body T_REMOV_REMOV_64_NS	/remov\S{0,64}remov/i

# 2003-03-04: quinlan (my final attempt at this idea)
# bug 821: test for "good" RFC2369 headers (was: reverse SUSPECT_LIST_HEADERS)
#
# good genomes             non-good genomes
#    S/O HAM-SPAM HUSPOA      S/O HAM-SPAM HUSPOA
# ------ -------- ------   ------ -------- ------
#   0.00       40 111100    19.12       84 010000
#   0.00       71 111110    44.18     2132 000000
#   0.00       96 011011   100.00       -1 011010
#   1.21     1372 111101   100.00       -4 111000
# (Note: above S/O ratios are not adjusted to be a 50/50 mix)
#
# quinlan results:
# OVERALL%   SPAM%     HAM%     S/O    RANK   SCORE  NAME
#   20076     8138    11938    0.405   0.00    0.00  (all messages)
# 100.000  40.5360  59.4640    0.405   0.00    0.00  (all messages as %)
#   8.029   0.2089  13.3607    0.015   0.90   -0.01  T_GOOD_LIST_HEADERS
header	__LIST_HELP		exists:List-Help
header	__LIST_UNSUBSCRIBE	exists:List-Unsubscribe
header	__LIST_SUBSCRIBE	exists:List-Subscribe
header	__LIST_POST		exists:List-Post
header	__LIST_OWNER		exists:List-Owner
header	__LIST_ARCHIVE		exists:List-Archive
meta T_GOOD_LIST_HEADERS	(__LIST_UNSUBSCRIBE && __LIST_SUBSCRIBE && ((__LIST_HELP && __LIST_POST && !(__LIST_OWNER && __LIST_ARCHIVE)) || (!__LIST_HELP && !__LIST_POST && __LIST_OWNER && __LIST_ARCHIVE)))
tflags T_GOOD_LIST_HEADERS	nice

# more ratware
header T_RATWARE_POWERMTA	Received =~ /PowerMTA\(TM\)/
describe T_RATWARE_POWERMTA	Bulk email software fingerprint (PowerMTA) found in headers
# seems to be ratware
header T_RCVD_AM_PM		Received =~ /; [A-Z][a-z][a-z], \d{1,2} \d{4} \d{1,2}:\d\d:\d\d [AP]M [+-]\d{4}/
# stormpost signature
uri T_RATWARE_STORMPOST_URI		m{http://\S+/sp/t\.pl\?id=\d+:\d+}i

# quinlan: 2003-03-10, updated 2003-03-22
# reply to a numbered address
header T_ID_REPLY_TO_REPLY	Reply-To:addr =~ /reply.*\d{4}.*\@/i
# unsubscribe from a numbered address
header T_ID_X_LIST_UNSUBSCRIBE	X-List-Unsubscribe:addr =~ /\d{3}.*\d{3}.*\@/
header __ID_REPLY_TO		Reply-To:addr =~ /\d{3}.*\d{3}.*\@/
header __ID_RETURN_PATH		Return-path:addr =~ /\d{3}.*\d{3}.*\@/
meta T_ID_UNIQUE		(T_ID_X_LIST_UNSUBSCRIBE && __ID_RETURN_PATH && __ID_REPLY_TO)

# Send-Safe ratware (from Alan Curry)
# random alphanumerics, separated into groups of 16 by dashes (the first
# and last group may be shorter), with a lowercase "l" and a number
# appended. The final number is the length of the whole string not
# including the dashes or the "l<number>".  Why? I have no idea.  It's
# not a tracking code - the spamware does not save it locally.
# http://groups.google.com/groups?selm=atp1ip0n22%40enews3.newsguy.com
rawbody T_RATWARE_HASH_DASH	/[a-z\d]+-([a-z\d]{16}-)+[a-z\d]+(?-i:l)\d+/i

# quinlan: 2003-03-15
# these all appear in the same low-scoring spammer for me, but they
# might differ for others so I'm trying some different URLs, check
# overlap in others' results before committing anything
header T_EXECUTIVECALIBER		ALL =~ /\bexecutivecaliber\.ws\b/i
header T_CONSTANTCONTACT		ALL =~ /\bconstantcontact\.com\b/i
header T_ROVING_COM			ALL =~ /\broving\.com\b/i
uri T_EXECUTIVECALIBER_URL		/\bexecutivecaliber\.ws\b/i
uri T_CONSTANTCONTACT_URL		/\bconstantcontact\.com\b/i
uri T_CCPROD_ROVING_COM_URL		/\bccprod\.roving\.com\b/i
uri T_ROVING_COM_URL			/\broving\.com\b/i
uri T_RS6_NET_URL			/\brs6\.net\b/i

# bug 1438, possible replacement for the current HOTMAIL_FOOTER* rules
# rename current HOTMAIL_FOOTER# to __HOTMAIL_FOOTER#, and change these too.
meta T_ABUSED_HOTMAIL_FOOTER	HOTMAIL_FOOTER1 + HOTMAIL_FOOTER2 + HOTMAIL_FOOTER3 + HOTMAIL_FOOTER4 + HOTMAIL_FOOTER5 > 1
meta T_HOTMAIL_FOOTER1		HOTMAIL_FOOTER1 && !T_ABUSED_HOTMAIL_FOOTER
meta T_HOTMAIL_FOOTER2		HOTMAIL_FOOTER2 && !T_ABUSED_HOTMAIL_FOOTER
meta T_HOTMAIL_FOOTER3		HOTMAIL_FOOTER3 && !T_ABUSED_HOTMAIL_FOOTER
meta T_HOTMAIL_FOOTER4		HOTMAIL_FOOTER4 && !T_ABUSED_HOTMAIL_FOOTER
meta T_HOTMAIL_FOOTER5		HOTMAIL_FOOTER5 && !T_ABUSED_HOTMAIL_FOOTER

# bug 1406, possible replacement for URI_IS_POUND
uri T_URI_IS_POUND		/^\#$/
uri T_URI_ENDS_IN_POUND		/^[^?]+\#$/

# bug 1336
header T_TO_FILENAME           To =~ /^<C:\\/
#describe TO_FILENAME         "To" header contains a filename

# bug 1394, possible replacement for ORDER_NOW
body T_ORDER_NOW                  /\border (?:now|soon|fast|quickly|while|today)\b/i

# Matt Cline
# 0.206   0.2631   0.0000    1.000   0.89    0.01  T_OBFUSCATING_COMMENT2
rawbody  __OBFUSCATING_COMMENT2 /[^\s>]<![^-].{0,64}?[^-]>[^\s<]/
meta     T_OBFUSCATING_COMMENT2 __OBFUSCATING_COMMENT2 && MIME_HTML_ONLY
describe T_OBFUSCATING_COMMENT2 HTML comments which obfuscate text (2)

# Matt Cline
uri      T_HTTP_ENTITIES_HOST m{https?://[^\s\">/]*\&\#[\da-f]+}i
describe T_HTTP_ENTITIES_HOST URI obscured with character entities

uri      T_HTTP_EXCESSIVE_ENTITIES m{^https?://\S*\&\#(?:0?3[0-9]|0?[46][1-9a-f]|0?[57][\da])}i
describe T_HTTP_EXCESSIVE_ENTITIES Completely unnecessary %-escapes inside a URL

body T_HTML_COMMENT_BLANK	eval:html_test('comment_blank')
body T_HTML_COMMENT_NO_ALPHANUM	eval:html_test('comment_no_alphanum')

# RFC2822 violations
header T_HEADER_COUNT_BAD_DATE		eval:check_header_count_range('Date','2','999')
header T_HEADER_COUNT_BAD_FROM		eval:check_header_count_range('From','2','999')
header T_HEADER_COUNT_BAD_SENDER	eval:check_header_count_range('Sender','2','999')
header T_HEADER_COUNT_BAD_REPLYTO	eval:check_header_count_range('Reply-To','2','999')
header T_HEADER_COUNT_BAD_MESSAGEID	eval:check_header_count_range('Message-Id','2','999')
header T_HEADER_COUNT_BAD_INREPLYTO	eval:check_header_count_range('In-Reply-To','2','999')
header T_HEADER_COUNT_BAD_REFERENCES	eval:check_header_count_range('References','2','999')
header T_HEADER_COUNT_BAD_SUBJECT	eval:check_header_count_range('Subject','2','999')
# multiple To/Cc/Bcc headers are obsolete in RFC 2822, but they are still
# frequently used and RFC 2822 says they should still be supported.  Cc:
# generates many false positives.
header T_HEADER_COUNT_BAD_TO		eval:check_header_count_range('To','2','999')
header T_HEADER_COUNT_BAD_CC		eval:check_header_count_range('Cc','2','999')
header T_HEADER_COUNT_BAD_BCC		eval:check_header_count_range('Bcc','2','999')
# There doesn't seem to be a RFC restriction, but these should only show up
# once in ham
header T_HEADER_COUNT_BAD_CTYPE		eval:check_header_count_range('Content-Type','2','999')
header T_HEADER_COUNT_BAD_CTE		eval:check_header_count_range('Content-Transfer-Encoding','2','999')

body T_BLANK_LINE_RATIO_01_00_02	eval:check_blank_line_ratio('0','2')
body T_BLANK_LINE_RATIO_01_02_04	eval:check_blank_line_ratio('2','4')
body T_BLANK_LINE_RATIO_01_04_06	eval:check_blank_line_ratio('4','6')
body T_BLANK_LINE_RATIO_01_06_08	eval:check_blank_line_ratio('6','8')
body T_BLANK_LINE_RATIO_01_08_10	eval:check_blank_line_ratio('8','10')
body T_BLANK_LINE_RATIO_01_10_20	eval:check_blank_line_ratio('10','20')
body T_BLANK_LINE_RATIO_01_20_30	eval:check_blank_line_ratio('20','30')
body T_BLANK_LINE_RATIO_01_30_40	eval:check_blank_line_ratio('30','40')
body T_BLANK_LINE_RATIO_01_40_50	eval:check_blank_line_ratio('40','50')
body T_BLANK_LINE_RATIO_01_50_60	eval:check_blank_line_ratio('50','60')
body T_BLANK_LINE_RATIO_01_60_70	eval:check_blank_line_ratio('60','70')
body T_BLANK_LINE_RATIO_01_70_80	eval:check_blank_line_ratio('70','80')
body T_BLANK_LINE_RATIO_01_80_90	eval:check_blank_line_ratio('80','90')
body T_BLANK_LINE_RATIO_01_90_92	eval:check_blank_line_ratio('90','92')
body T_BLANK_LINE_RATIO_01_92_94	eval:check_blank_line_ratio('92','94')
body T_BLANK_LINE_RATIO_01_94_96	eval:check_blank_line_ratio('94','96')
body T_BLANK_LINE_RATIO_01_96_98	eval:check_blank_line_ratio('96','98')
body T_BLANK_LINE_RATIO_01_98_100	eval:check_blank_line_ratio('98','100')

body T_BLANK_LINE_RATIO_04_00_02	eval:check_blank_line_ratio('0','2','4')
body T_BLANK_LINE_RATIO_04_02_04	eval:check_blank_line_ratio('2','4','4')
body T_BLANK_LINE_RATIO_04_04_06	eval:check_blank_line_ratio('4','6','4')
body T_BLANK_LINE_RATIO_04_06_08	eval:check_blank_line_ratio('6','8','4')
body T_BLANK_LINE_RATIO_04_08_10	eval:check_blank_line_ratio('8','10','4')
body T_BLANK_LINE_RATIO_04_10_20	eval:check_blank_line_ratio('10','20','4')
body T_BLANK_LINE_RATIO_04_20_30	eval:check_blank_line_ratio('20','30','4')
body T_BLANK_LINE_RATIO_04_30_40	eval:check_blank_line_ratio('30','40','4')
body T_BLANK_LINE_RATIO_04_40_50	eval:check_blank_line_ratio('40','50','4')
body T_BLANK_LINE_RATIO_04_50_60	eval:check_blank_line_ratio('50','60','4')
body T_BLANK_LINE_RATIO_04_60_70	eval:check_blank_line_ratio('60','70','4')
body T_BLANK_LINE_RATIO_04_70_80	eval:check_blank_line_ratio('70','80','4')
body T_BLANK_LINE_RATIO_04_80_90	eval:check_blank_line_ratio('80','90','4')
body T_BLANK_LINE_RATIO_04_90_92	eval:check_blank_line_ratio('90','92','4')
body T_BLANK_LINE_RATIO_04_92_94	eval:check_blank_line_ratio('92','94','4')
body T_BLANK_LINE_RATIO_04_94_96	eval:check_blank_line_ratio('94','96','4')
body T_BLANK_LINE_RATIO_04_96_98	eval:check_blank_line_ratio('96','98','4')
body T_BLANK_LINE_RATIO_04_98_100	eval:check_blank_line_ratio('98','100','4')

body T_BLANK_LINE_RATIO_08_00_02	eval:check_blank_line_ratio('0','2','8')
body T_BLANK_LINE_RATIO_08_02_04	eval:check_blank_line_ratio('2','4','8')
body T_BLANK_LINE_RATIO_08_04_06	eval:check_blank_line_ratio('4','6','8')
body T_BLANK_LINE_RATIO_08_06_08	eval:check_blank_line_ratio('6','8','8')
body T_BLANK_LINE_RATIO_08_08_10	eval:check_blank_line_ratio('8','10','8')
body T_BLANK_LINE_RATIO_08_10_20	eval:check_blank_line_ratio('10','20','8')
body T_BLANK_LINE_RATIO_08_20_30	eval:check_blank_line_ratio('20','30','8')
body T_BLANK_LINE_RATIO_08_30_40	eval:check_blank_line_ratio('30','40','8')
body T_BLANK_LINE_RATIO_08_40_50	eval:check_blank_line_ratio('40','50','8')
body T_BLANK_LINE_RATIO_08_50_60	eval:check_blank_line_ratio('50','60','8')
body T_BLANK_LINE_RATIO_08_60_70	eval:check_blank_line_ratio('60','70','8')
body T_BLANK_LINE_RATIO_08_70_80	eval:check_blank_line_ratio('70','80','8')
body T_BLANK_LINE_RATIO_08_80_90	eval:check_blank_line_ratio('80','90','8')
body T_BLANK_LINE_RATIO_08_90_92	eval:check_blank_line_ratio('90','92','8')
body T_BLANK_LINE_RATIO_08_92_94	eval:check_blank_line_ratio('92','94','8')
body T_BLANK_LINE_RATIO_08_94_96	eval:check_blank_line_ratio('94','96','8')
body T_BLANK_LINE_RATIO_08_96_98	eval:check_blank_line_ratio('96','98','8')
body T_BLANK_LINE_RATIO_08_98_100	eval:check_blank_line_ratio('98','100','8')

body T_BLANK_LINE_RATIO_20_00_02	eval:check_blank_line_ratio('0','2','20')
body T_BLANK_LINE_RATIO_20_02_04	eval:check_blank_line_ratio('2','4','20')
body T_BLANK_LINE_RATIO_20_04_06	eval:check_blank_line_ratio('4','6','20')
body T_BLANK_LINE_RATIO_20_06_08	eval:check_blank_line_ratio('6','8','20')
body T_BLANK_LINE_RATIO_20_08_10	eval:check_blank_line_ratio('8','10','20')
body T_BLANK_LINE_RATIO_20_10_20	eval:check_blank_line_ratio('10','20','20')
body T_BLANK_LINE_RATIO_20_20_30	eval:check_blank_line_ratio('20','30','20')
body T_BLANK_LINE_RATIO_20_30_40	eval:check_blank_line_ratio('30','40','20')
body T_BLANK_LINE_RATIO_20_40_50	eval:check_blank_line_ratio('40','50','20')
body T_BLANK_LINE_RATIO_20_50_60	eval:check_blank_line_ratio('50','60','20')
body T_BLANK_LINE_RATIO_20_60_70	eval:check_blank_line_ratio('60','70','20')
body T_BLANK_LINE_RATIO_20_70_80	eval:check_blank_line_ratio('70','80','20')
body T_BLANK_LINE_RATIO_20_80_90	eval:check_blank_line_ratio('80','90','20')
body T_BLANK_LINE_RATIO_20_90_92	eval:check_blank_line_ratio('90','92','20')
body T_BLANK_LINE_RATIO_20_92_94	eval:check_blank_line_ratio('92','94','20')
body T_BLANK_LINE_RATIO_20_94_96	eval:check_blank_line_ratio('94','96','20')
body T_BLANK_LINE_RATIO_20_96_98	eval:check_blank_line_ratio('96','98','20')
body T_BLANK_LINE_RATIO_20_98_100	eval:check_blank_line_ratio('98','100','20')

###########################################################################

# tvd - 2003.02.26, trying to strengthen the anti-ratware rules

meta T_FORGED_USER_AGENT	( __USER_AGENT_PINE + __T_USER_AGENT_MUTT + __T_USER_AGENT_MOZILLA_UA + __T_USER_AGENT_MOZILLA_XM + __T_USER_AGENT_MACOE + __T_USER_AGENT_ENTOURAGE + __T_USER_AGENT_KMAIL + __T_USER_AGENT_IMP + __USER_AGENT_TONLINE + __USER_AGENT_APPLEMAIL + __USER_AGENT_GNUS_UA + __USER_AGENT_GNUS_XM + __USER_AGENT_VM + __T_USER_AGENT_MSN + __T_USER_AGENT_FORTE + __USER_AGENT_XIMIAN > 1 )

meta T_USER_AGENT                        ( __USER_AGENT && !T_FORGED_USER_AGENT && !__USER_AGENT_PINE && !__T_USER_AGENT_MUTT && !__T_USER_AGENT_MOZILLA_UA && !__T_USER_AGENT_MOZILLA_XM && !__T_USER_AGENT_MACOE && !__T_USER_AGENT_ENTOURAGE && !__T_USER_AGENT_KMAIL && !__T_USER_AGENT_IMP && !__USER_AGENT_TONLINE && !__USER_AGENT_APPLEMAIL && !__USER_AGENT_GNUS_UA && !__USER_AGENT_GNUS_XM && !__USER_AGENT_VM && !__T_USER_AGENT_MSN && !__T_USER_AGENT_FORTE && !__USER_AGENT_XIMIAN )

header __MSGID_PINE	Message-Id =~ /^<Pine\.[A-Z]{3}\.\d\.[0-9A-Z]+\./
meta __USER_AGENT_PINE	__MSGID_PINE && !MIME_HTML_ONLY
meta T_USER_AGENT_PINE		__USER_AGENT_PINE && !T_FORGED_USER_AGENT
meta T_FORGED_MUA_PINE	__MSGID_PINE && !__USER_AGENT_PINE

# From 0.93.2 - 1.2.5.1, message-id is:
#  snprintf (buf, sizeof (buf), "<%d%02d%02d%02d%02d%02d.%c%d@%s>",
#            tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday, tm->tm_hour,
#            tm->tm_min, tm->tm_sec, MsgIdPfx, getpid (), fqdn);
#  MsgIdPfx = (MsgIdPfx == 'Z') ? 'A' : MsgIdPfx + 1;
# The code from mutt 1.4 is adds a 'G' for some reason:
#  snprintf (buf, sizeof (buf), "<%d%02d%02d%02d%02d%02d.G%c%d@%s>",
meta __T_USER_AGENT_MUTT	__USER_AGENT_MUTT && __VALID_MUTT_MSGID && !MIME_HTML_ONLY
meta T_USER_AGENT_MUTT		__T_USER_AGENT_MUTT && !T_FORGED_USER_AGENT
meta T_FORGED_MUA_MUTT		__USER_AGENT_MUTT && !__UNUSABLE_MSGID && !__T_USER_AGENT_MUTT

header __USER_AGENT_MOZILLA_UA	User-Agent =~ /^Mozilla\/5\.\d+ \(.*\) Gecko\/\d{8}(?: |$)/
header __MSGID_MOZILLA_UA	Message-Id =~ /^<[0-9A-F]{8}\.\d+\@\S+>$/
meta __T_USER_AGENT_MOZILLA_UA	__USER_AGENT_MOZILLA_UA && __MSGID_MOZILLA_UA
meta T_USER_AGENT_MOZILLA_UA	__T_USER_AGENT_MOZILLA_UA && !T_FORGED_USER_AGENT

header __USER_AGENT_MOZILLA_XM	X-Mailer   =~ /^Mozilla 4\.\d{2} \[[a-z]{2}\]/
header __MSGID_MOZILLA_XM	Message-Id =~ /^<[0-9A-F]{8}\.[0-9A-F]{8}\@\S+>$/
meta __T_USER_AGENT_MOZILLA_XM	__USER_AGENT_MOZILLA_XM && __MSGID_MOZILLA_XM
meta T_USER_AGENT_MOZILLA_XM	__T_USER_AGENT_MOZILLA_XM && !T_FORGED_USER_AGENT

header __USER_AGENT_MACOE	User-Agent =~ /^Microsoft[ -]Outlook[ -]Express[ -]Macintosh[ -]Edition/
meta __T_USER_AGENT_MACOE	__USER_AGENT_MACOE && __MSGID_ENTOURAGE
meta T_USER_AGENT_MACOE		__T_USER_AGENT_MACOE && !T_FORGED_USER_AGENT

header __USER_AGENT_ENTOURAGE	User-Agent =~ /^Microsoft-Entourage\/\d{1,2}(?:\.\d){1,2}\.\d{4}$/
header __MSGID_ENTOURAGE	Message-ID =~ /^<[0-9A-F]{8}\.[0-9A-F]+\%\S+\@\S+>$/
meta __T_USER_AGENT_ENTOURAGE	__USER_AGENT_ENTOURAGE && __MSGID_ENTOURAGE && !MIME_HTML_ONLY
meta T_USER_AGENT_ENTOURAGE	__T_USER_AGENT_ENTOURAGE && !T_FORGED_USER_AGENT

header __USER_AGENT_KMAIL	User-Agent =~ /^KMail\/1\.\d\.\d+$/
header __MSGID_KMAIL		Message-Id =~ /^<[12]\d{3}[01]\d[0-3]\d[0-2]\d[0-5]\d\.\d+\.\S+@\S+>$/
meta __T_USER_AGENT_KMAIL	__USER_AGENT_KMAIL && __MSGID_KMAIL
meta T_USER_AGENT_KMAIL		__T_USER_AGENT_KMAIL && !T_FORGED_USER_AGENT

header __USER_AGENT_IMP		User-Agent =~ /^Internet Messaging Program \(IMP\) [34]\.\d/
header __MSGID_IMP		Message-Id =~ /^<\d{9,10}\.[0-9a-f]{13}\@\S+>$/
meta __T_USER_AGENT_IMP		__USER_AGENT_IMP && __MSGID_IMP
meta T_USER_AGENT_IMP		__T_USER_AGENT_IMP && !T_FORGED_USER_AGENT
meta T_FORGED_MUA_IMP		__USER_AGENT_IMP && !__UNUSABLE_MSGID && !__T_USER_AGENT_IMP

header __USER_AGENT_TONLINE	X-Mailer   =~ /^T-Online (?:e|Web)Mail \d\.\d+$/
meta T_USER_AGENT_TONLINE	__USER_AGENT_TONLINE && !T_FORGED_USER_AGENT

header __USER_AGENT_GNUS_UA	User-Agent =~ /^Gnus\/\d\.\d+ /
meta T_USER_AGENT_GNUS_UA	__USER_AGENT_GNUS_UA && !T_FORGED_USER_AGENT

header __USER_AGENT_GNUS_XM	X-Mailer   =~ /^Gnus v\d(?:\.\d+){1,2}\/X?Emacs \d+\.\d+/
meta T_USER_AGENT_GNUS_XM	__USER_AGENT_GNUS_XM && !T_FORGED_USER_AGENT

header __USER_AGENT_VM		X-Mailer =~ /^\s*VM\s+\d+\.\d+\s+under\s+.{0,30}?[Ee]macs\b/
meta T_USER_AGENT_VM		__USER_AGENT_VM && !T_FORGED_USER_AGENT

# frequently forged, needs some correlation meta checks with other headers.
meta __T_USER_AGENT_MSN		(__USER_AGENT_MSN && __HAS_XOAT && __HAS_XOIP)
meta T_USER_AGENT_MSN		__T_USER_AGENT_MSN && !T_FORGED_USER_AGENT
meta T_FORGED_MUA_MSN		__USER_AGENT_MSN && !T_USER_AGENT_MSN

header __USER_AGENT_FORTE	X-Mailer =~ /^Forte Agent \d\.\d+\/\d+\.\d+$/
header __MSGID_FORTE		Message-Id =~ /^<[0-9a-f]{8}\.\d+\@\S+>$/
meta __T_USER_AGENT_FORTE	__USER_AGENT_FORTE && __MSGID_FORTE
meta T_USER_AGENT_FORTE		__T_USER_AGENT_FORTE && !T_FORGED_USER_AGENT

meta __USER_AGENT_XIMIAN	(__XIMIAN_MSGID && __XIMIAN_MUA)
meta T_USER_AGENT_XIMIAN	__USER_AGENT_XIMIAN && !T_FORGED_USER_AGENT
meta T_FORGED_MUA_XIMIAN	__XIMIAN_MUA && !__UNUSABLE_MSGID && !__USER_AGENT_XIMIAN

# duncf
body T_EMAIL_ROT13     /\b[a-z(\]-]+\^[a-z-]+\((?:pbz|arg|bet|pn)\b/
test T_EMAIL_ROT13 ok  qhabs^ebtref(pbz
test T_EMAIL_ROT13 ok  zxrggyre^riv-vap(pbz
test T_EMAIL_ROT13 fail	duncf@rogers.com

# bug 1561
# stronger version of USER_AGENT_APPLEMAIL
# Apple Mail doesn't send text/html at all (unless it's an attachment)
# It'll send text/plain, or multipart/alternative with text/plain and text/enriched parts (boundary of
# "Apple-Mail-\d--\d+").  It can, however, send a multipart/mixed with a single text/html attachment, so
# don't use MIME_HTML_ONLY.
# perhaps limit CTYPE to "text/plain", "multipart/alternative" with "text/plain" and "text/enhanced", or
# "multipart/mixed"?
header __X_MAILER_APPLEMAIL	X-Mailer	=~ /^Apple Mail \(\d\.\d+\)$/
header __MSGID_APPLEMAIL	Message-Id	=~ /^<[0-9A-F]{8}-(?:[0-9A-F]{4}-){3}[0-9A-F]{12}\@\S+>$/
header __MIME_VERSION_APPLEMAIL	Mime-Version	=~ /^1\.0 \(Apple Message framework v\d+\)$/
meta __USER_AGENT_APPLEMAIL	!__CTYPE_HTML && __X_MAILER_APPLEMAIL && ( __MSGID_APPLEMAIL || __MIME_VERSION_APPLEMAIL )
meta T_USER_AGENT_APPLEMAIL	__USER_AGENT_APPLEMAIL && !T_FORGED_USER_AGENT
meta T_FORGED_MUA_APPLEMAIL	__X_MAILER_APPLEMAIL && !__UNUSABLE_MSGID && !__USER_AGENT_APPLEMAIL

# per bug 1373
body __HTML_COMMENT_RATIO_00_10		eval:html_range('total_comment_ratio','0.00','0.10')
body __HTML_COMMENT_RATIO_10_20		eval:html_range('total_comment_ratio','0.10','0.20')
body __HTML_COMMENT_RATIO_20_30		eval:html_range('total_comment_ratio','0.20','0.30')
body __HTML_COMMENT_RATIO_30_40		eval:html_range('total_comment_ratio','0.30','0.40')
body __HTML_COMMENT_RATIO_40_50		eval:html_range('total_comment_ratio','0.40','0.50')
body __HTML_COMMENT_RATIO_50_60		eval:html_range('total_comment_ratio','0.50','0.60')
body __HTML_COMMENT_RATIO_60_70		eval:html_range('total_comment_ratio','0.60','0.70')
body __HTML_COMMENT_RATIO_70_80		eval:html_range('total_comment_ratio','0.70','0.80')
body __HTML_COMMENT_RATIO_80_90		eval:html_range('total_comment_ratio','0.80','0.90')
body __HTML_COMMENT_RATIO_90_100	eval:html_range('total_comment_ratio','0.90','0.100')
meta T_HTML_COMMENT_RATIO_00_10_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_00_10 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_10_20_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_10_20 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_20_30_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_20_30 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_30_40_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_30_40 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_40_50_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_40_50 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_50_60_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_50_60 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_60_70_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_60_70 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_70_80_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_70_80 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_80_90_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_80_90 && MIME_HTML_ONLY
meta T_HTML_COMMENT_RATIO_90_100_MIME_HTML_ONLY		__HTML_COMMENT_RATIO_90_100 && MIME_HTML_ONLY

meta T_HTML_COMMENT_RATIO_00_10___MIME_HTML		__HTML_COMMENT_RATIO_00_10 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_10_20___MIME_HTML		__HTML_COMMENT_RATIO_10_20 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_20_30___MIME_HTML		__HTML_COMMENT_RATIO_20_30 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_30_40___MIME_HTML		__HTML_COMMENT_RATIO_30_40 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_40_50___MIME_HTML		__HTML_COMMENT_RATIO_40_50 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_50_60___MIME_HTML		__HTML_COMMENT_RATIO_50_60 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_60_70___MIME_HTML		__HTML_COMMENT_RATIO_60_70 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_70_80___MIME_HTML		__HTML_COMMENT_RATIO_70_80 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_80_90___MIME_HTML		__HTML_COMMENT_RATIO_80_90 && __MIME_HTML
meta T_HTML_COMMENT_RATIO_90_100___MIME_HTML		__HTML_COMMENT_RATIO_90_100 && __MIME_HTML

meta T_HTML_COMMENT_RATIO_00_10_HTML_MESSAGE		__HTML_COMMENT_RATIO_00_10 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_10_20_HTML_MESSAGE		__HTML_COMMENT_RATIO_10_20 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_20_30_HTML_MESSAGE		__HTML_COMMENT_RATIO_20_30 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_30_40_HTML_MESSAGE		__HTML_COMMENT_RATIO_30_40 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_40_50_HTML_MESSAGE		__HTML_COMMENT_RATIO_40_50 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_50_60_HTML_MESSAGE		__HTML_COMMENT_RATIO_50_60 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_60_70_HTML_MESSAGE		__HTML_COMMENT_RATIO_60_70 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_70_80_HTML_MESSAGE		__HTML_COMMENT_RATIO_70_80 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_80_90_HTML_MESSAGE		__HTML_COMMENT_RATIO_80_90 && HTML_MESSAGE
meta T_HTML_COMMENT_RATIO_90_100_HTML_MESSAGE		__HTML_COMMENT_RATIO_90_100 && HTML_MESSAGE

# a new spamware tool; catch it
header T_FORGED_RCVD_FROM_NUM	Received =~ /from \S+ \(\d+ \[/
describe T_FORGED_RCVD_FROM_NUM	Received headers forged (numeric hostname)

header T_RATWARE_EMPTY_HELO	Received =~ /from  \(\) by /
describe T_RATWARE_EMPTY_HELO	Received headers forged (empty HELO)

header T_RATWARE_RCVD_BONUS_SPC	Received =~ /\) by  [a-zA-Z0-9]/
describe T_RATWARE_RCVD_BONUS_SPC Received headers forged (extra spaces)

# quinlan: How much better are these than MIME_HTML_ONLY?  I'm concerned
# it's a bit too easy to create high S/O rules with MIME_HTML_ONLY
meta T_MIME_HTML_NO_HTML_TAG	MIME_HTML_ONLY && !__TAG_EXISTS_HTML
meta T_MIME_HTML_NO_BODY_TAG	MIME_HTML_ONLY && !__TAG_EXISTS_BODY
# but we'll try this anyway
meta T_MIME_HTML_NO_MAJOR_TAG	MIME_HTML_ONLY && !__TAG_EXISTS_HTML && !__TAG_EXISTS_BODY

# I get these enough that I think a rule may be good for them. :)
#   0.722   1.2360   0.0000    1.000   1.00    0.01  T_URI_PXLG
uri T_URI_PXLG		m{http://(?:www\.)?pxlg\.com}i
describe T_URI_PXLG	URL references pxlg.com

# alan premselaar <alien@12inch.com>, see SpamAssassin-talk list
header T_SUBJ_JAPAN_SPAM	Subject =~ /L\$\>5Bz9\-9p\"\(/
describe T_SUBJ_JAPAN_SPAM	Subject: contains Japanese mandatory unsolicited mail tag
# quinlan: 2003-03-23 here are more generic Japanese iso-2022-jp codes
# ("not yet acceptance" or "email") + "announcement"
header T_JAPANESE_UCE_SUBJECT_0	Subject =~ /\e\$B.*(?:L\$>5Bz|EE;R%a!<%k)9-9p/
# "not yet acceptance announcement"
header T_JAPANESE_UCE_SUBJECT_1	Subject =~ /\e\$B.*L\$>5Bz9-9p/
# "email announcement"
header T_JAPANESE_UCE_SUBJECT_2	Subject =~ /\e\$B.*EE;R%a!<%k9-9p/

# quinlan: "advertisement" in Russian KOI8-R
header T_RUSSIAN_UCE_SUBJECT	Subject =~ /\xf0\xe5\xea\xeb\xe0\xec\xf3/

# 2003-02-23: quinlan
# Message-Id: format tests
# hotmail
header __FROM_HOTMAIL			From:addr =~ /\@hotmail\.com/
header T_MSGID_ADDED_BY_HOTMAIL_1	Message-Id =~ /<MC\d{1,2}-F{1,2}\w{21,22}\@\S*hotmail\.com>/
header T_MSGID_ADDED_BY_HOTMAIL_2	Message-Id =~ /<[A-Z]{2}\d{1,2}-F{1,2}\w{21,22}\@\S*hotmail\.com>/
header T_MSGID_ADDED_BY_HOTMAIL_3	Message-Id =~ /<[A-Z0-9]+\d{1,2}-F{1,2}\w{21,22}\@\S*hotmail\.com>/
meta T_MSGID_ADDED_BY_HOTMAIL_1B	(T_MSGID_ADDED_BY_HOTMAIL_1 && !__FROM_HOTMAIL)
meta T_MSGID_ADDED_BY_HOTMAIL_2B	(T_MSGID_ADDED_BY_HOTMAIL_2 && !__FROM_HOTMAIL)
meta T_MSGID_ADDED_BY_HOTMAIL_3B	(T_MSGID_ADDED_BY_HOTMAIL_3 && !__FROM_HOTMAIL)
# 13 hexadecimal digits instead of 12
header T_MSGID_OUTLOOK_HEX_1	Message-Id =~ /<[a-f0-9]{13}\$[a-f0-9]{8}\$[a-f0-9]{8}\@\S+>/
header T_MSGID_OUTLOOK_HEX_2	Message-Id =~ /<[a-f0-9]{13}\$[a-f0-9]{8}\$[a-f0-9]{8}\@/
# this one high correlation with ratware "EMWAC SMTPRS"
header T_MSGID_B_DIGITS		Message-Id =~ /<B\d{10}\@/
# speculative version of T_MSGID_B_DIGITS (don't use unless much better)
header T_MSGID_LETTER_DIGITS	Message-Id =~ /<[A-Z]\d{10}\@/
# speculative version of T_MSGID_B_DIGITS (don't use unless much better)
header T_MSGID_HEX_DIGITS	Message-Id =~ /<[A-F0-9]{11}\@/
# looks like spam
header T_MSGID_THREESIXSIX	Message-Id =~ /<\d{3}\.\d{6}\.\d{6}\@\S+>/

# via private mail with Mark Delany; thx Mark!
header T_FORGED_YAHOO_RCVD_SMTP    Received =~ /from smtp(?:\d{1,2}|\d{4,})\.mail(?:\.[^\.]+|)\.yahoo\.com /
describe T_FORGED_YAHOO_RCVD_SMTP  Received: contains forged Yahoo! SMTP server hostname

# http://www.ritlabs.com/the_bat/spammer.html notes: 'There are clues that make
# it obvious that the spam message didn't come from The Bat!. For one thing, it
# has an "X-MSMail-Priority: Normal" header. The Bat! doesn't use this.'
#
# quinlan: this doesn't seem to catch all FORGED_MUA_THEBAT mail, but is a
# good addition, so I renamed it.
#
meta T_RATWARE_NOT_THEBAT	(__THEBAT_MUA && __HAS_MSMAIL_PRI)
describe T_RATWARE_NOT_THEBAT	Forged mail pretending to be from The Bat!

# NOTE: uses __ANY_OUTLOOK_MUA.  This catches Send-Safe and a few others
header __OL_STYLE_FROM		From =~ /^\".*\" <\S+>$/
meta T_FORGED_MUA_OUTLOOK_FROM	(__ANY_OUTLOOK_MUA && !__OL_STYLE_FROM)
describe T_FORGED_MUA_OUTLOOK_FROM Forged mail pretending to be from Outlook (by From)

# let's see if this works... AOL MUAs add a Received line, and do not use
# "real names" in From or To headers, as far as I can see.
header __AOL8_MUA		X-Mailer =~ /AOL [78]\.\d for Windows/
header __AOL8_FROM		From =~ /^\S+\@aol\.com$/
header __AOL8_TO		To =~ /^\S+\@\S+\.\S+$/
header __AOL8_RCVD		Received =~ /^from \S+\@aol\.com by\s+imo-\S+\.mx\.aol\.com\s+\(mail_out_\S+\)\s+id\s+\S+\s+\(\d+\)\s+for\s+<\S+\@\S+>;\s+/m

meta T_FORGED_MUA_AOL_FROM	(__AOL8_MUA && !__AOL8_FROM)
describe T_FORGED_MUA_AOL_FROM	Forged mail pretending to be from AOL 8.0 (by From)
meta T_FORGED_MUA_AOL_TO	(__AOL8_MUA && !__AOL8_TO)
describe T_FORGED_MUA_AOL_TO	Forged mail pretending to be from AOL 8.0 (by To)
meta T_FORGED_MUA_AOL_RCVD	(__AOL8_MUA && !__AOL8_RCVD)
describe T_FORGED_MUA_AOL_RCVD	Forged mail pretending to be from AOL 8.0 (by Received)

meta T_USER_AGENT_AOL8		(__AOL8_MUA && __AOL8_FROM && __AOL8_RCVD && __AOL8_TO)
describe T_USER_AGENT_AOL8	User-Agent header indicates a non-spam MUA (AOL 8)
tflags T_USER_AGENT_AOL8	nice

# From private mail with developers.  Some top tips here!
header __BAT_MSGID		MESSAGEID =~ /^<\d{2,12}\.\d{14}\@\S+>$/
header __CTYPE_IS_FOLDED	Content-Type =~ /\n/
header __CTYPE_CHARSET_QUOTED	Content-Type =~ /charset=\"/i
header __CTYPE_HAS_BOUNDARY	Content-Type =~ /boundary/i
header __BAT_BOUNDARY		Content-Type =~ /boundary=\"?-{10}/
meta T_FORGED_BAT_MSGID		(__THEBAT_MUA && !__UNUSABLE_MSGID && !__BAT_MSGID)
meta T_FORGED_BAT_CTYPE_NL	(__THEBAT_MUA && __CTYPE_IS_FOLDED)
meta T_FORGED_BAT_CHARSET	(__THEBAT_MUA && __CTYPE_CHARSET_QUOTED)
meta T_FORGED_BAT_BOUNDARY	(__THEBAT_MUA && __CTYPE_HAS_BOUNDARY && !__BAT_BOUNDARY)
describe T_FORGED_BAT_MSGID	Forged mail pretending to be from The Bat! (1)
describe T_FORGED_BAT_CTYPE_NL	Forged mail pretending to be from The Bat! (2)
describe T_FORGED_BAT_CHARSET	Forged mail pretending to be from The Bat! (3)
describe T_FORGED_BAT_BOUNDARY	Forged mail pretending to be from The Bat! (4)

# NOTE: uses __ANY_IMS_MUA from above
header __IMS_BOUNDARY		Content-Type =~ /\n\s+boundary=\"----_=_NextPart_[\dA-F]+_[\dA-F]+.[\dA-F]+\"/s
meta T_FORGED_IMS_CTYPE		(__ANY_IMS_MUA && !__IMS_BOUNDARY)
describe T_FORGED_IMS_CTYPE	Forged mail pretending to be from IMS (boundary)

