# SpamAssassin rules file: CVS rules under test
#
# This file is a placeholder for rules "under probation", ie. checked into
# CVS for testing. It should not be distributed; if the rules have good
# stats after a mass-check or two, then fold them into the distributed
# rules files.
#
# I suggest adding a prefix to rules in this file, "T_" -- this
# helps identify probationary rules in test output.
#
###########################################################################

# should be fixed now
header T_INVALID_MSGID		Message-Id !~ /^<(?:[a-zA-Z0-9.!\#\$%&'*\+\/=?\^_{}|~-]+|\".+\")\@(?:[a-zA-Z0-9.-]+|\[\d{1,3}(?:\.\d{1,3}){3}\])>(?:\s*\(.*\))?\s*$/ [if-unset: <NO@MSGID>]
describe T_INVALID_MSGID	Message-Id is not valid, according to RFC 2822

# new MIME_BOUND tests

# This may need tweaking if new NextPart formats appear.
# notes: original version
header __NEXTPART_ALL		Content-Type =~ /NextPart/
header __NEXTPART_NORMAL	Content-Type =~ /-{3}[-_]=_NextPart_[\dA-F]{3}(_[\dA-F]{3,8})?_[\dA-F]{8}.[\dA-F]{8}\b/
meta T_MIME_BOUND_NEXTPART	(__NEXTPART_ALL && !__NEXTPART_NORMAL)
score T_MIME_BOUND_NEXTPART	1.0

# notes: original version made more picky
header __NEXTPART_ALL2		Content-Type =~ /NextPart/
header __NEXTPART_NORMAL2	Content-Type =~ /="(?:----_?=_)?NextPart_[\dA-F]{3}(_[\dA-F]{3,8})?_[\dA-F]{8}\.[\dA-F]{8}"/
meta T_MIME_BOUND_NEXTPART2	(__NEXTPART_ALL2 && !__NEXTPART_NORMAL2)
score T_MIME_BOUND_NEXTPART2	1.0

# notes: original version made somewhat less picky
header __NEXTPART_ALL3		Content-Type =~ /NextPart/
header __NEXTPART_NORMAL3	Content-Type =~ /="(?:----_?=_)?NextPart(?:(?:_[\da-zA-Z]+){1,4}|_[\dA-F]{3}(_[\dA-F]{3,8})?_[\dA-F]{8}\.[\dA-F]{8})"/
meta T_MIME_BOUND_NEXTPART3	(__NEXTPART_ALL3 && !__NEXTPART_NORMAL3)
score T_MIME_BOUND_NEXTPART3	1.0

# notes: original version made much less picky
header __NEXTPART_ALL4		Content-Type =~ /NextPart/
header __NEXTPART_NORMAL4	Content-Type =~ /="(?:----_?=_)?NextPart(?:_[\da-zA-Z]+){1,4}(?:\.[\dA-F]{8})?"/
meta T_MIME_BOUND_NEXTPART4	(__NEXTPART_ALL4 && !__NEXTPART_NORMAL4)
score T_MIME_BOUND_NEXTPART4	1.0

# results for quinlan
#  0.149    0.458    0.000    1.00    0.72    0.50  T_FROM_TOPICA
header T_FROM_TOPICA		From:addr =~ /\@(?:\w+\.)?email-publisher\.com$/
describe T_FROM_TOPICA		From an address at email-publisher.com
score T_FROM_TOPICA		0.5

# results for quinlan
#  0.245    0.727    0.013    0.98    0.57    0.50  T_FROM_ALL_NUMS
header __FROM_JUST_NUMBER	From:addr =~ /^\d+\@/
header __FROM_PHONE		From:addr =~ /^\d{3}(?:[-.]?\d{3}[-.]?\d{4}|\d{7})\@/
meta T_FROM_ALL_NUMS		(__FROM_JUST_NUMBER && !__FROM_PHONE)
describe T_FROM_ALL_NUMS	From an address that is all numbers (non-phone)
score T_FROM_ALL_NUMS		0.5

# results for quinlan
#  0.482    1.454    0.013    0.99    0.61    0.50  T_SOME_BREAKTHROUGH
body T_SOME_BREAKTHROUGH	/(?:science|medical|major|scientific|fundamental|technology|revolutionary)\s+breakthrough/i
score T_SOME_BREAKTHROUGH	0.5

# results for quinlan
#  0.193    0.592    0.000    1.00    0.74    0.50  T_SELECTED_YOU
body T_SELECTED_YOU		/(?:you (?:have been|were) selected|we (?:have )?selected you)/i
score T_SELECTED_YOU		0.5

body T_HTML_UNTITLED_TITLE	eval:html_eval('title_text', '=~ /Untitled/i')
describe T_HTML_UNTITLED_TITLE	HTML title contains "Untitled"
score T_HTML_UNTITLED_TITLE	2.5

body T_HTML_EMPTY_TITLE		eval:html_eval('title_text', '!~ /\S/s')
describe T_HTML_EMPTY_TITLE	HTML title contains no text
score T_HTML_EMPTY_TITLE	2.5

# Sep 23 2002 jm: another spamhaus rule
header T_QVES_COM               Received =~ /by email.qves.com with Microsoft/
describe T_QVES_COM             Sent by a known spamhaus (qves)
score T_QVES_COM                3.0

uri T_ADCLICK                   m,\Qhttp://www.adclick.ws/p\E,
describe T_ADCLICK              Contains adclick URL
score T_ADCLICK                 2.0

# real hotmail outgoings use 'mc1-s3.law16...' or 'f206..' etc.
header T_FORGED_MX_HOTMAIL      Received =~ /^from mx\d+\.hotmail\.com /m
score T_FORGED_MX_HOTMAIL       2.0

# bug 1022: MGM_POSTCARD #1
body T_UNSUBSCRIBE_POSTCARD	/send a postcard to Unsubscribe/
describe T_UNSUBSCRIBE_POSTCARD	Send a postcard to unsubscribe
score T_UNSUBSCRIBE_POSTCARD	2.0

# bug 1022: MGM_POSTCARD #2 original
body T_UNSUBSCRIBE_POSTAL	/(?:Send(ing)? a (?:postal mail|postcard) to (?:Unsubscribe|Customer ?Service|remove)|unsubscribe by (?:postal mail|postcard))/i
describe T_UNSUBSCRIBE_POSTAL	Send real mail to unsubscribe
score T_UNSUBSCRIBE_POSTAL	2.0

# bug 1022: MGM_POSTCARD #2 small change
body T_UNSUBSCRIBE_POSTAL2	/(?:Send(ing)? a (?:postal mail|postcard) to (?:Unsubscribe|Customer ?Service|remov(?:e|al))|unsubscribe by (?:postal mail|postcard))/i
describe T_UNSUBSCRIBE_POSTAL2	Send real mail to unsubscribe
score T_UNSUBSCRIBE_POSTAL2	2.0

# quinlan: this is not any better on my corpus, but I figured it was
# worth a shot
body T_UNSUBSCRIBE_WTF		/(?:(?:customer ?service|unsubscribe|remov[ae]).{0,16}\b(?:postal mail|letter|postcard|fax)|\b(?:postal mail|letter|postcard|fax).{0,16}(?:customer ?service|unsubscribe|remov[ae]))/i
describe T_UNSUBSCRIBE_WTF	Send a postcard/letter/fax to unsubscribe
score T_UNSUBSCRIBE_WTF		2.0

# results for quinlan:
# 0.333    1.023    0.000    1.00    0.77    1.00  T_RATWARE_CDO
header T_RATWARE_CDO		X-Mailer =~ /Microsoft CDO for Windows 2000/
describe T_RATWARE_CDO		Sent from "Microsoft CDO for Windows 2000" 
score T_RATWARE_CDO		1.0

# results for quinlan:
# 0.421    1.292    0.000    1.00    0.79    1.00  T_RATWARE_EMWAC
header T_RATWARE_EMWAC		Received =~ /EMWAC SMTPRS/
describe T_RATWARE_EMWAC	Sent via a relay running "EMWAC SMTPRS"
score T_RATWARE_EMWAC		1.0

# results for quinlan:
# 0.368    1.131    0.000    1.00    0.78    1.00  T_RATWARE_THEBAT
# results for msquadrat:
# 4.328    3.189    4.372    0.42    0.28    0.30  USER_AGENT_THEBAT 
header T_RATWARE_THEBAT		X-Mailer =~ /The Bat/
describe T_RATWARE_THEBAT	Sent from "The Bat"
score T_RATWARE_THEBAT		1.0

# intended to replace URGENT_BIZ
body T_URGENT_BIZ		/URGENT.{0,16}(?:ASSISTANCE|BUSINESS|BUY|CONFIDENTIAL|NOTICE|PROPOSAL)/i
describe T_URGENT_BIZ		Contains URGENT matter

# Needs testing
body T_QUOTE_TWICE_1            /^> >\s/
describe T_QUOTE_TWICE_1        Contains twice quoted reply
score T_QUOTE_TWICE_1           -1.0

# Needs testing
body T_QUOTE_TWICE_2            /^>>/
describe T_QUOTE_TWICE_2        Contains twice quoted reply
score T_QUOTE_TWICE_2           -1.0

# Needs testing
# Outlook Express has spaces around the text, Outlook doesn't
# (jm comment: please add ^ anchor if possible.)
body T_OUTLOOK_REPLY            /----- ?Original Message ?-----/s
describe T_OUTLOOK_REPLY        Contains what looks like an outlook reply
score T_OUTLOOK_REPLY           -1.0

# some good spamsign Message-IDs from another list...
header T_MSGID_SPAMSIGN_ZEROES    Message-Id =~ /^<0000[0-9a-f]{8}\$0000[0-9a-f]{4}\$0000[0-9a-f]{4}\@/
describe T_MSGID_SPAMSIGN_ZEROES  Message-Id generated by spam tool (zeroes variant)
score T_MSGID_SPAMSIGN_ZEROES     2.0

header T_MSGID_SPAMSIGN_6LETTER   Message-Id =~ /^<[0-9][0-9][0-9][a-f]..[a-f]..[a-f].[a-f]\$[0-9a-f]{4}[a-f].[a-f].\$.[a-f][a-f]..[a-f][a-f].\@[a-z]{6}>/
describe T_MSGID_SPAMSIGN_6LETTER Message-Id generated by spam tool (6-letter variant)
score T_MSGID_SPAMSIGN_6LETTER    1.0

header T_MSGID_GOOD_EXCHANGE      Message-Id =~ /^<[A-Z]{28}\./
score T_MSGID_GOOD_EXCHANGE       -1.0
tflags T_MSGID_GOOD_EXCHANGE      nice

