# SpamAssassin rules file: compensation for common false positives.
###########################################################################
# Header compensation tests

header GENUINE_EBAY_RCVD        eval:check_for_from_domain_in_received_headers('ebay.com', 'true')
describe GENUINE_EBAY_RCVD      Message from eBay
tflags GENUINE_EBAY_RCVD	nice

header   APPROVED_BY            Approved-By =~ /./
describe APPROVED_BY            Has an Approved-By moderated list header
tflags APPROVED_BY		nice

header   EXCHANGE_SERVER        X-Mailer =~ /Internet Mail Service \([\d\.]+\)/
describe EXCHANGE_SERVER        Came via Internet Mail Service plugin
tflags EXCHANGE_SERVER		nice

# This is a Bugzilla bug status report e-mail and probably OK
header BUGZILLA_BUG             eval:message_from_bugzilla()
describe BUGZILLA_BUG           Looks like a Bugzilla bug
tflags BUGZILLA_BUG		nice

header DEBIAN_BTS_BUG           eval:message_from_debian_bts()
describe DEBIAN_BTS_BUG         Looks like a Debian BTS bug
tflags DEBIAN_BTS_BUG		nice

# give a negative score to Majordomo results.
header   MAJORDOMO              Subject =~ /Majordomo (?:request )?results/
describe MAJORDOMO              From Majordomo
tflags MAJORDOMO		nice

# these headers have very low correlation with spam
header CRON_ENV                 exists:X-Cron-Env
header IN_REP_TO                exists:In-Reply-To
header REFERENCES               exists:References
header USER_AGENT               exists:User-Agent
header X_AUTH_WARNING           exists:X-Authentication-Warning
header X_LOOP                   exists:X-Loop
header X_MAILING_LIST           exists:X-Mailing-List
header X_ACCEPT_LANG            exists:X-Accept-Language
header RESENT_TO                exists:Resent-To
tflags CRON_ENV                 nice
tflags IN_REP_TO                nice
tflags REFERENCES               nice
tflags USER_AGENT               nice
tflags X_AUTH_WARNING           nice
tflags X_LOOP                   nice
tflags X_MAILING_LIST           nice
tflags X_ACCEPT_LANG            nice
tflags RESENT_TO                nice

header PGP_SIGNATURE_2          Content-Type =~ /protocol=.?application\/pgp-signature.?;/i
describe PGP_SIGNATURE_2        Contains a PGP-signed message (signature attached)
tflags PGP_SIGNATURE_2		nice

header   KNOWN_MAILING_LIST     eval:detect_mailing_list()
describe KNOWN_MAILING_LIST     Email came from some known mailing list software
tflags KNOWN_MAILING_LIST	nice

# from Theo Van Dinter, see http://www.hughes-family.org/bugzilla/show_bug.cgi?id=591
body MSN_GROUPS                 eval:check_for_msn_groups_headers()
describe MSN_GROUPS             Came from MSN Communities
tflags MSN_GROUPS               nice

header NMS_CGI_NOT_BUGGY        X-Mailer =~ /^NMS FormMail.pl.*v\d/
describe NMS_CGI_NOT_BUGGY      Not Matt's Scripts formmail.pl
tflags NMS_CGI_NOT_BUGGY	nice

# some non-spam rules from http://www.darkmere.gen.nz/2002/0628.html
header Q_FOR_SELLER             Subject =~ /Question.*(?:for|to|from eBay).*(?:seller|Member)/
describe Q_FOR_SELLER           Subject is an eBay question
tflags Q_FOR_SELLER		nice

header SUBJECT_HAS_DATE         Subject =~ /1?\d[-\/][1-3]?\d[-\/](?:20)?0\d/
describe SUBJECT_HAS_DATE       Subject contains a date
tflags SUBJECT_HAS_DATE		nice

header FROM_NEWS_LIST           From =~ /(?:\@news|\@list)/i
describe FROM_NEWS_LIST         From: has a news or list hostname in FQDN
tflags FROM_NEWS_LIST		nice

header FROM_US_PHONE            From =~ /^[2-9]\d{9}\@/
describe FROM_US_PHONE          From: looks like US Telephone Number
tflags FROM_US_PHONE		nice

header SUBJECT_IS_NEWS          Subject =~ /\b(?:in review|news|list)\b/i
describe SUBJECT_IS_NEWS        Subject contains news newsletter list daily, weekly or monthly
tflags SUBJECT_IS_NEWS		nice

header SUBJECT_FREQ             Subject =~ /\b(?:monday|daily|weekly|monthly)\b/i
describe SUBJECT_FREQ           Subject contains a frequency - probable newsletter
tflags SUBJECT_FREQ		nice

header SUBJECT_MONTH            Subject =~ /\b(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|June?|July?|Aug(?:ust)?|Sep(?:tember)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)\b/
describe SUBJECT_MONTH          Subject contains a month name - probable newsletter
tflags SUBJECT_MONTH		nice

# a case-insensitive one; doesn't have "Apr" => "0% APR!" or "May" => "you may
# want to check this out".
header SUBJECT_MONTH_2          Subject =~ /\b(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|June?|July?|Aug(?:ust)?|Sep(?:tember)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)\b/i
describe SUBJECT_MONTH_2        Subject contains a month name - probable newsletter (2)
tflags SUBJECT_MONTH_2		nice

header FROM_EGROUPS             X-eGroups-Return =~ /^sentto-.*\@returns.groups.yahoo.com$/
describe FROM_EGROUPS           Appears to be from yahoo groups
tflags FROM_EGROUPS		nice
test FROM_EGROUPS  ok           sentto-2537484-52529-1020428367-Sxm=olswang.com@returns.groups.yahoo.com
test FROM_EGROUPS  fail         spammer@returns.groups.yahoo.com

header FWD_MSG                  Subject =~ /\[?Fwd?:?\s*/
describe FWD_MSG                Forwarded email
tflags FWD_MSG		        nice

# compensate for common false pos on above rule: Yahoo! webmail
header YAHOO_MSGID_ADDED        ALL =~ /Message-Id: <\S+\.mail.yahoo.com>\nReceived: .*by \S+mail.yahoo.com via HTTP;/s
describe YAHOO_MSGID_ADDED      'Message-Id' was added by yahoo.com, that's OK
tflags YAHOO_MSGID_ADDED        nice

###########################################################################
# Body compensation tests
###########################################################################

body HOTMAIL_FOOTER1             /Send and receive Hotmail on your mobile device: /
describe HOTMAIL_FOOTER1        Common footer for Hotmail
tflags HOTMAIL_FOOTER1		nice

body HOTMAIL_FOOTER2            /Get your FREE download of MSN Explorer at /
describe HOTMAIL_FOOTER2        Common footer for Hotmail
tflags HOTMAIL_FOOTER2		nice

body HOTMAIL_FOOTER3            /Get Your Private, Free E-mail from MSN Hotmail at http:\/\/www\.hotmail\.com\./
describe HOTMAIL_FOOTER3        Common footer for Hotmail
tflags HOTMAIL_FOOTER3		nice

body HOTMAIL_FOOTER4            /Join the world's largest e-mail service with MSN Hotmail\./
describe HOTMAIL_FOOTER4        Common footer for Hotmail
tflags HOTMAIL_FOOTER4		nice

body HOTMAIL_FOOTER5            /Chat with friends online, try MSN Messenger: /
describe HOTMAIL_FOOTER5        Common footer for Hotmail
tflags HOTMAIL_FOOTER5		nice

body MSN_FOOTER1                /MSN Photos is the easiest way to share and print your photos: /
describe MSN_FOOTER1            Common footer for MSN
tflags MSN_FOOTER1		nice

body MSN_FOOTER2                /Remove my e-mail address from Gaming Zone /
describe MSN_FOOTER2            Common footer for MSN
tflags MSN_FOOTER2		nice

body MAILBITS_EMAIL             /This is a free service provided by MailBits\.com\./
describe MAILBITS_EMAIL         recommended page from MailBits.com
tflags MAILBITS_EMAIL		nice

body GROUPS_YAHOO_1             /^Your use of Yahoo! Groups is subject to http:\/\/\Qdocs.yahoo.com\E\/info\/terms\//
describe GROUPS_YAHOO_1         Yahoo! Groups message
tflags GROUPS_YAHOO_1		nice

# Evites trigger false positives
body EVITE                      /(?:evite\.citysearch\.com|evite\.com)/
describe EVITE                  Claw back some for Evite
tflags EVITE		        nice

# Has a proper .sig - probably clean
body     SIGNATURE_DELIM        /^-- $/
describe SIGNATURE_DELIM        Standard signature delimiter present
tflags SIGNATURE_DELIM		nice

body EGP_HTML_BANNER            /^<!-- \S+begin egp html banner/
describe EGP_HTML_BANNER        non-spam EGP banner found
tflags EGP_HTML_BANNER		nice

body MAILMAN_CONFIRM            /We have received a request .*subscription of your email address.* to the .* mailing list/
describe MAILMAN_CONFIRM        A MailMan confirm-your-address message
tflags MAILMAN_CONFIRM		nice

rawbody PGP_SIGNATURE           /-----BEGIN PGP SIGNATURE-----/
describe PGP_SIGNATURE          Contains a PGP-signed message
tflags PGP_SIGNATURE		nice

body BALANCE_FOR_LONG           eval:check_for_very_long_text('10000')
describe BALANCE_FOR_LONG       Message text is over 10K in size
tflags BALANCE_FOR_LONG		nice

body BALANCE_FOR_LONG_20K       eval:check_for_very_long_text('20000')
describe BALANCE_FOR_LONG_20K   Message text is over 20K in size
tflags BALANCE_FOR_LONG_20K	nice

rawbody PATCH_UNIFIED_DIFF	/^\@\@ [-+0-9]+,[0-9]+ [-+0-9]+,[0-9]+ \@\@$/
describe PATCH_UNIFIED_DIFF	Contains what looks like a patch from diff -u
tflags PATCH_UNIFIED_DIFF	nice

rawbody PATCH_CONTEXT_DIFF	/^\*{3} \S+\s+\S{3} \S{3} .\d \d{2}:\d{2}:\d{2} \d+\s*$/
describe PATCH_CONTEXT_DIFF	Contains what looks like a patch from diff -c
tflags PATCH_CONTEXT_DIFF	nice

body DISCLAIMER_LEGALESE        /This e?-?mail.{1,20}confidential.{1,20}legally privileged/
describe DISCLAIMER_LEGALESE    Contains what looks like an 'E-Mail Disclaimer'
tflags DISCLAIMER_LEGALESE	nice

body EMAIL_ATTRIBUTION		/^"?\w.{4,} (?:wrote|writes):$/
describe EMAIL_ATTRIBUTION	Contains what looks like an email attribution
tflags EMAIL_ATTRIBUTION	nice

# matt@nightrealms.com (Matthew Cline)
header   FAILURE_NOTICE_1       Subject =~ /^(?:failure notice|returned mail:|Delivery Status Notification|Undeliverable:)/i
describe FAILURE_NOTICE_1       Mailer daemon failure notice (1)
tflags   FAILURE_NOTICE_1       nice

body     FAILURE_NOTICE_2       /\b(?:Delivery to the following recipients failed|This Message was undeliverable|The following addresses had permanent fatal errors|did not reach the following recipient)\b/i
describe FAILURE_NOTICE_2       Mailer daemon failure notice (2)
tflags   FAILURE_NOTICE_2       nice

header   MAILER_DAEMON          From =~ /mailer.?daemon\@/i
describe MAILER_DAEMON          From the Mailer-Daemon
tflags   MAILER_DAEMON          nice

# spamassassin@davidgreenaway.com (David Greenaway)
body     FORGOTTEN_PASSWORD     /[fF]org[oe]t.{0,25}[pP]assword/
describe FORGOTTEN_PASSWORD     Contains a password retrieval system
tflags   FORGOTTEN_PASSWORD     nice

body     PRIVACY_STATEMENT      /PRIVACY STATEMENT/i
describe PRIVACY_STATEMENT      Contains a Privacy Statement
tflags   PRIVACY_STATEMENT      nice

